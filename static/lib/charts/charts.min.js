// chart_utils.js
var UTILS=UTILS||(function(){var re_render_charts_handler=function(evt){var list;if(document.getElementsByClassName){list=document.getElementsByClassName("chart-responsive")}else{var list1=document.getElementsByTagName("div");list=[];for(var i=list1.length-1;i>-1;i--){var el=list1[i];if(/chart-responsive/i.test(el.className)){list.push(el)}}}for(var i=list.length-1;i>-1;i--){var el=list[i];var divWidth=el.clientWidth;if(divWidth==null){return}el.innerHTML="";var renderFuncName="render_"+el.id;eval(renderFuncName+"("+divWidth+")")}};if(/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent)){window.addEventListener("orientationchange",re_render_charts_handler,false)}else{window.addEventListener("resize",re_render_charts_handler,false)}var UTILS={};UTILS.CONSTANTS={};UTILS.CONSTANTS.SIMPLE_BARS=0;UTILS.CONSTANTS.GROUPED_BARS=1;UTILS.CONSTANTS.DEFAULT_DATE_FORMAT="dd MMMM yyyy hh:mm:ss tt";UTILS.CONSTANTS.DEFAULT_NUMBER_FORMAT="d";UTILS.globalizeCultureName=UTILS.globalizeCultureName||null;UTILS.loadPageCultureJS=function(){if(typeof Globalize=="undefined"){console.warn("WARNING: GlobalizeJS library not available!");UTILS.globalizeCultureName=null}else{var lang=(navigator.language||navigator.userLanguage);console.log("INFO: lang="+lang);var setupCulture=function(navigatorCulture){Globalize.culture=(navigatorCulture||Globalize.cultures["default"]);UTILS.globalizeCultureName=Globalize.culture.name;console.log("INFO: globalizeCultureName="+UTILS.globalizeCultureName,((Globalize.culture.name!=lang)?" --> does not match with browser lang  ":""))};var navigatorCulture=Globalize.cultures[lang];if(navigatorCulture==null){try{loadScript("/iwap/lib/globalize/cultures/globalize.culture."+lang+".js",function(){console.log("INFO: globalize.culture."+lang+".js loaded");var navigatorCulture=Globalize.cultures[lang];setupCulture(navigatorCulture);return})}catch(except){console.log("FAIL: could not load 'globalize.culture."+lang+".js'")}}else{setupCulture(navigatorCulture)}}};UTILS.globalizeFormat=function(format){if(UTILS.globalizeCultureName===null){UTILS.loadPageCultureJS()}return function(d,i){if(UTILS.globalizeCultureName==null){console.log("WARNING: GlobalizeJS library not load!");return d}return Globalize.format(UTILS.time.toUTCDate(d),format,Globalize.culture)}};UTILS.time={};UTILS.time.toUTCDate=function(dt){if(dt==null){return null}var utcDt=new Date(dt.getTime()+(dt.getTimezoneOffset()*60000));return utcDt};UTILS.time.format=function(format){if(UTILS.globalizeCultureName==null){return d3.time.format.utc(format)}return UTILS.globalizeFormat(UTILS.time.d3ToGlobalizeFormat(format))};UTILS.time.globalizeTimeScaleFormat=function(){if(typeof Globalize=="undefined"){console.log("WARNING: GlobalizeJS library not load!");return null}return function(dt0,idx){if(dt0==null){return null}if(UTILS.globalizeCultureName==null){UTILS.loadPageCultureJS()}var noGblJs=(UTILS.globalizeCultureName==null);if(noGblJs){console.log("WARNING: GlobalizeJS library not loaded!",UTILS.globalizeCultureName)}var dt=UTILS.time.toUTCDate(dt0);if(dt.getMilliseconds()){if(noGblJs){return d3.time.format(".%L")(dt)}else{return Globalize.format(dt,".fff",Globalize.culture)}}else{if(dt.getSeconds()){if(noGblJs){return d3.time.format(":%S")(dt)}else{return Globalize.format(dt,":ss",Globalize.culture)}}else{if(dt.getMinutes()){if(noGblJs){return d3.time.format("%I:%M")(dt)}else{return Globalize.format(dt,"hh:mm",Globalize.culture)}}else{if(dt.getHours()){if(noGblJs){return d3.time.format("%I %p")(dt)}else{return Globalize.format(dt,"hh tt",Globalize.culture)}}else{if(dt.getDay()&&dt.getDate()!=1){if(noGblJs){return d3.time.format("%a %d")(dt)}else{return Globalize.format(dt,"ddd dd",Globalize.culture)}}else{if(dt.getDate()!=1){if(noGblJs){return d3.time.format("%b %d")(dt)}else{return Globalize.format(dt,"MMM dd",Globalize.culture)}}else{if(dt.getMonth()){if(noGblJs){return d3.time.format("%B")(dt)}else{return Globalize.format(dt,"MMMM",Globalize.culture)}}else{if(noGblJs){return d3.time.format("%Y")(dt)}else{return Globalize.format(dt,"yyyy",Globalize.culture)}}}}}}}}}};UTILS.time.d3ToGlobalizeFormat=function(format){return format.replace(/%L/g,"fff").replace(/%S/g,"ss").replace(/%I/g,"hh").replace(/%M/g,"mm").replace(/%p/g,"tt").replace(/%a/g,"ddd").replace(/%d/g,"dd").replace(/%b/g,"MMM").replace(/%B/g,"MMMM").replace(/%Y/g,"yyyy").replace(/%A/g,"dddd").replace(/%c/g,"ddd MMM dd HH:mm:ss yyyy").replace(/%e/g,"dd").replace(/%H/g,"HH").replace(/%m/g,"MM").replace(/%m/g,"MM").replace(/%L/g,"fff").replace(/%S/g,"ss").replace(/%x/g,"MM/dd/yyyy").replace(/%X/g,"HH:mm:ss").replace(/%y/g,"yy").replace(/%Z/g,"zzz").replace(/%%/g,"'%'").replace(/%j/g,"'%j'").replace(/%U/g,"'%U'").replace(/%w/g,"'%w'").replace(/%W/g,"'%W'")};UTILS.getFormater=function(tformat){if(tformat!=null){if(typeof tformat=="function"){return tformat}if(tformat.indexOf("function")!=-1){return eval(tformat)}else{if(tformat.indexOf("d3.")!=-1){if(typeof Globalize=="undefined"){return eval(tformat)}else{var str_splits=tformat.indexOf('"')!=-1?tformat.split('"'):tformat.split("'");if(["d3.time.format.utc(","d3.time.format("].indexOf(str_splits[0])!=-1){return UTILS.time.format(str_splits[1])}else{return eval(tformat)}}}else{if(tformat.search(/\%[a-zA-Z\%]/g)!=-1){if(typeof Globalize=="undefined"){return d3.time.format.utc(tformat)}else{return UTILS.time.format(tformat)}}else{if(tformat!=="default"&&tformat!==""){return d3.format(tformat)}}}}}return null};UTILS.customTooltip=function(tooltipId,width,height){var tooltipId=tooltipId;var ttDiv=d3.select("body").append("div").attr("class","chart-tooltip").attr("id",tooltipId).style("opacity",1);hideTooltip();function showTooltip(content,event){ttDiv.html(content);ttDiv.style("display","");updatePosition(event)}function hideTooltip(){ttDiv.style("display","none")}function updatePosition(event){var tdiv=document.getElementById(tooltipId);var xOffset=20;var yOffset=10;var ttw=tdiv.clientWidth;var tth=tdiv.clientHeight;var wscrY=window.scrollY||window.pageYOffset;var wscrX=window.scrollX||window.pageXOffset;var curX=tdiv?event.clientX+wscrX:event.pageX;var curY=tdiv?event.clientY+wscrY:event.pageY;var ttleft=((curX-wscrX+xOffset*2+ttw)>window.outerWidth)?curX-ttw-xOffset*2:curX+xOffset;if(ttleft<wscrX+xOffset){ttleft=wscrX+xOffset}var tttop=((curY-wscrY+yOffset*2+tth)>window.outerHeight)?curY-tth-yOffset*2:curY+yOffset;if(tttop<wscrY+yOffset){tttop=curY+yOffset}ttDiv.style("top",tttop+"px").style("left",ttleft+"px")}return{showTooltip:showTooltip,hideTooltip:hideTooltip,updatePosition:updatePosition}};UTILS.second=1000;UTILS.minute=60*UTILS.second;UTILS.hour=60*UTILS.minute;UTILS.day=24*UTILS.hour;UTILS.week=7*UTILS.day;UTILS.month=30*UTILS.day;UTILS.month31=31*UTILS.day;UTILS.year=365*UTILS.day;UTILS.randomInt=function(start,end){if(!start){start=1}if(!end){end=1000}return Math.round((Math.random()*(end-start))+start)};UTILS.executeClickAction=function(actionType,actionTarget,actionUrl,actionUrlParams,chartDivID){var actionUrlWithParams="";idx=actionUrl.indexOf("?");if(idx==-1){actionUrlWithParams=actionUrl+"?"+actionUrlParams}else{actionUrlWithParams=actionUrl+"&"+actionUrlParams}if(actionType=="newPopup"){if(typeof jQuery=="undefined"){window.showModalDialog(actionUrlWithParams,"","dialogWidth:300px; dialogHeight:200px; edge:sunken; center:yes; status:no; resizable:no; help:no")}else{if(typeof $().modal=="function"){UTILS.showPopupWindow(chartDivID,actionTarget,actionUrlWithParams)}else{window.showModalDialog(actionUrlWithParams,"","dialogWidth:300px; dialogHeight:200px; edge:sunken; center:yes; status:no; resizable:no; help:no")}}}if(actionType=="newWindow"){window.open(actionUrlWithParams,"_blank","menubar, toolbar, location, directories, status, scrollbars, resizable, dependent, width=640, height=480, left=0, top=0","false");window.focus()}if(actionType=="divTarget"){UTILS.getUrlContent(actionTarget,actionUrlWithParams)}if(actionType=="iframeTarget"){var iframe=document.getElementById(actionTarget);iframe.src=actionUrlWithParams}return};UTILS.getUrlContent=function(divID,url){var xmlhttp;if(window.XMLHttpRequest){xmlhttp=new XMLHttpRequest()}else{xmlhttp=new ActiveXObject("Microsoft.XMLHTTP")}xmlhttp.onreadystatechange=function(){if(xmlhttp.readyState==4&&xmlhttp.status==200){div=document.getElementById(divID);div.innerHTML=xmlhttp.responseText;var x=div.getElementsByTagName("script");for(var i=0;i<x.length;i++){eval(x[i].text)}}};xmlhttp.open("GET",url,true);xmlhttp.send()};UTILS.showPopupWindow=function(chartDivID,targetID,urlWithParams){var popupID=chartDivID+"_popup";$("#"+popupID).modal({backdrop:false});UTILS.getUrlContent(popupID+"_content",urlWithParams)};UTILS.removeDuplicatesInList=function(list){var tmplist=[];list.forEach(function(d){if(tmplist.indexOf(d)==-1){tmplist.push(d)}});return tmplist};UTILS.flattenArray=function(list){if(list==null){return null}if(!Array.isArray(list)){return[list]}var concatAB=function(a,b){if(Array.isArray(b)){b=b.reduce(concatAB,[]);return a.concat(b)}else{a.push(b);return a}};return list.reduce(concatAB,[])};UTILS.chart_legends=function(){var config={data:[],actualNames:null,colors:d3.scale.category20(),x:0,y:0,width:100,height:100,fontStyle:"10px Verdana",dotSize:5,dotType:"circle",padding:10,chartWidthOffset:8,chartHeightOffset:8,layoutStyle:"left2right@width"};var config_keys=Object.keys(config);var thisPane=function(parentPanel){var mainPanel=(parentPanel instanceof String)?d3.select(parentPanel):parentPanel;_drawLegends(mainPanel)};thisPane.attr=function(name,value){switch(arguments.length){case 0:return null;case 1:return config[name];default:if(config_keys.indexOf(name)==-1){console.log("[UTILS.chart_legends]","WARNING","Invalid attribute :",name)}config[name]=UTILS.defaultValue(value,config[name]);break}return thisPane};thisPane.getLegends=function(){return config.legends};_drawLegends=function(mainpanel){var legendpanel=mainpanel.append("g").attr("class","legendpanel");var entry=legendpanel.selectAll("g").data(config.data).enter().append("g").attr("class",function(d,i){return"legend entry"+i});config.legends=entry;config.hasNamedColors=UTILS.isOrdinalScaleWithNames(config.colors);if(config.hasNamedColors&&config.actualNames==null){config.actualNames=config.data}var legendDotRadius=config.dotSize;var chartWidthOffset=config.chartWidthOffset;var chartHeightOffset=config.chartHeightOffset;var startAtX=config.x;var startAtY=config.y;var colPadding=config.padding;var rowPadding=config.padding;var calc={};calc.getLegendWidth=function(noOfChars){return(noOfChars*chartWidthOffset)+(legendDotRadius*2)+colPadding};var legendMax=d3.max(config.data.map(function(d,i){return d.length}));var maxColWidth=calc.getLegendWidth(legendMax);var maxRowHeight=chartHeightOffset+rowPadding;var len=config.data.length;if(config.layoutStyle.indexOf("@width")!=-1){calc.noOfCols=Math.floor(config.width/maxColWidth);if(calc.noOfCols>len){calc.noOfCols=len}if(calc.noOfCols<=0){calc.noOfCols=1}calc.noOfRows=Math.ceil(len/calc.noOfCols)}else{calc.noOfRows=Math.floor(config.height/(maxRowHeight));if(calc.noOfRows>len){calc.noOfRows=len}if(calc.noOfRows<1){calc.noOfRows=1}calc.noOfCols=Math.ceil(len/calc.noOfRows)}if(config.layoutStyle.indexOf("left2right")!=-1){calc.getColNo=function(i){return Math.floor(i%calc.noOfCols)};calc.getRowNo=function(i){return Math.floor(i/calc.noOfCols)}}else{calc.getColNo=function(i){return Math.floor(i/calc.noOfRows)};calc.getRowNo=function(i){return Math.floor(i%calc.noOfRows)}}var listPerColWidth=[];config.data.forEach(function(d,i){var colNo=calc.getColNo(i);var dlen=d.length;if(listPerColWidth[colNo]==undefined||listPerColWidth[colNo]<dlen){listPerColWidth[colNo]=dlen}});var colPositions=[];for(var i=0;i<calc.noOfCols;i++){var x;if(i==0){x=startAtX}else{var w0=listPerColWidth[i-1];var x0=colPositions[i-1];x=x0+calc.getLegendWidth(w0)}colPositions[i]=x}config.requiredTotalWidth=colPositions[calc.noOfCols-1]-colPositions[0]+calc.getLegendWidth(listPerColWidth[calc.noOfCols-1]);config.requiredTotalHeight=(calc.noOfRows*maxRowHeight)+config.padding;var xcall=function(d,i){var colNo=calc.getColNo(i);var x=colPositions[colNo];return x};var ycall=function(d,i){var rowNo=calc.getRowNo(i);return startAtY+(rowNo*maxRowHeight)};entry.append("text").attr("x",function(d,i){return xcall(d,i)+legendDotRadius*2}).attr("y",ycall).attr("dy",".35em").attr("text-anchor","start").text(function(d,i){return d}).style("font",config.fontStyle);if(config.dotType=="square"){var dot=entry.append("rect").attr("x",function(d,i){return xcall(d,i)-legendDotRadius}).attr("y",function(d,i){return ycall(d,i)-legendDotRadius}).attr("width",legendDotRadius*2).attr("height",legendDotRadius*2).attr("fill",function(d,i){return(config.hasNamedColors)?config.colors(config.actualNames[i]):config.colors(i)})}else{entry.append("circle").attr("cx",xcall).attr("cy",ycall).attr("r",legendDotRadius).attr("fill",function(d,i){return(config.hasNamedColors)?config.colors(config.actualNames[i]):config.colors(i)})}};return thisPane};UTILS.parseBool=function(value,defaultValue){if(value!=null){if(typeof value==="string"){return(["true","on","yes","y","t"].indexOf(value.toLowerCase())!=-1)}else{return(value)?true:false}}else{return(arguments.length>1&&(defaultValue))?true:false}};UTILS.parseInt=function(text,defaultValue){if(text==null||text===""||text==="default"){return(arguments.length>1)?defaultValue:0}else{var num=parseInt(text.trim?text.trim():text);return isNaN(num)?(arguments.length>1)?defaultValue:0:num}};UTILS.defaultValue=function(value,defaultValue){if(value==null||value===""||value==="default"){return(arguments.length>1)?defaultValue:""}else{return value}};UTILS.getUniqueid=function(){return"id_"+(new String(Math.random())).replace(".","_")+"_"+(new Date()).getTime()};UTILS.isOrdinalScaleWithNames=function(scale){var domain=scale.domain();return(domain.length>0&&(typeof domain[0]==="string"))};UTILS._chart_axis=function(type){return function(){var attrs={type:type,ticks:5,x:null,y:null,scale:null,chartWidth:0,chartHeight:0,axisStyle:{},labelOffset:20,labelFontStyle:null,addlClassName:null,makeTicksResponsive:true};var attrs_keys=Object.keys(attrs);var thisAxis=function(parentPanel){var mainPanel=(parentPanel instanceof String)?d3.select(parentPanel):parentPanel;_renderAxis(mainPanel)};thisAxis.attr=function(name,value){switch(arguments.length){case 0:return null;case 1:return attrs[name];default:if(attrs_keys.indexOf(name)==-1){console.log("[UTILS.chart-"+type+"]","WARNING","Invalid attribute :",name)}attrs[name]=UTILS.defaultValue(value,attrs[name]);break}return thisAxis};thisAxis.getAxis=function(){return thisAxis.axis};thisAxis.get=function(name){return thisAxis.config[name]};var _renderAxis=function(mainpanel){var config={};thisAxis.config=config;var label=attrs.axisStyle.label;config.tickDisplayAngle=UTILS.parseInt(attrs.axisStyle.tickDisplayAngle,null);config.ticks=UTILS.parseInt(attrs.axisStyle.ticks,null);config.tickFormat=UTILS.getFormater(attrs.axisStyle.tickformat);config.labelFontStyle=UTILS.defaultValue(attrs.axisStyle.labelFontStyle,attrs.labelFontStyle);config.labelOffset=UTILS.defaultValue(attrs.axisStyle.labelOffset,attrs.labelOffset);config.d3axis_x=(attrs.x==null)?0:attrs.x;config.d3axis_y=(attrs.y==null)?0:attrs.y;config.hasGridLines=UTILS.parseBool(attrs.axisStyle.hasGridLines,false);config.addlClassName=(attrs.addlClassName==null)?"":attrs.addlClassName;config.requiredHeight=10;var makeXAxisTicksResponsive=function(type){var tickMajors=[],maxLen=0;var ticks=axisSvg.selectAll(".tick.major").each(function(d,i){var g=d3.select(this);var t=g.select("text");var x=t.attr("x");var y=t.attr("y");var val=t.html();var valLen=val.length;if(maxLen<valLen){maxLen=valLen}tickMajors.push([g,t,valLen,x,y])});var ticksCount=tickMajors.length;var textOffset=maxLen*6.5;if(attrs.chartWidth<(textOffset*ticksCount)){var p=(config.axisPosition=="top")?"end":"start";for(var i=ticksCount-1;i>-1;i--){var tick=tickMajors[i];var t=tick[1];var valLen=tick[2];var oldX=tick[3];var oldY=tick[4];var newDY=".36em";var textTransform="rotate(90)";t.attr("transform",textTransform).attr("x",oldY).attr("y",oldX).attr("dy",newDY).style("text-anchor",p)}if(attrs.axisStyle.position=="out"){config.labelOffset=(maxLen*8.5)}}};switch(type){case"y-axis":config.className="y";config.axisPosition=(attrs.axisStyle.position=="in")?"right":"left";config.calcuReqHeightNLabelPosition=function(){if(label!=null&&label!==""){config.label_x=-(attrs.chartHeight/2);config.label_y=-config.labelOffset;config.label_transform="rotate(-90)"}config.requiredHeight=attrs.chartHeight};config.addGridNewLine=function(d,i){var g=d3.select(this);var line=g.append("line");line.attr("x2",0).attr("y2",0).attr("x1",attrs.chartWidth)};config.makeTicksResponsive=null;break;case"x-axis-horizontal":config.className="x";config.axisPosition=(attrs.axisStyle.position=="in")?"bottom":"top";config.calcuReqHeightNLabelPosition=function(){if(label!=null&&label!==""){config.label_x=attrs.chartWidth/2;config.label_y=-config.labelOffset;config.label_transform=""}config.requiredHeight=config.labelOffset;if(attrs.axisStyle.position=="in"){config.requiredHeight=0}};config.addGridNewLine=function(d,i){var g=d3.select(this);var line=g.append("line");line.attr("y2",0).attr("x2",0).attr("y1",attrs.chartHeight)};config.makeTicksResponsive=makeXAxisTicksResponsive;break;case"x-axis":default:config.className="x";config.axisPosition=(attrs.axisStyle.position=="in")?"top":"bottom";config.d3axis_y=(attrs.y==null)?attrs.chartHeight:attrs.y;config.calcuReqHeightNLabelPosition=function(){if(label!=null&&label!==""){config.label_x=attrs.chartWidth/2;config.label_y=attrs.chartHeight+config.labelOffset;config.label_transform=""}config.requiredHeight=config.labelOffset;if(attrs.axisStyle.position=="in"){config.requiredHeight=0}};config.addGridNewLine=function(d,i){var g=d3.select(this);var line=g.append("line");line.attr("y2",0).attr("x2",0).attr("y1",-attrs.chartHeight)};config.makeTicksResponsive=makeXAxisTicksResponsive;break}var d3Axis=d3.svg.axis().scale(attrs.scale).orient(config.axisPosition);if(config.ticks!=null){d3Axis.ticks(config.ticks)}if(config.tickFormat!=null){d3Axis.tickFormat(config.tickFormat)}thisAxis.axis=d3Axis;var axisSvg=mainpanel.append("g").attr("class",config.className+" axis "+config.addlClassName).attr("transform","translate("+config.d3axis_x+","+config.d3axis_y+")").call(d3Axis);if(config.tickDisplayAngle!=null){axisSvg.selectAll("text").attr("transform","rotate("+config.tickDisplayAngle+")")}if(config.hasGridLines){axisSvg.selectAll(".tick.major").each(config.addGridNewLine)}if(config.makeTicksResponsive&&attrs.makeTicksResponsive){config.makeTicksResponsive()}config.calcuReqHeightNLabelPosition();if(label!=null&&label!==""){var labelText=mainpanel.append("g").attr("class",config.className+" label "+config.addlClassName).append("text").attr("transform",config.label_transform).attr("text-anchor","middle").attr("x",config.label_x).attr("y",config.label_y).text(label);if(config.labelFontStyle!=null){labelText.style("font",config.labelFontStyle)}}};return thisAxis}};UTILS.chart_x_axis=UTILS._chart_axis("x-axis");UTILS.chart_x_axis_horizontal=UTILS._chart_axis("x-axis-horizontal");UTILS.chart_y_axis=UTILS._chart_axis("y-axis");UTILS.appendErrMsg=function(containerID,err){var errMsg=err&&err.message?err.message:err;var errStack=escape(err.stack?err.stack:"");var _div=d3.select(containerID);_div.html(_div.html()+"<br/><div><img src='/iwap/css/images/warning_sign.png' width='15px' height='15px' alt='"+errStack+"' onclick='alert(unescape(this.alt));' /><span class='errmsg'>Error: "+errMsg+"</span></div>")};return UTILS})(window);
// chart_usage_pie.js
var chart_usage_pie=function(){var b={uniqueid:null,data:[],dataidx:-1,colors:d3.scale.category20(),x:0,y:0,colors:d3.scale.category20(),innerRadius:30,outerRadius:50,unitLabels:null,headerText:"",centerText:"",centerText2:"",footerText:"",footerText2:"",arcs:null,displayPercent:true,arcStartAngle:1,percentRoundDecimals:2};var a=function(c){if(b.uniqueid==null){b.uniqueid=UTILS.getUniqueid()}var e=(c instanceof String)?d3.select(c):c;var d=e.append("g").attr("transform","translate("+(b.x+b.outerRadius)+","+(b.y+b.outerRadius)+")").attr("id",b.uniqueid);b._drawPie(d)};a.data=function(c){if(!arguments.length){return b.data}b.data=c;return a};a.dataidx=function(c){if(!arguments.length){return b.dataidx}b.dataidx=c;return a};a.colors=function(c){if(!arguments.length){return b.colors}b.colors=c;return a};a.x=function(c){if(!arguments.length){return b.x}b.x=c;return a};a.y=function(c){if(!arguments.length){return b.y}b.y=c;return a};a.innerRadius=function(c){if(!arguments.length){return b.innerRadius}b.innerRadius=c;return a};a.outerRadius=function(c){if(!arguments.length){return b.outerRadius}b.outerRadius=c;return a};a.displayPercent=function(c){if(!arguments.length){return b.displayPercent}b.displayPercent=c;return a};a.headerText=function(c){if(!arguments.length){return b.headerText}b.headerText=c;return a};a.centerText=function(c){if(!arguments.length){return b.centerText}b.centerText=c;return a};a.centerText2=function(c){if(!arguments.length){return b.centerText2}b.centerText2=c;return a};a.footerText=function(c){if(!arguments.length){return b.footerText}b.footerText=c;return a};a.footerText2=function(c){if(!arguments.length){return b.footerText2}b.footerText2=c;return a};a.arcLabels=function(c){if(!arguments.length){return b.arcLabels}b.arcLabels=c;return a};a.unitLabels=function(c){if(!arguments.length){return b.unitLabels}b.unitLabels=c;return a};a.uniqueid=function(c){if(!arguments.length){return b.uniqueid}b.uniqueid=c;return a};a.getArcs=function(){return b.arcs};a.getTotal=function(){return b.total};a.getPercentages=function(){return b.percentage};a.percentRoundDecimals=function(c){if(!arguments.length){return b.percentRoundDecimals}b.percentRoundDecimals=c;return a};b._drawPie=function(d){var l=0;if(b.headerText!=""){d.append("g").attr("class","label").append("text").attr("text-anchor","middle").attr("x",0).attr("y",-(b.outerRadius-10)).text(b.headerText).style("font","bold 10px Verdana");l+=20}var o=b.data;var h=d3.layout.pie().sort(null);var e=d3.svg.arc().innerRadius(b.innerRadius).outerRadius(b.outerRadius);var j=h(o);var c=d.selectAll("g arc").data(j).enter().append("g").attr("class","arc").attr("transform","translate(0,"+l+")");var n=c.append("path").attr("stroke","beige").attr("stroke-width",0.5).attr("fill",function(r,q){return b.colors(q)}).attr("id",function(r,q){return b.uniqueid+"_"+q}).attr("d",e);c.attr("dataidx",b.dataidx);b.arcs=c;var k=d3.sum(o);var p=[];for(var g=0;g<o.length;g++){p[g]=d3.round((o[g]/k*100),b.percentRoundDecimals)}b.total=k;b.percentage=p;var f=b.innerRadius!=0?1:1.5;var m=c.append("text").attr("transform",function(i){var q=e.centroid(i);return"translate("+q[0]*f+","+q[1]*f+")"}).attr("dy",".35em").attr("text-anchor","middle").attr("display",function(i){return i.value>0.15?null:"none"}).text(function(u,r){var q="";if(b.arcLabels!=null){var t=b.arcLabels[r];q+=(t!=null)?t:""}if(b.displayPercent){var s=(p[r]>7)?p[r]+"%":"";q+=s}return q}).style("font","10px Verdana");if(b.centerText!=""){d.append("g").attr("class","label").append("text").attr("text-anchor","middle").attr("x",0).attr("y",l).text(b.centerText).style("font","bold 10px Verdana")}if(b.centerText2!=""){d.append("g").attr("class","label").append("text").attr("text-anchor","middle").attr("x",0).attr("y",l+15).text(b.centerText2).style("font","10px Verdana")}if(b.footerText!=""){d.append("g").attr("class","label").append("text").attr("text-anchor","middle").attr("x",0).attr("y",(l+b.outerRadius+15)).text(b.footerText).style("font","bold 10px Verdana")}if(b.footerText2!=""){d.append("g").attr("class","label").append("text").attr("text-anchor","middle").attr("x",0).attr("y",(l+b.outerRadius+30)).text(b.footerText2).style("font","10px Verdana")}if(b.unitLabels!=null){b._drawUnitLabels(d,j)}};b._drawUnitLabels=function(c,d){var e=c.selectAll("text.unit").data(d);b.arcTextStartAngleOffset=-(Math.PI)-(Math.PI*-0.5);b.textOffset=1;e.enter().append("svg:text").attr("class","unit").attr("transform",function(f){return"translate("+(Math.cos((f.startAngle-(Math.PI))-b.arcTextStartAngleOffset)*(b.outerRadius+b.textOffset))+","+(Math.sin((f.startAngle-(Math.PI))-b.arcTextStartAngleOffset)*(b.outerRadius+b.textOffset))+")"}).attr("text-anchor",function(h){var f=h.startAngle;var g=Math.PI;if(f==g){return"middle"}else{if(f<g){return"end"}else{return"beginning"}}}).text(function(g,f){return b.unitLabels[f]});e.exit().remove()};return a};
// chart_bar.js
function chart_bar(){var a=_bar_chart_config();var b=function(c){try{a.drawChart(c)}catch(d){UTILS.appendErrMsg(c,d);throw d}};b.data=function(c){if(!arguments.length){return a.data}a.data=c;return b};b.keys=function(c){if(!arguments.length){return a.keys}a.keys=c;return b};b.legendStyle=function(c){if(!arguments.length){return a.legendStyle}a.legendStyle=c;return b};b.chartStyle=function(c){if(!arguments.length){return a.chartStyle}a.chartStyle=c;return b};b.hAxis=function(c){if(!arguments.length){return a.hAxis}a.hAxis=c;return b};b.vAxis=function(c){if(!arguments.length){return a.vAxis}a.vAxis=c;return b};b.colors=function(c){if(!arguments.length){return a.colors}a.colors=c;return b};b.tooltip=function(c){if(!arguments.length){return a.tooltip}a.tooltip=c;return b};b.clickAction=function(c){if(!arguments.length){return a.clickAction}a.clickAction=c;return b};b.responsiveWidth=function(c){if(!arguments.length){return a.responsiveWidth}a.responsiveWidth=c;return b};return b}function _bar_chart_config(){var config={chartType:"bar",barStyle:UTILS.CONSTANTS.GROUPED_BARS,data:[],keys:null,legendStyle:[],chartStyle:[],colors:d3.scale.category20(),hAxis:null,vAxis:null,tooltip:[],responsiveWidth:0,clickAction:null};config.drawChart=function(chartContainerID){config.uniqueid=chartContainerID.substring(1);config.xkey=config.keys[0];config.ykeys=(typeof config.keys[1]==="string")?[config.keys[1]]:config.keys[1];config.width=parseInt(config.chartStyle.width);config.height=parseInt(config.chartStyle.height);if(config.tooltip!=null){config.customTooltip=UTILS.customTooltip(config.uniqueid+"_tooltip",config.tooltip.width,config.tooltip.height)}var legendWidth=0;var legendHeight=0;if(config.legendStyle!==null){legendWidth=parseInt(config.legendStyle.width);legendHeight=parseInt(config.legendStyle.height)}var responsiveWidth=parseInt(config.responsiveWidth);if(responsiveWidth>0){var totalWidth;if(config.legendStyle==null||config.legendStyle.position=="right"){totalWidth=config.width+legendWidth}else{totalWidth=(config.width>legendWidth)?config.width:legendWidth}if(responsiveWidth<totalWidth){if(responsiveWidth<config.width){config.width=responsiveWidth;if(config.legendStyle!==null){if(config.legendStyle.position=="right"){config.legendStyle.position="bottom";legendWidth=config.width;legendHeight=10}else{if(config.width<legendWidth){legendWidth=config.width}}}}else{if(config.legendStyle!==null){if(config.legendStyle.position=="right"){var legendLen=(config.ykeys[0].length*10)+5;var diff=responsiveWidth-config.width;if(diff>legendLen){legendWidth=diff}else{config.legendStyle.position="bottom";legendWidth=config.width;legendHeight=10}}else{legendWidth=responsiveWidth}}}}}config.hasNamedColors=UTILS.isOrdinalScaleWithNames(config.colors);if(config.ykeys.length==1){config.barStyle=UTILS.CONSTANTS.SIMPLE_BARS}else{config.barStyle=UTILS.CONSTANTS.GROUPED_BARS}config.x=config.data.map(function(d){return d[config.xkey]});config.y=config.data.map(function(d){return config.ykeys.map(function(k){return d[k]})});config.legends=config.ykeys;var max=0;for(var i=0;i<config.y.length;i++){var d3max=d3.max(config.y[i],function(d){return +d});if(d3max>max){max=d3max}}var margin={left:5,right:5,top:10,bottom:5};var chartXTopPadding=0,chartYLeftPadding=0;if(config.legendStyle!=null){if(config.legendStyle.position=="left"){chartYLeftPadding+=legendWidth}else{if(config.legendStyle.position=="top"){chartXTopPadding+=legendHeight}}}var xAxisPadding=0;if(config.hAxis!==null){if(config.hAxis.position=="out"){xAxisPadding+=25}else{if(config.hAxis.position=="in"){xAxisPadding+=10}}if(config.hAxis.label!==""){xAxisPadding+=20}margin.left+=5;margin.right+=10}var yAxisPadding=0;if(config.vAxis!==null){if(config.vAxis.position=="out"){yAxisPadding+=40}else{if(config.vAxis.position=="in"){yAxisPadding+=5}}if(config.vAxis.label!==""){yAxisPadding+=20}}var actualChartWidth=config.width-yAxisPadding-margin.left-margin.right;var actualChartHeight=config.height-xAxisPadding-margin.top-margin.bottom;config.xScale=d3.scale.ordinal().domain(config.x).rangeRoundBands([0,actualChartWidth],0.1);config.yScale=d3.scale.linear().domain([0,max]).range([actualChartHeight,0]);config.hScale=d3.scale.linear().domain([0,max]).range([0,actualChartHeight]);config.m=config.y[0].length;var container=d3.select(chartContainerID);var totalWidth,totalHeight;if(config.legendStyle==null||config.legendStyle.position=="right"){totalWidth=config.width+legendWidth;totalHeight=(config.height>legendHeight)?config.height:legendHeight}else{totalWidth=(config.width>legendWidth)?config.width:legendWidth;totalHeight=config.height+legendHeight}var mainpanel=container.append("svg").attr("class","barchart");var panel=mainpanel.append("g");var spanel=panel.selectAll("g").data(config.y).enter().append("g").attr("class","category").attr("transform",function(d,i){return"translate("+config.xScale(config.x[i])+",0)"}).each(function(d,i){var category=d3.select(this);config._drawBar(d,i,category)});if(config.clickAction!=null){spanel.style("cursor","pointer")}if(config.hAxis!=null){config.hAxis.labelOffset=xAxisPadding-5;var xAxis=UTILS.chart_x_axis().attr("scale",config.xScale).attr("axisStyle",config.hAxis).attr("chartWidth",actualChartWidth).attr("chartHeight",actualChartHeight);xAxis(panel);var xAxisHeight=xAxis.get("requiredHeight");if(xAxisHeight>xAxisPadding){totalHeight=totalHeight-xAxisPadding+xAxisHeight;xAxisPadding=xAxisHeight}}if(config.vAxis!=null){config.vAxis.labelOffset=yAxisPadding-10;if(config.vAxis.ticks=="default"){config.vAxis.ticks=((actualChartHeight/100)*3)}var yAxis=UTILS.chart_y_axis().attr("scale",config.yScale).attr("axisStyle",config.vAxis).attr("chartWidth",actualChartWidth).attr("chartHeight",actualChartHeight);yAxis(panel)}if(config.legendStyle!=null){var actualLegendWidth,actualLegendHeight;if(config.legendStyle.position=="right"){actualLegendWidth=legendWidth-margin.right;actualLegendHeight=legendHeight-margin.top}else{if(config.legendStyle.position=="top"){actualLegendWidth=legendWidth-margin.left;if(actualLegendWidth>actualChartWidth){actualLegendWidth-=yAxisPadding}actualLegendHeight=legendHeight-margin.top}else{actualLegendWidth=legendWidth-margin.left;if(actualLegendWidth>actualChartWidth){actualLegendWidth-=yAxisPadding}actualLegendHeight=legendHeight-margin.bottom}}var llegends;if(config.barStyle==UTILS.CONSTANTS.GROUPED_BARS){llegends=config.legends}else{llegends=config.data.map(function(d){return d[config.xkey]+" ("+(+d[config.ykeys[0]])+")"})}var chart_legends=UTILS.chart_legends().attr("data",llegends).attr("actualNames",config.x).attr("colors",config.colors).attr("width",actualLegendWidth).attr("height",actualLegendHeight).attr("dotType","circle");if(config.legendStyle.position=="right"){chart_legends.attr("x",(margin.left+actualChartWidth+yAxisPadding+margin.right*2)).attr("y",margin.top)}else{if(config.legendStyle.position=="top"){chart_legends.attr("x",(margin.left+yAxisPadding)).attr("y",(margin.top))}else{chart_legends.attr("x",(margin.left+yAxisPadding)).attr("y",(margin.top+actualChartHeight+xAxisPadding+margin.bottom*2))}}chart_legends(mainpanel);var newLegendWidth=chart_legends.attr("requiredTotalWidth");var newLegendHeight=chart_legends.attr("requiredTotalHeight");if(config.legendStyle.position=="right"){if(newLegendWidth>legendWidth){totalWidth=totalWidth-legendWidth+newLegendWidth}if(newLegendHeight>totalHeight){totalHeight=newLegendHeight}}else{if(newLegendWidth>totalWidth){totalWidth=newLegendWidth}if(newLegendHeight>legendHeight){totalHeight=totalHeight-legendHeight+newLegendHeight}}if(config.legendStyle.position=="top"){chartXTopPadding=chartXTopPadding-legendHeight+newLegendHeight}}mainpanel.attr("width",totalWidth).attr("height",totalHeight);panel.attr("transform","translate("+(margin.left+yAxisPadding)+","+(margin.top+chartXTopPadding)+")")};config._drawBar=function(p,q,parent){var bar=parent.selectAll(".chart").data(p).enter().append("rect").attr("class","bar").attr("y",function(d,i){return config.yScale(d)}).attr("x",function(d,i){return i*config.xScale.rangeBand()/config.m}).attr("width",function(d){return config.xScale.rangeBand()/config.m}).attr("height",function(d){return config.hScale(d)}).style("fill",function(d,i){if(config.barStyle==UTILS.CONSTANTS.GROUPED_BARS){return config.colors(i)}else{return config.hasNamedColors?config.colors(config.x[q]):config.colors(q)}});if(config.tooltip!=null){bar.on("mouseover",function(d,i){content=config.x[q]+"<br/>"+config.legends[i]+" = <b>"+d+"</b>";config.customTooltip.showTooltip(content,(d3.event||window.event))}).on("mouseout",function(d,i){config.customTooltip.hideTooltip()})}if(config.clickAction!=null){bar.on("click",function(d,i){var actionType=config.clickAction.actionType;var actionTarget=config.clickAction.actionTarget;var actionUrl=config.clickAction.actionUrl;var actionUrlParams="data="+config.x[q]+","+d+"&keys="+config.xkey+","+config.legends[i];if(actionType=="callback"){eval(actionTarget+"(config.x[q],d)")}else{UTILS.executeClickAction(actionType,actionTarget,actionUrl,actionUrlParams)}return})}};return config};
// chart_bar_horizontal.js
function chart_bar_horizontal(){var a=_bar_horizontal_chart_config();var b=function(c){try{a.drawChart(c)}catch(d){UTILS.appendErrMsg(c,d);throw d}};b.data=function(c){if(!arguments.length){return a.data}a.data=c;return b};b.keys=function(c){if(!arguments.length){return a.keys}a.keys=c;return b};b.legendStyle=function(c){if(!arguments.length){return a.legendStyle}a.legendStyle=c;return b};b.chartStyle=function(c){if(!arguments.length){return a.chartStyle}a.chartStyle=c;return b};b.hAxis=function(c){if(!arguments.length){return a.hAxis}a.hAxis=c;return b};b.vAxis=function(c){if(!arguments.length){return a.vAxis}a.vAxis=c;return b};b.colors=function(c){if(!arguments.length){return a.colors}a.colors=c;return b};b.tooltip=function(c){if(!arguments.length){return a.tooltip}a.tooltip=c;return b};b.clickAction=function(c){if(!arguments.length){return a.clickAction}a.clickAction=c;return b};b.responsiveWidth=function(c){if(!arguments.length){return a.responsiveWidth}a.responsiveWidth=c;return b};return b}function _bar_horizontal_chart_config(){var config={chartType:"bar",barStyle:UTILS.CONSTANTS.GROUPED_BARS,data:[],keys:null,legendStyle:[],chartStyle:[],colors:d3.scale.category20(),hAxis:null,vAxis:null,tooltip:[],responsiveWidth:0,clickAction:null};config.drawChart=function(chartContainerID){config.uniqueid=chartContainerID.substring(1);config.xkey=config.keys[0];config.ykeys=(typeof config.keys[1]==="string")?[config.keys[1]]:config.keys[1];config.width=parseInt(config.chartStyle.width);config.height=parseInt(config.chartStyle.height);if(config.tooltip!=null){config.customTooltip=UTILS.customTooltip(config.uniqueid+"_tooltip",config.tooltip.width,config.tooltip.height)}var legendWidth=0;var legendHeight=0;if(config.legendStyle!==null){legendWidth=parseInt(config.legendStyle.width);legendHeight=parseInt(config.legendStyle.height)}var responsiveWidth=parseInt(config.responsiveWidth);if(responsiveWidth>0){var totalWidth;if(config.legendStyle==null||config.legendStyle.position=="right"){totalWidth=config.width+legendWidth}else{totalWidth=(config.width>legendWidth)?config.width:legendWidth}if(responsiveWidth<totalWidth){if(responsiveWidth<config.width){config.width=responsiveWidth;if(config.legendStyle!==null){if(config.legendStyle.position=="right"){config.legendStyle.position="bottom";legendWidth=config.width;legendHeight=10}else{if(config.width<legendWidth){legendWidth=config.width}}}}else{if(config.legendStyle!==null){if(config.legendStyle.position=="right"){var legendLen=(config.ykeys[0].length*10)+5;var diff=responsiveWidth-config.width;if(diff>legendLen){legendWidth=diff}else{config.legendStyle.position="bottom";legendWidth=config.width;legendHeight=10}}else{legendWidth=responsiveWidth}}}}}config.hasNamedColors=UTILS.isOrdinalScaleWithNames(config.colors);if(config.ykeys.length==1){config.barStyle=UTILS.CONSTANTS.SIMPLE_BARS}else{config.barStyle=UTILS.CONSTANTS.GROUPED_BARS}config.y=config.data.map(function(d){return d[config.xkey]});config.x=config.data.map(function(d){return config.ykeys.map(function(k){return d[k]})});config.legends=config.ykeys;var max=0;for(var i=0;i<config.y.length;i++){var d3max=d3.max(config.x[i],function(d){return +d});if(d3max>max){max=d3max}}var margin={left:5,right:5,top:10,bottom:5};var chartXTopPadding=0,chartYLeftPadding=0;if(config.legendStyle!=null){if(config.legendStyle.position=="left"){chartYLeftPadding+=legendWidth}else{if(config.legendStyle.position=="top"){chartXTopPadding+=legendHeight}}}var xAxisPadding=0;if(config.hAxis!==null){if(config.hAxis.position=="out"){xAxisPadding+=25}else{if(config.hAxis.position=="in"){xAxisPadding+=10}}if(config.hAxis.label!==""){xAxisPadding+=20}margin.left+=5;margin.right+=10}var yAxisPadding=0;if(config.vAxis!==null){if(config.vAxis.position=="out"){yAxisPadding+=40}else{if(config.vAxis.position=="in"){yAxisPadding+=5}}if(config.vAxis.label!==""){yAxisPadding+=20}}var actualChartWidth=config.width-yAxisPadding-margin.left-margin.right;var actualChartHeight=config.height-xAxisPadding-margin.top-margin.bottom;config.xScale=d3.scale.linear().domain([0,max]).range([0,actualChartWidth]);config.yScale=d3.scale.ordinal().domain(config.y).rangeRoundBands([0,actualChartHeight],0.1);config.hScale=d3.scale.linear().domain([0,max]).range([0,actualChartWidth]);config.m=config.x[0].length;var container=d3.select(chartContainerID);var totalWidth,totalHeight;if(config.legendStyle==null||config.legendStyle.position=="right"){totalWidth=config.width+legendWidth;totalHeight=(config.height>legendHeight)?config.height:legendHeight}else{totalWidth=(config.width>legendWidth)?config.width:legendWidth;totalHeight=config.height+legendHeight}var mainpanel=container.append("svg").attr("class","barchart");var panel=mainpanel.append("g");var spanel=panel.selectAll("g").data(config.x).enter().append("g").attr("class","category").attr("transform",function(d,i){return"translate(0,"+config.yScale(config.y[i])+")"}).each(function(d,i){var category=d3.select(this);config._drawBar(d,i,category)});if(config.clickAction!=null){spanel.style("cursor","pointer")}if(config.hAxis!=null){config.hAxis.labelOffset=xAxisPadding-5;if(config.hAxis.ticks=="default"){config.hAxis.ticks=((actualChartWidth/100)*3)}var xAxis=UTILS.chart_x_axis_horizontal().attr("scale",config.xScale).attr("axisStyle",config.hAxis).attr("chartWidth",actualChartWidth).attr("chartHeight",actualChartHeight);xAxis(panel)}if(config.vAxis!=null){config.vAxis.labelOffset=yAxisPadding-10;var yAxis=UTILS.chart_y_axis().attr("scale",config.yScale).attr("axisStyle",config.vAxis).attr("chartWidth",actualChartWidth).attr("chartHeight",actualChartHeight);yAxis(panel)}if(config.legendStyle!=null){var actualLegendWidth,actualLegendHeight;if(config.legendStyle.position=="right"){actualLegendWidth=legendWidth-margin.right;actualLegendHeight=legendHeight-xAxisPadding-margin.top}else{if(config.legendStyle.position=="top"){actualLegendWidth=legendWidth-margin.left;if(actualLegendWidth>actualChartWidth){actualLegendWidth-=yAxisPadding}actualLegendHeight=legendHeight-margin.top}else{actualLegendWidth=legendWidth-margin.left;if(actualLegendWidth>actualChartWidth){actualLegendWidth-=yAxisPadding}actualLegendHeight=legendHeight-margin.bottom}}var llegends;if(config.barStyle==UTILS.CONSTANTS.GROUPED_BARS){llegends=config.legends}else{llegends=config.data.map(function(d){return d[config.xkey]+" ("+(+d[config.ykeys[0]])+")"})}var chart_legends=UTILS.chart_legends().attr("data",llegends).attr("actualNames",config.y).attr("colors",config.colors).attr("width",actualLegendWidth).attr("height",actualLegendHeight).attr("dotType","circle");if(config.legendStyle.position=="right"){chart_legends.attr("x",(margin.left+actualChartWidth+yAxisPadding+margin.right*2)).attr("y",(margin.top+xAxisPadding))}else{if(config.legendStyle.position=="top"){chart_legends.attr("x",(margin.left+yAxisPadding)).attr("y",(margin.top))}else{chart_legends.attr("x",(margin.left+yAxisPadding)).attr("y",(margin.top+actualChartHeight+xAxisPadding+margin.bottom*2))}}chart_legends(mainpanel);var newLegendWidth=chart_legends.attr("requiredTotalWidth");var newLegendHeight=chart_legends.attr("requiredTotalHeight");if(config.legendStyle.position=="right"){if(newLegendWidth>legendWidth){totalWidth=totalWidth-legendWidth+newLegendWidth}if(newLegendHeight>totalHeight){totalHeight=newLegendHeight}}else{if(newLegendWidth>totalWidth){totalWidth=newLegendWidth}if(newLegendHeight>legendHeight){totalHeight=totalHeight-legendHeight+newLegendHeight}}if(config.legendStyle.position=="top"){chartXTopPadding=chartXTopPadding-legendHeight+newLegendHeight}}mainpanel.attr("width",totalWidth).attr("height",totalHeight);panel.attr("transform","translate("+(margin.left+yAxisPadding)+","+(margin.top+xAxisPadding+chartXTopPadding)+")")};config._drawBar=function(p,q,parent){var bar=parent.selectAll(".chart").data(p).enter().append("rect").attr("class","bar").attr("y",function(d,i){return(i*config.yScale.rangeBand()/config.m)}).attr("x",function(d,i){return 0}).attr("width",function(d){return config.xScale(d)}).attr("height",function(d){return config.yScale.rangeBand()/config.m}).style("fill",function(d,i){if(config.barStyle==UTILS.CONSTANTS.GROUPED_BARS){return config.colors(i)}else{return config.hasNamedColors?config.colors(config.y[q]):config.colors(q)}});if(config.tooltip!=null){bar.on("mouseover",function(d,i){content=config.y[q]+"<br/>"+config.legends[i]+" = <b>"+d+"</b>";config.customTooltip.showTooltip(content,(d3.event||window.event))}).on("mouseout",function(d,i){config.customTooltip.hideTooltip()})}if(config.clickAction!=null){bar.on("click",function(d,i){var actionType=config.clickAction.actionType;var actionTarget=config.clickAction.actionTarget;var actionUrl=config.clickAction.actionUrl;var actionUrlParams="data="+config.y[q]+","+d+"&keys="+config.xkey+","+config.legends[i];if(actionType=="callback"){eval(actionTarget+"(config.y[q],d)")}else{UTILS.executeClickAction(actionType,actionTarget,actionUrl,actionUrlParams)}return})}};return config};
// chart_bar_stacked.js
function chart_bar_stacked(){var a=_bar_stacked_chart_config();var b=function(c){try{a.drawChart(c)}catch(d){UTILS.appendErrMsg(c,d);throw d}};b.data=function(c){if(!arguments.length){return a.data}a.data=c;return b};b.keys=function(c){if(!arguments.length){return a.keys}a.keys=c;return b};b.legendStyle=function(c){if(!arguments.length){return a.legendStyle}a.legendStyle=c;return b};b.chartStyle=function(c){if(!arguments.length){return a.chartStyle}a.chartStyle=c;return b};b.hAxis=function(c){if(!arguments.length){return a.hAxis}a.hAxis=c;return b};b.vAxis=function(c){if(!arguments.length){return a.vAxis}a.vAxis=c;return b};b.colors=function(c){if(!arguments.length){return a.colors}a.colors=c;return b};b.tooltip=function(c){if(!arguments.length){return a.tooltip}a.tooltip=c;return b};b.clickAction=function(c){if(!arguments.length){return a.clickAction}a.clickAction=c;return b};b.responsiveWidth=function(c){if(!arguments.length){return a.responsiveWidth}a.responsiveWidth=c;return b};return b}function _bar_stacked_chart_config(){var config={chartType:"bar_stacked",data:[],keys:null,legendStyle:[],chartStyle:[],colors:d3.scale.category20(),hAxis:null,vAxis:null,tooltip:[],responsiveWidth:0,clickAction:null};config.drawChart=function(chartContainerID){config.uniqueid=chartContainerID.substring(1);config.xkey=config.keys[0];config.ykeys=(typeof config.keys[1]==="string")?[config.keys[1]]:config.keys[1];config.width=parseInt(config.chartStyle.width);config.height=parseInt(config.chartStyle.height);if(config.tooltip!=null){config.customTooltip=UTILS.customTooltip(config.uniqueid+"_tooltip",config.tooltip.width,config.tooltip.height)}var legendWidth=0;var legendHeight=0;if(config.legendStyle!==null){legendWidth=parseInt(config.legendStyle.width);legendHeight=parseInt(config.legendStyle.height)}var responsiveWidth=parseInt(config.responsiveWidth);if(responsiveWidth>0){var totalWidth;if(config.legendStyle==null||config.legendStyle.position=="right"){totalWidth=config.width+legendWidth}else{totalWidth=(config.width>legendWidth)?config.width:legendWidth}if(responsiveWidth<totalWidth){if(responsiveWidth<config.width){config.width=responsiveWidth;if(config.legendStyle!==null){if(config.legendStyle.position=="right"){config.legendStyle.position="bottom";legendWidth=config.width;legendHeight=10}else{if(config.width<legendWidth){legendWidth=config.width}}}}else{if(config.legendStyle!==null){if(config.legendStyle.position=="right"){var legendLen=(config.ykeys[0].length*10)+5;var diff=responsiveWidth-config.width;if(diff>legendLen){legendWidth=diff}else{config.legendStyle.position="bottom";legendWidth=config.width;legendHeight=10}}else{legendWidth=responsiveWidth}}}}}config.hasNamedColors=UTILS.isOrdinalScaleWithNames(config.colors);config.x=config.data.map(function(d){return d[config.xkey]});config.y=config.data.map(function(d){return config.ykeys.map(function(k){return d[k]})});config.legends=config.ykeys;var max=0;config.ymax=0;config.ylegendMaxLen=0;config.dataLayers=config.ykeys.map(function(name,i){var l=name.length;if(l>config.ylegendMaxLen){config.ylegendMaxLen=l}return config.data.map(function(d){var yvalue=+d[name];if(yvalue>config.ymax){config.ymax=yvalue}return{x:d[config.xkey],y:yvalue,i:i}})});config.stackedData=d3.layout.stack()(config.dataLayers);config.yStackMax=d3.max(config.stackedData,function(data){return d3.max(data,function(d){return d.y0+d.y})});max=config.yStackMax;var margin={left:5,right:5,top:10,bottom:5};var chartXTopPadding=0,chartYLeftPadding=0;if(config.legendStyle!=null){if(config.legendStyle.position=="left"){chartYLeftPadding+=legendWidth}else{if(config.legendStyle.position=="top"){chartXTopPadding+=legendHeight}}}var xAxisPadding=0;if(config.hAxis!==null){if(config.hAxis.position=="out"){xAxisPadding+=25}else{if(config.hAxis.position=="in"){xAxisPadding+=10}}if(config.hAxis.label!==""){xAxisPadding+=20}margin.left+=5;margin.right+=10}var yAxisPadding=0;if(config.vAxis!==null){if(config.vAxis.position=="out"){yAxisPadding+=40}else{if(config.vAxis.position=="in"){yAxisPadding+=5}}if(config.vAxis.label!==""){yAxisPadding+=20}}var actualChartWidth=config.width-yAxisPadding-margin.left-margin.right;var actualChartHeight=config.height-xAxisPadding-margin.top-margin.bottom;config.xScale=d3.scale.ordinal().domain(config.x).rangeRoundBands([0,actualChartWidth],0.1);config.yScale=d3.scale.linear().domain([0,max]).range([actualChartHeight,0]);config.m=config.y[0].length;var container=d3.select(chartContainerID);var totalWidth,totalHeight;if(config.legendStyle==null||config.legendStyle.position=="right"){totalWidth=config.width+legendWidth;totalHeight=(config.height>legendHeight)?config.height:legendHeight}else{totalWidth=(config.width>legendWidth)?config.width:legendWidth;totalHeight=config.height+legendHeight}var mainpanel=container.append("svg").attr("class","barchart");var panel=mainpanel.append("g");spanel=panel.selectAll("g").data(config.stackedData).enter().append("g").attr("class","category").style("fill",function(d,i){return config.hasNamedColors?config.colors(config.ykeys[i]):config.colors(i)}).each(function(d,i){var category=d3.select(this);config._drawBar(d,i,category)});if(config.clickAction!=null){spanel.style("cursor","pointer")}if(config.hAxis!=null){config.hAxis.labelOffset=xAxisPadding-5;var xAxis=UTILS.chart_x_axis().attr("scale",config.xScale).attr("axisStyle",config.hAxis).attr("chartWidth",actualChartWidth).attr("chartHeight",actualChartHeight);xAxis(panel);var xAxisHeight=xAxis.get("requiredHeight");if(xAxisHeight>xAxisPadding){totalHeight=totalHeight-xAxisPadding+xAxisHeight;xAxisPadding=xAxisHeight}}if(config.vAxis!=null){config.vAxis.labelOffset=yAxisPadding-10;if(config.vAxis.ticks=="default"){config.vAxis.ticks=((actualChartHeight/100)*3)}var yAxis=UTILS.chart_y_axis().attr("scale",config.yScale).attr("axisStyle",config.vAxis).attr("chartWidth",actualChartWidth).attr("chartHeight",actualChartHeight);yAxis(panel)}if(config.legendStyle!=null){var actualLegendWidth,actualLegendHeight;if(config.legendStyle.position=="right"){actualLegendWidth=legendWidth-margin.right;actualLegendHeight=legendHeight-margin.top}else{if(config.legendStyle.position=="top"){actualLegendWidth=legendWidth-margin.left;if(actualLegendWidth>actualChartWidth){actualLegendWidth-=yAxisPadding}actualLegendHeight=legendHeight-margin.top}else{actualLegendWidth=legendWidth-margin.left;if(actualLegendWidth>actualChartWidth){actualLegendWidth-=yAxisPadding}actualLegendHeight=legendHeight-margin.bottom}}var chart_legends=UTILS.chart_legends().attr("data",config.legends).attr("colors",config.colors).attr("width",actualLegendWidth).attr("height",actualLegendHeight).attr("dotType","circle");if(config.legendStyle.position=="right"){chart_legends.attr("x",(margin.left+actualChartWidth+yAxisPadding+margin.right*2)).attr("y",margin.top)}else{if(config.legendStyle.position=="top"){chart_legends.attr("x",(margin.left+yAxisPadding)).attr("y",(margin.top))}else{chart_legends.attr("x",(margin.left+yAxisPadding)).attr("y",(margin.top+actualChartHeight+xAxisPadding+margin.bottom*2))}}chart_legends(mainpanel);var newLegendWidth=chart_legends.attr("requiredTotalWidth");var newLegendHeight=chart_legends.attr("requiredTotalHeight");if(config.legendStyle.position=="right"){if(newLegendWidth>legendWidth){totalWidth=totalWidth-legendWidth+newLegendWidth}if(newLegendHeight>totalHeight){totalHeight=newLegendHeight}}else{if(newLegendWidth>totalWidth){totalWidth=newLegendWidth}if(newLegendHeight>legendHeight){totalHeight=totalHeight-legendHeight+newLegendHeight}}if(config.legendStyle.position=="top"){chartXTopPadding=chartXTopPadding-legendHeight+newLegendHeight}}mainpanel.attr("width",totalWidth).attr("height",totalHeight);panel.attr("transform","translate("+(margin.left+yAxisPadding)+","+(margin.top+chartXTopPadding)+")")};config._drawBar=function(p,q,parent){var bar=parent.selectAll("rect").data(p).enter().append("rect").attr("class","bar").attr("x",function(d){return config.xScale(d.x)}).attr("y",function(d){return config.yScale(d.y0+d.y)}).attr("width",config.xScale.rangeBand()).attr("height",function(d){return(config.yScale(d.y0)-config.yScale(d.y0+d.y))});if(config.tooltip!=null){bar.on("mouseover",function(d,i){content=d.x+"<br/>"+config.legends[q]+" = <b>"+d.y+"</b>";config.customTooltip.showTooltip(content,(d3.event||window.event))}).on("mouseout",function(d,i){config.customTooltip.hideTooltip()})}if(config.clickAction!=null){bar.on("click",function(d,i){var actionType=config.clickAction.actionType;var actionTarget=config.clickAction.actionTarget;var actionUrl=config.clickAction.actionUrl;var actionUrlParams="data="+d.x+","+d.y+"&keys="+config.xkey+","+config.legends[q];if(actionType=="callback"){eval(actionTarget+"(d.x,d.y,config.legends[q])")}else{UTILS.executeClickAction(actionType,actionTarget,actionUrl,actionUrlParams)}return})}};return config};
// chart_bubble.js
function chart_bubble(){var a=_bubble_chart_config();var b=function(c){try{a.drawChart(c)}catch(d){UTILS.appendErrMsg(c,d);throw d}};b.data=function(c){if(!arguments.length){return a.data}a.data=c;return b};b.keys=function(c){if(!arguments.length){return a.keys}a.keys=c;return b};b.chartStyle=function(c){if(!arguments.length){return a.chartStyle}a.chartStyle=c;return b};b.colors=function(c){if(!arguments.length){return a.colors}a.colors=c;return b};b.tooltip=function(c){if(!arguments.length){return a.tooltip}a.tooltip=c;return b};b.clickAction=function(c){if(!arguments.length){return a.clickAction}a.clickAction=c;return b};b.responsiveWidth=function(c){if(!arguments.length){return a.responsiveWidth}a.responsiveWidth=c;return b};return b}function _bubble_chart_config(){var config={chartType:"bubble",data:[],keys:[],chartStyle:[],colors:d3.scale.category20(),tooltip:null,clickAction:null};config.drawChart=function(chartContainerID){config.uniqueid=chartContainerID.substring(1);if(config.tooltip!=null){config.customTooltip=UTILS.customTooltip(config.uniqueid+"_tooltip",config.tooltip.width,config.tooltip.height)}config.width=parseInt(config.chartStyle.width);config.height=parseInt(config.chartStyle.height);var responsiveWidth=parseInt(config.responsiveWidth);if(responsiveWidth>0&&responsiveWidth<config.width){config.width=responsiveWidth}var jsonData={name:"wordCloud",children:config.data};var format=d3.format(",g");var fill=config.colors;var bubble=d3.layout.pack().sort(null).size([config.width,config.height]);var container=d3.select(chartContainerID);var vis=container.append("svg").attr("width",config.width).attr("height",config.height).attr("class","bubble");var toClasses=function(root,keyList){var classes=[];function recurse(name,node){if(node.children){node.children.forEach(function(child){recurse(node[keyList[0]],child)})}else{classes.push({packageName:node[keyList[0]],className:node[keyList[0]],value:node[keyList[1]]})}}recurse(null,root);return{children:classes}};var classes=toClasses(jsonData,config.keys);var node=vis.selectAll(".node").data(bubble.nodes(classes).filter(function(d){return !d.children})).enter().append("g").attr("class","node").attr("transform",function(d){return"translate("+d.x+","+d.y+")"});if(config.tooltip!=null){node.on("mouseover",function(d,i){content=d.className+"<br/><b>"+format(+d.value)+"</b>";config.customTooltip.showTooltip(content,(d3.event||window.event))}).on("mouseout",function(d,i){config.customTooltip.hideTooltip()})}if(config.clickAction!=null){node.style("cursor","pointer");node.on("click",function(d,i){var actionType=config.clickAction.actionType;var actionTarget=config.clickAction.actionTarget;var actionUrl=config.clickAction.actionUrl;var actionUrlParams="data="+d.className+","+d.value+"&keys="+config.keys[0]+","+config.keys[1];if(actionType=="callback"){eval(actionTarget+"(d.className,d.value)")}else{UTILS.executeClickAction(actionType,actionTarget,actionUrl,actionUrlParams)}return})}node.append("circle").attr("r",function(d){return d.r}).style("fill",function(d){return fill(d.className)});node.append("text").attr("text-anchor","middle").attr("dy",".3em").text(function(d){return d.className.substring(0,d.r/4)}).style("font","12px Verdana")};return config};
// chart_line.js
function chart_line(){var a=_line_chart_config();var b=function(c){try{a.drawChart(c)}catch(d){UTILS.appendErrMsg(c,d);throw d}};b.data=function(c){if(!arguments.length){return a.data}a.data=c;return b};b.keys=function(c){if(!arguments.length){return a.keys}a.keys=c;return b};b.legendStyle=function(c){if(!arguments.length){return a.legendStyle}a.legendStyle=c;return b};b.chartStyle=function(c){if(!arguments.length){return a.chartStyle}a.chartStyle=c;return b};b.hAxis=function(c){if(!arguments.length){return a.hAxis}a.hAxis=c;return b};b.vAxis=function(c){if(!arguments.length){return a.vAxis}a.vAxis=c;return b};b.colors=function(c){if(!arguments.length){return a.colors}a.colors=c;return b};b.tooltip=function(c){if(!arguments.length){return a.tooltip}a.tooltip=c;return b};b.clickAction=function(c){if(!arguments.length){return a.clickAction}a.clickAction=c;return b};b.responsiveWidth=function(c){if(!arguments.length){return a.responsiveWidth}a.responsiveWidth=c;return b};return b}function _line_chart_config(){var config={chartType:"line",data:[],keys:null,legendStyle:[],chartStyle:[],colors:d3.scale.category20(),hAxis:null,vAxis:null,tooltip:[],responsiveWidth:0,clickAction:null,isDate:false};config.drawChart=function(chartContainerID){config.uniqueid=chartContainerID.substring(1);config.xkey=config.keys[0];config.ykeys=(typeof config.keys[1]==="string")?[config.keys[1]]:config.keys[1];config.width=parseInt(config.chartStyle.width);config.height=parseInt(config.chartStyle.height);if(config.tooltip!=null){config.customTooltip=UTILS.customTooltip(config.uniqueid+"_tooltip",config.tooltip.width,config.tooltip.height)}if(config.hAxis){config.isDate=UTILS.parseBool(config.hAxis.isDate)}config.dataPoints=UTILS.parseBool(config.chartStyle.dataPoints);config.lineWidth=UTILS.parseInt(config.chartStyle.lineWidth);config.hasNamedColors=UTILS.isOrdinalScaleWithNames(config.colors);var legendWidth=0;var legendHeight=0;if(config.legendStyle!==null){legendWidth=parseInt(config.legendStyle.width);legendHeight=parseInt(config.legendStyle.height)}var responsiveWidth=parseInt(config.responsiveWidth);if(responsiveWidth>0){var totalWidth;if(config.legendStyle==null||config.legendStyle.position=="right"){totalWidth=config.width+legendWidth}else{totalWidth=(config.width>legendWidth)?config.width:legendWidth}if(responsiveWidth<totalWidth){if(responsiveWidth<config.width){config.width=responsiveWidth;if(config.legendStyle!==null){if(config.legendStyle.position=="right"){config.legendStyle.position="bottom";legendWidth=config.width;legendHeight=10}else{if(config.width<legendWidth){legendWidth=config.width}}}}else{if(config.legendStyle!==null){if(config.legendStyle.position=="right"){var legendLen=(config.ykeys[0].length*10)+5;var diff=responsiveWidth-config.width;if(diff>legendLen){legendWidth=diff}else{config.legendStyle.position="bottom";legendWidth=config.width;legendHeight=10}}else{legendWidth=responsiveWidth}}}}}config.x=config.data.map(function(d){return d[config.xkey]});config.y=config.data.map(function(d){return config.ykeys.map(function(k){return d[k]})});config.y1=config.ykeys.map(function(k){return config.data.map(function(d){return d[k]})});config.legends=config.ykeys;var ymin=9999999;for(var i=0;i<config.y.length;i++){var pvmin=d3.min(config.y[i]);if(pvmin<ymin){ymin=pvmin}}var ymax=-9999;for(var i=0;i<config.y.length;i++){var pvmax=d3.max(config.y[i],function(d){return +d});if(pvmax>ymax){ymax=pvmax}}var margin={left:5,right:5,top:10,bottom:5};var chartXTopPadding=0,chartYLeftPadding=0;if(config.legendStyle!=null){if(config.legendStyle.position=="left"){chartYLeftPadding+=legendWidth}else{if(config.legendStyle.position=="top"){chartXTopPadding+=legendHeight}}}var xAxisPadding=0;if(config.hAxis!==null){if(config.hAxis.position=="out"){xAxisPadding+=25}else{if(config.hAxis.position=="in"){xAxisPadding+=10}}if(config.hAxis.label!==""){xAxisPadding+=20}margin.left+=5;margin.right+=15}var yAxisPadding=0;if(config.vAxis!==null){var legendLen=(config.ykeys[config.ykeys.length-1].length/2)+5;margin.right+=legendLen;if(config.vAxis.position=="out"){yAxisPadding+=40}else{if(config.vAxis.position=="in"){yAxisPadding+=5}}if(config.vAxis.label!==""){yAxisPadding+=20}}var xAxisOffset=0;if(!config.isDate&&config.hAxis!=null){if(config.vAxis==null){yAxisPadding+=((""+config.x[0]).length*3)}xAxisPadding+=((""+config.x[config.x.length-1]).length*2)}if(config.dataPoints){config.dotRadius=(config.lineWidth+1);if(config.vAxis==null){yAxisPadding+=config.dotRadius+1}if(config.hAxis==null){xAxisPadding+=config.dotRadius;if(config.legendStyle==null||config.legendStyle.position!="bottom"){xAxisPadding+=3}}}var actualChartWidth=config.width-yAxisPadding-margin.left-margin.right;var actualChartHeight=config.height-xAxisPadding-margin.top-margin.bottom;if(!config.isDate){config.xScale=d3.scale.ordinal().domain(config.x).rangePoints([0,actualChartWidth])}else{config.xScale=d3.time.scale.utc().domain([d3.min(config.x),d3.max(config.x)]).range([0,actualChartWidth])}config.yScale=d3.scale.linear().domain([ymin,ymax]).range([actualChartHeight,0]);config.m=config.y[0].length;var container=d3.select(chartContainerID);var totalWidth,totalHeight;if(config.legendStyle==null||config.legendStyle.position=="right"){totalWidth=config.width+legendWidth;totalHeight=(config.height>legendHeight)?config.height:legendHeight}else{totalWidth=(config.width>legendWidth)?config.width:legendWidth;totalHeight=config.height+legendHeight}var mainpanel=container.append("svg").attr("class","linechart");var panel=mainpanel.append("g");var spanel=panel.append("g").attr("transform",function(d,i){return"translate(0,0)"}).attr("class","chartdisplay");var line=d3.svg.line().x(function(d,i){return config.xScale(config.x[i])}).y(function(d,i){return config.yScale(d)}).interpolate(config.chartStyle.interpolate);var paths=spanel.selectAll("g.path").data(config.y1).enter().append("g").attr("class","path").each(function(d,i){var path=d3.select(this);config.dot(d,i,path)});paths.append("svg:path").attr("d",function(d,i){return line(d,i)}).attr("class","svgpath").style("stroke-width",config.lineWidth).style("stroke",function(d,i){return(config.hasNamedColors)?config.colors(config.ykeys[i]):config.colors(i)}).style("fill","none");if(config.clickAction!=null){mainpanel.style("cursor","pointer")}if(config.hAxis!=null){config.hAxis.labelOffset=xAxisPadding-5;if(config.isDate){var tickformat=config.hAxis.tickformat;if(tickformat==null||tickformat=="default"||tickformat==""){config.hAxis.tickformat=UTILS.time.globalizeTimeScaleFormat()}}var xAxis=UTILS.chart_x_axis().attr("scale",config.xScale).attr("axisStyle",config.hAxis).attr("chartWidth",actualChartWidth).attr("chartHeight",actualChartHeight);xAxis(panel);var xAxisHeight=xAxis.get("requiredHeight");if(xAxisHeight>xAxisPadding){totalHeight=totalHeight-xAxisPadding+xAxisHeight;xAxisPadding=xAxisHeight}}if(config.vAxis!=null){config.vAxis.labelOffset=yAxisPadding-10;var yAxis=UTILS.chart_y_axis().attr("scale",config.yScale).attr("axisStyle",config.vAxis).attr("chartWidth",actualChartWidth).attr("chartHeight",actualChartHeight);yAxis(panel)}if(config.legendStyle!=null){var actualLegendWidth,actualLegendHeight;if(config.legendStyle.position=="right"){actualLegendWidth=legendWidth-margin.right;actualLegendHeight=legendHeight-margin.top}else{if(config.legendStyle.position=="top"){actualLegendWidth=legendWidth-margin.left;if(actualLegendWidth>actualChartWidth){actualLegendWidth-=yAxisPadding}actualLegendHeight=legendHeight-margin.top}else{actualLegendWidth=legendWidth-margin.left;if(actualLegendWidth>actualChartWidth){actualLegendWidth-=yAxisPadding}actualLegendHeight=legendHeight-margin.bottom}}var chart_legends=UTILS.chart_legends().attr("data",config.legends).attr("colors",config.colors).attr("width",actualLegendWidth).attr("height",actualLegendHeight);if(config.legendStyle.position=="right"){chart_legends.attr("x",(margin.left+actualChartWidth+yAxisPadding+margin.right)).attr("y",margin.top)}else{if(config.legendStyle.position=="top"){chart_legends.attr("x",(margin.left+yAxisPadding)).attr("y",(margin.top))}else{chart_legends.attr("x",(margin.left+yAxisPadding)).attr("y",(margin.top+actualChartHeight+xAxisPadding+margin.bottom*2))}}chart_legends(mainpanel);var newLegendWidth=chart_legends.attr("requiredTotalWidth");var newLegendHeight=chart_legends.attr("requiredTotalHeight");if(config.legendStyle.position=="right"){if(newLegendWidth>legendWidth){totalWidth=totalWidth-legendWidth+newLegendWidth}if(newLegendHeight>totalHeight){totalHeight=newLegendHeight}}else{if(newLegendWidth>totalWidth){totalWidth=newLegendWidth}if(newLegendHeight>legendHeight){totalHeight=totalHeight-legendHeight+newLegendHeight}}if(config.legendStyle.position=="top"){chartXTopPadding=chartXTopPadding-legendHeight+newLegendHeight}}mainpanel.attr("width",totalWidth).attr("height",totalHeight);panel.attr("transform","translate("+(margin.left+yAxisPadding)+","+(margin.top+chartXTopPadding)+")")};config.dot=function(p,q,path){var point=path.selectAll("g.point").data(function(d){return d}).enter().append("g").attr("class","point");point.append("svg:circle").attr("cx",function(d,i){return config.xScale(config.x[i])}).attr("cy",function(d,i){return config.yScale(d)}).attr("r",config.dotRadius).attr("fill",function(d,i){return(config.hasNamedColors)?config.colors(config.ykeys[q]):config.colors(q)}).attr("fill-opacity",function(d,i){if(config.dataPoints){return 1}else{return 0}});if(config.tooltip!=null){point.on("mouseover",function(d,i){content=config.x[i]+"<br/>"+config.legends[q]+" = <b>"+d+"</b>";config.customTooltip.showTooltip(content,(d3.event||window.event))}).on("mouseout",function(d,i){config.customTooltip.hideTooltip()})}if(config.clickAction!=null){point.on("click",function(d,i){var actionType=config.clickAction.actionType;var actionTarget=config.clickAction.actionTarget;var actionUrl=config.clickAction.actionUrl;var actionUrlParams="data="+config.x[i]+","+config.legend[q]+","+d+"&keys="+config.keys.toString();if(actionType=="callback"){eval(actionTarget+"(config.x[i], config.legend[q], d)")}else{UTILS.executeClickAction(actionType,actionTarget,actionUrl,actionUrlParams)}return})}};return config};
// chart_multiarea.js
function chart_multiarea(){var a=_chart_multiarea_config();var b=function(c){try{a.drawChart(c)}catch(d){UTILS.appendErrMsg(c,d);throw d}};b.data=function(c){if(!arguments.length){return a.data}a.data=c;return b};b.keys=function(c){if(!arguments.length){return a.keys}a.keys=c;return b};b.chartStyle=function(c){if(!arguments.length){return a.chartStyle}a.chartStyle=c;return b};b.hAxis=function(c){if(!arguments.length){return a.hAxis}a.hAxis=c;return b};b.vAxis=function(c){if(!arguments.length){return a.vAxis}a.vAxis=c;return b};b.colors=function(c){if(!arguments.length){return a.colors}a.colors=c;return b};b.clickAction=function(c){if(!arguments.length){return a.clickAction}a.clickAction=c;return b};b.responsiveWidth=function(c){if(!arguments.length){return a.responsiveWidth}a.responsiveWidth=c;return b};return b}function _chart_multiarea_config(){var a={chartType:"multiarea",data:[],keys:null,legendStyle:[],chartStyle:[],colors:d3.scale.category20(),hAxis:null,vAxis:null,margin:{top:10,left:5,right:5,bottom:5},tooltip:[],responsiveWidth:0,clickAction:null,padding:10};a.drawChart=function(n){a.uniqueid=n.substring(1);a.xkey=a.keys[0];a.ykeys=(typeof a.keys[1]==="string")?[a.keys[1]]:a.keys[1];a.width=parseInt(a.chartStyle.width);a.height=parseInt(a.chartStyle.height);var c=parseInt(a.responsiveWidth);if(c>0&&c<a.width){a.width=c}var g=[];var r=[];var j=0;var g=a.ykeys;var v=g.length;var l=a.data[0][a.xkey];var f=a.data[a.data.length-1][a.xkey];var q=(g.length==1);a.data.forEach(function(i){for(var x in i){if(i.hasOwnProperty(x)&&x!=a.xkey){i[x]=parseInt(i[x]);if(i[x]>j){j=i[x]}}}});var b=0;if(a.hAxis!==null){if(a.hAxis.position=="out"){b+=15}else{if(a.hAxis.position=="in"){b+=5}}if(a.hAxis.label!==""){b+=30}if(!q){a.margin.top+=b}a.margin.right+=15;a.margin.left+=10}var e=0;var o=null,s=null;if(a.vAxis!==null){e+=40;if(a.vAxis.label!==""){e+=20;o=a.vAxis.label;s=a.vAxis.labelOffset;s=(s==null)?(e-5):s;a.vAxis.label=""}a.margin.left+=e}var w=a.width-a.margin.left-a.margin.right;var d=a.height-b-a.margin.top-a.margin.bottom-(a.padding*(v-1));var h=a.colors;var m=d3.select(n).append("svg").attr("width",a.width).attr("height",a.height);var k=m.append("g");for(var p=0;p<v;p++){r.push(new a._multiarea({data:a.data.slice(),id:p,name:g[p],width:w,height:d*(1/v),maxDataPoint:j,svg:k,margin:a.margin,showBottomAxis:(p==v-1),showSingleArea:q,fillColor:h(g[p]),uniqueid:a.uniqueid,xkey:a.xkey,xAxisPadding:b}))}if(o!=null){var u=-(d/2)-10;var t=-s;k.append("g").attr("class","y label").append("text").attr("x",u).attr("y",t).attr("text-anchor","middle").attr("transform","rotate(-90)").text(o)}m.attr("width",a.width).attr("height",a.height);k.attr("transform","translate("+a.margin.left+","+a.margin.top+")")};a._multiarea=function(n){this.chartData=n.data;this.width=n.width;this.height=n.height;this.maxDataPoint=n.maxDataPoint;this.svg=n.svg;this.id=n.id;this.name=n.name;this.margin=n.margin;this.showBottomAxis=n.showBottomAxis;this.fillColor=n.fillColor;this.uniqueid=n.uniqueid;this.xkey=n.xkey;this.showSingleArea=n.showSingleArea;var l=n.xAxisPadding;var g=this.name;var i=this.xkey;this.xScale=d3.time.scale.utc().range([0,this.width]).domain(d3.extent(this.chartData.map(function(o){return o[i]})));this.yScale=d3.scale.linear().range([this.height,0]).domain([0,this.maxDataPoint]);var j=this.xScale;var f=this.yScale;this.area=d3.svg.area().interpolate("basis").x(function(o){return j(o[i])}).y0(this.height).y1(function(o){return f(o[g])});this.svg.append("defs").append("clipPath").attr("id","clip-"+this.uniqueid+"-"+this.id).append("rect").attr("width",this.width).attr("height",this.height);this.chartContainer=this.svg.append("g").attr("class",this.name.toLowerCase()).attr("transform","translate(0,"+((this.height*this.id)+(a.padding*this.id))+")");this.chartContainer.append("path").data([this.chartData]).attr("class","chart").style("fill",this.fillColor).attr("clip-path","url(#clip-"+this.uniqueid+"-"+this.id+")").attr("d",this.area);if(a.hAxis!=null){var e=UTILS.getFormater(a.hAxis.tickformat);if(e==null){e=UTILS.time.globalizeTimeScaleFormat()}if(!this.showSingleArea){if(this.id==0){var d=this.chartContainer.append("g");var c=UTILS.chart_x_axis_horizontal().attr("scale",this.xScale).attr("axisStyle",a.hAxis).attr("chartWidth",this.width).attr("chartHeight",this.height).attr("addlClassName","top").attr("labelOffset",l-10);c(d);if(a.hAxis.position=="out"){var k=c.get("requiredHeight");if(k>l){a.height=a.height-l+k+5;a.margin.top=a.margin.top-l+k+5}}}}if(this.showBottomAxis){var d=this.chartContainer.append("g");var c=UTILS.chart_x_axis().attr("scale",this.xScale).attr("axisStyle",a.hAxis).attr("chartWidth",this.width).attr("chartHeight",this.height).attr("addlClassName","bottom").attr("labelOffset",l-5);c(d);if(a.hAxis.position=="out"){var k=c.get("requiredHeight");if(k>l){a.height=a.height-l+k+5}}}}if(a.vAxis!=null){a.vAxis.position="out";var m=this.chartContainer.append("g").attr("transform","translate(-15,0)");var b=UTILS.chart_y_axis().attr("scale",this.yScale).attr("axisStyle",a.vAxis).attr("chartWidth",this.width).attr("chartHeight",this.height);b(m)}var h=(this.height/2);if(this.id==0&&h<40&&(h+10<this.height)){h+=10}this.chartContainer.append("text").attr("class","chart-multiarea-title").attr("transform","translate(15,"+h+")").text(this.name)};return a};
// chart_multigauge.js
var chart_multigauge=function(){var a=_chart_multigauge();var b=function(c){try{a.drawChart(c)}catch(d){UTILS.appendErrMsg(c,d);throw d}};b.data=function(c){if(!arguments.length){return a.data}a.data=c;return b};b.keys=function(c){if(!arguments.length){return a.keys}a.keys=c;return b};b.chartStyle=function(c){if(!arguments.length){return a.chartStyle}a.chartStyle=c;return b};b.legendStyle=function(c){if(!arguments.length){return a.legendStyle}a.legendStyle=c;return b};b.colors=function(c){if(!arguments.length){return a.colors}a.colors=c;return b};b.tooltip=function(c){if(!arguments.length){return a.tooltip}a.tooltip=c;return b};b.clickAction=function(c){if(!arguments.length){return a.clickAction}a.clickAction=c;return b};b.responsiveWidth=function(c){if(!arguments.length){return a.responsiveWidth}a.responsiveWidth=c;return b};return b};var _chart_multigauge=function(){var config={data:[],keys:null,width:800,height:800,outerRadius:60,innerRadius:35,padding:20,colors:d3.scale.ordinal().range(["orange"]),chartStyle:{},legendStyle:null,numFormat:d3.format(".2s"),titleKey:"title",subtitleKey:"subtitle",unusedColor:"#eeeeee"};config.drawChart=function(chartContainerID){config.uniqueid=chartContainerID.substring(1);config.usedKey=config.keys[0];config.totalKey=config.keys[1];if(config.keys.length>2){config.titleKey=config.keys[2]}if(config.keys.length>3){config.subtitleKey=config.keys[3]}config.width=UTILS.parseInt(config.chartStyle.width);config.height=UTILS.parseInt(config.chartStyle.height);if(config.height==0){config.height=config.width}config.padding=UTILS.parseInt(config.chartStyle.padding,config.padding);config.outerRadius=UTILS.parseInt(config.chartStyle.outerRadius,config.outerRadius);config.innerRadius=UTILS.parseInt(config.chartStyle.innerRadius,config.innerRadius);if(config.tooltip!=null){config.customTooltip=UTILS.customTooltip(config.uniqueid+"_tooltip",config.tooltip.width,config.tooltip.height)}var responsiveWidth=parseInt(config.responsiveWidth);if(responsiveWidth>0&&responsiveWidth<config.width){config.innerRadius=responsiveWidth*config.innerRadius/config.width;config.outerRadius=responsiveWidth*config.outerRadius/config.width;config.width=responsiveWidth}var legendWidth=0,legendHeight=0;if(config.legendStyle!=null){var titles=config.legendStyle.titles;var subtitles=config.legendStyle.subtitles;if(titles!=null){if(typeof titles==="string"){if(titles!=""){for(var i=0;i<config.data.length;i++){config.data[i][config.titleKey]=titles}}}else{var len=(titles.length<config.data.length)?titles.length:config.data.length;for(var i=0;i<len;i++){if(titles[i]!=""){config.data[i][config.titleKey]=titles[i]}}}}if(subtitles!=null){if(typeof subtitles==="string"){if(subtitles!=""){for(var i=0;i<config.data.length;i++){config.data[i][config.subtitleKey]=subtitles}}}else{var len=(subtitles.length<config.data.length)?subtitles.length:config.data.length;for(var i=0;i<len;i++){if(subtitles[i]!=""){config.data[i][config.subtitleKey]=subtitles[i]}}}}}var isSubtitleAvailable=(config.subtitleKey in config.data[0]);var totalWidth,totalHeight;if(config.legendStyle==null||config.legendStyle.position=="right"){totalWidth=config.width+legendWidth;totalHeight=(config.height>legendHeight)?config.height:legendHeight}else{totalWidth=(config.width>legendWidth)?config.width:legendWidth;totalHeight=config.height+legendHeight}var panelOffsetY=0;var container=d3.select(chartContainerID);var mainpanel=container.append("svg").attr("class","multipie");var panel=mainpanel.append("g");var totalLabel=config.totalKey;var usedLabel=config.usedKey;var x=0,y=0,pies=[],xEnd=null,yEnd=null;var y2=((config.outerRadius*2)+(config.padding*2));var x2=((config.outerRadius*2)+config.padding);var y2Footer2=(isSubtitleAvailable?15:0);for(var i=0;i<config.data.length;i++){var d2=config.data[i];var total=d2[config.totalKey];var used=d2[config.usedKey];var unused=total-used;var percent=(Math.round(used/total*100*100)/100);var title=(d2[config.titleKey]==null)?"":d2[config.titleKey];var subtitle=(d2[config.subtitleKey]==null)?"":d2[config.subtitleKey];var values=[used,unused];var pie=chart_usage_pie().data(values).dataidx(i).colors(d3.scale.ordinal().range([config.colors(title),config.unusedColor])).outerRadius(config.outerRadius).innerRadius(config.innerRadius).displayPercent(false).x(x).y(y).centerText(percent+"%").footerText(title);if(isSubtitleAvailable){pie.footerText2(subtitle)}pie(panel);pies[i]=pie;var arcs=pie.getArcs();if(config.tooltip!=null){arcs.on("mouseover",function(d,i){var path=d3.select(this);var idx=path.attr("dataidx");var pie=pies[idx];var d2=config.data[idx];var total=d2[config.totalKey];var used=d2[config.usedKey];var percent=pie.getPercentages()[0]+"%";var title=(d2[config.titleKey]==null)?"":d2[config.titleKey];var content=title+"<br/>"+totalLabel+":"+total+"<br/> <b> "+usedLabel+":"+used+"("+percent+")</b>";config.customTooltip.showTooltip(content,(d3.event||window.event))}).on("mouseout",function(d,i){config.customTooltip.hideTooltip()})}if(config.clickAction!=null){arcs.style("cursor","pointer");arcs.on("click",function(d,i){var path=d3.select(this);var idx=path.attr("dataidx");var pie=pies[idx];var actionType=config.clickAction.actionType;var actionTarget=config.clickAction.actionTarget;var actionUrl=config.clickAction.actionUrl;var d2=config.data[idx];var total=d2[config.totalKey];var used=d2[config.usedKey];var title=(d2[config.titleKey]==null)?"":d2[config.titleKey];var actionUrlParams="data="+total+","+used+","+escape(title)+"&keys="+config.keys[0]+","+config.keys[1];if(actionType=="callback"){eval(actionTarget+"(total,used,title)")}else{UTILS.executeClickAction(actionType,actionTarget,actionUrl,actionUrlParams,config.uniqueid)}return})}if(config.width<x+x2*2){xEnd=x+x2;x=0;y+=y2+y2Footer2;yEnd=y}else{x+=x2}}if(xEnd==null){xEnd=x+x2}if(yEnd==null){yEnd=y2}mainpanel.attr("width",totalWidth).attr("height",totalHeight);panel.attr("transform","translate("+config.padding+","+(config.padding+panelOffsetY)+")")};return config};
// chart_multipie.js
var chart_multipie=function(){var a=_chart_multipie();var b=function(c){try{a.drawChart(c)}catch(d){UTILS.appendErrMsg(c,d);throw d}};b.data=function(c){if(!arguments.length){return a.data}a.data=c;return b};b.keys=function(c){if(!arguments.length){return a.keys}a.keys=c;return b};b.chartStyle=function(c){if(!arguments.length){return a.chartStyle}a.chartStyle=c;return b};b.legendStyle=function(c){if(!arguments.length){return a.legendStyle}a.legendStyle=c;return b};b.colors=function(c){if(!arguments.length){return a.colors}a.colors=c;return b};b.tooltip=function(c){if(!arguments.length){return a.tooltip}a.tooltip=c;return b};b.clickAction=function(c){if(!arguments.length){return a.clickAction}a.clickAction=c;return b};b.responsiveWidth=function(c){if(!arguments.length){return a.responsiveWidth}a.responsiveWidth=c;return b};return b};var _chart_multipie=function(){var config={data:[],keys:null,width:800,height:800,outerRadius:60,innerRadius:20,padding:20,colors:d3.scale.category20(),chartStyle:{},legendStyle:null,percentRoundDecimals:2,totalKey:"_total",unusedKey:"_unused",titleKey:"_title",subtitleKey:"_subtitle",unusedColor:"#eeeeee",valueFormat:d3.format(".2s")};config.drawChart=function(chartContainerID){config.uniqueid=chartContainerID.substring(1);if(typeof config.keys[0]==="string"){config.usedKeys=[config.keys[0]]}else{config.usedKeys=config.keys[0]}if(config.keys.length>1){config.totalKey=config.keys[1]}if(config.keys.length>2){config.titleKey=config.keys[2]}if(config.keys.length>3){config.subtitleKey=config.keys[3]}config.width=UTILS.parseInt(config.chartStyle.width);config.height=UTILS.parseInt(config.chartStyle.height);config.padding=UTILS.parseInt(config.chartStyle.padding,config.padding);config.outerRadius=UTILS.parseInt(config.chartStyle.outerRadius,config.outerRadius);config.innerRadius=UTILS.parseInt(config.chartStyle.innerRadius,config.innerRadius);config.percentRoundDecimals=UTILS.parseInt(config.chartStyle.percentRoundDecimals,config.percentRoundDecimals);if(config.tooltip!=null){config.customTooltip=UTILS.customTooltip(config.uniqueid+"_tooltip",config.tooltip.width,config.tooltip.height)}var legendWidth=0;var legendHeight=0;if(config.legendStyle!==null){legendWidth=parseInt(config.legendStyle.width);legendHeight=parseInt(config.legendStyle.height)}var responsiveWidth=parseInt(config.responsiveWidth);if(responsiveWidth>0){var totalWidth;if(config.legendStyle==null||config.legendStyle.position=="right"){totalWidth=config.width+legendWidth}else{totalWidth=(config.width>legendWidth)?config.width:legendWidth}if(responsiveWidth<totalWidth){if(responsiveWidth<config.width){config.innerRadius=responsiveWidth*config.innerRadius/config.width;config.outerRadius=responsiveWidth*config.outerRadius/config.width;config.width=responsiveWidth;if(config.legendStyle!==null){if(config.legendStyle.position=="right"){config.legendStyle.position="bottom";legendWidth=config.width;legendHeight=10}else{if(config.width<legendWidth){legendWidth=config.width}}}}else{if(config.legendStyle!==null){if(config.legendStyle.position=="right"){var legendLen=((config.usedKeys[0].length*9)+5);var diff=responsiveWidth-config.width;if(diff>legendLen){legendWidth=diff}else{config.legendStyle.position="bottom";legendWidth=config.width;legendHeight=10}}else{legendWidth=responsiveWidth}}}}}if(config.legendStyle!==null){var titles=config.legendStyle.titles;var subtitles=config.legendStyle.subtitles;if(titles!=null){if(typeof titles==="string"){for(var i=0;i<config.data.length;i++){config.data[i][config.titleKey]=titles}}else{var len=(titles.length<config.data.length)?titles.length:config.data.length;for(var i=0;i<len;i++){config.data[i][config.titleKey]=titles[i]}}}if(subtitles!=null){if(typeof subtitles==="string"){if(subtitles!=""){for(var i=0;i<config.data.length;i++){config.data[i][config.subtitleKey]=subtitles}}}else{var len=(subtitles.length<config.data.length)?subtitles.length:config.data.length;for(var i=0;i<len;i++){if(subtitles[i]!=""){config.data[i][config.subtitleKey]=subtitles[i]}}}}}config.isSubtitleAvailable=(config.subtitleKey in config.data[0]);var margin={left:config.padding,right:config.padding,top:config.padding,bottom:config.padding};var panelOffsetX=margin.top,panelOffsetY=margin.left,chartXTopPadding=0,chartYLeftPadding=0;if(config.legendStyle!=null){if(config.legendStyle.position=="left"){chartYLeftPadding+=legendWidth}else{if(config.legendStyle.position=="top"){chartXTopPadding+=legendHeight}}}var actualChartWidth=config.width-margin.left-margin.right;var actualChartHeight=config.height-margin.top-margin.bottom;var totalWidth,totalHeight;if(config.legendStyle==null||config.legendStyle.position=="right"){totalWidth=config.width+legendWidth;totalHeight=(config.height>legendHeight)?config.height:legendHeight}else{totalWidth=(config.width>legendWidth)?config.width:legendWidth;totalHeight=config.height+legendHeight}var container=d3.select(chartContainerID);var mainpanel=container.append("svg").attr("class","multipie");var panel=mainpanel.append("g");var dataLayerKeys=config.usedKeys.concat(["Unused"]);var dcolors=config.usedKeys.map(function(d,i){return config.colors(d)});dcolors.push(config.unusedColor);var dataLayerColors=d3.scale.ordinal().range(dcolors);var hasTotalValue=(config.keys.length>1);var kLen=config.usedKeys.length;var x=0,y=0,pies=[],xEnd=null,yEnd=null;var y2=((config.outerRadius*2)+(config.padding*2));var x2=((config.outerRadius*2)+config.padding);for(var i=0;i<config.data.length;i++){yEnd=null;var d=config.data[i];var values=[],total=0,actualTotal,arcLabels=[],displayPercent=true;for(var k=0;k<kLen;k++){var v1=d[config.usedKeys[k]];values[k]=v1;total=total+v1}if(hasTotalValue){actualTotal=d[config.totalKey];var unused=actualTotal-total;if(unused!=0){var percentages=values.map(function(d,i){return(d3.round((d/actualTotal*100),config.percentRoundDecimals))+"%"});d[config.unusedKey]=unused;values[kLen]=unused;percentages[kLen]="";displayPercent=false;arcLabels=percentages}}else{actualTotal=total;d[config.totalKey]=total;d[config.unusedKey]=0}var pie=chart_usage_pie().data(values).dataidx(i).colors(dataLayerColors).outerRadius(config.outerRadius).innerRadius(config.innerRadius).x(x).y(y).displayPercent(displayPercent).arcLabels(arcLabels).footerText(d[config.titleKey]).footerText2(d[config.subtitleKey]).percentRoundDecimals(config.percentRoundDecimals);pie(panel);pies[i]=pie;var arcs=pie.getArcs();if(config.tooltip!=null){arcs.on("mouseover",function(d,i){var path=d3.select(this);var idx=path.attr("dataidx");var pie=pies[idx];var title=config.data[idx][config.titleKey];var yLabel=dataLayerKeys[i];var yValue=d.value.toFixed(0);var percent=pie.getPercentages()[i]+"%";var total=pie.getTotal();var content=title+'  <font size="-2">(Total:'+total+")</font><br><b>"+yLabel+": "+yValue+"("+percent+")";config.customTooltip.showTooltip(content,(d3.event||window.event))}).on("mouseout",function(d,i){config.customTooltip.hideTooltip()})}if(config.clickAction!=null){arcs.style("cursor","pointer");arcs.on("click",function(d,i){var path=d3.select(this);var idx=path.attr("dataidx");var pie=pies[idx];var actionType=config.clickAction.actionType;var actionTarget=config.clickAction.actionTarget;var actionUrl=config.clickAction.actionUrl;var title=config.data[idx][config.titleKey];var yLabel=config.usedKeys[i];var yValue=d.value;var actionUrlParams="data="+yLabel+","+yValue+","+title+"&keys="+config.titleKey+","+config.usedKeys;if(actionType=="callback"){eval(actionTarget+"(yLabel,yValue,title)")}else{UTILS.executeClickAction(actionType,actionTarget,actionUrl,actionUrlParams,config.uniqueid)}return})}if(actualChartWidth<x+x2*2){xEnd=x+x2;x=0;y+=y2;yEnd=y}else{x+=x2}}if(xEnd==null){xEnd=x+x2}if(yEnd==null){yEnd=y+y2+config.padding}if(yEnd>actualChartHeight){totalHeight=totalHeight-actualChartHeight+yEnd}if(xEnd>actualChartWidth){totalWidth=totalWidth-actualChartWidth+xEnd}if(config.legendStyle!=null){var actualLegendWidth,actualLegendHeight;if(config.legendStyle.position=="right"){actualLegendWidth=legendWidth-margin.right;actualLegendHeight=legendHeight-margin.top}else{if(config.legendStyle.position=="top"){actualLegendWidth=legendWidth-margin.left;actualLegendHeight=legendHeight-margin.top}else{actualLegendWidth=legendWidth-margin.left;actualLegendHeight=legendHeight-margin.bottom}}var chart_legends=UTILS.chart_legends().attr("data",config.usedKeys).attr("colors",config.colors).attr("width",actualLegendWidth).attr("height",actualLegendHeight);if(config.legendStyle.position=="right"){chart_legends.attr("x",(xEnd+margin.right)).attr("y",margin.top)}else{if(config.legendStyle.position=="top"){chart_legends.attr("x",(margin.left)).attr("y",margin.top)}else{chart_legends.attr("x",(margin.left)).attr("y",(yEnd+margin.bottom))}}chart_legends(mainpanel);var newLegendWidth=chart_legends.attr("requiredTotalWidth");var newLegendHeight=chart_legends.attr("requiredTotalHeight");if(config.legendStyle.position=="right"){if(newLegendWidth>legendWidth){totalWidth=totalWidth-legendWidth+newLegendWidth}if(newLegendHeight>totalHeight){totalHeight=newLegendHeight}}else{if(newLegendWidth>totalWidth){totalWidth=newLegendWidth}if(newLegendHeight>legendHeight){totalHeight=totalHeight-legendHeight+newLegendHeight}}if(config.legendStyle.position=="top"){chartXTopPadding=chartXTopPadding-legendHeight+newLegendHeight}}mainpanel.attr("width",totalWidth).attr("height",totalHeight);panel.attr("transform","translate("+(margin.left)+","+(margin.top+chartXTopPadding)+")")};return config};
// chart_pie.js
function chart_pie(){var a=_chart_pie_config();var b=function(c){try{a.drawChart(c)}catch(d){UTILS.appendErrMsg(c,d);throw d}};b.data=function(c){if(!arguments.length){return a.data}a.data=c;return b};b.keys=function(c){if(!arguments.length){return a.keys}a.keys=c;return b};b.legendStyle=function(c){if(!arguments.length){return a.legendStyle}a.legendStyle=c;return b};b.chartStyle=function(c){if(!arguments.length){return a.chartStyle}a.chartStyle=c;return b};b.colors=function(c){if(!arguments.length){return a.colors}a.colors=c;return b};b.tooltip=function(c){if(!arguments.length){return a.tooltip}a.tooltip=c;return b};b.clickAction=function(c){if(!arguments.length){return a.clickAction}a.clickAction=c;return b};b.responsiveWidth=function(c){if(!arguments.length){return a.responsiveWidth}a.responsiveWidth=c;return b};return b}function _chart_pie_config(){var config={chartType:"pie",data:[],keys:[],legendStyle:null,chartStyle:[],colors:d3.scale.category20(),tooltip:null,clickAction:null,responsiveWidth:0,padding:0};config.drawChart=function(chartContainerID){config.uniqueid=chartContainerID.substring(1);if(config.tooltip!=null){config.customTooltip=UTILS.customTooltip(config.uniqueid+"_tooltip",config.tooltip.width,config.tooltip.height)}config.innerRadius=parseInt(config.chartStyle.innerRadius);config.outerRadius=parseInt(config.chartStyle.outerRadius);config.width=config.outerRadius*2;config.height=config.outerRadius*2;var legendWidth=0;var legendHeight=0;if(config.legendStyle!==null){legendWidth=parseInt(config.legendStyle.width);legendHeight=parseInt(config.legendStyle.height)}var responsiveWidth=parseInt(config.responsiveWidth);if(responsiveWidth>0){var totalWidth;if(config.legendStyle==null||config.legendStyle.position=="right"){totalWidth=config.width+legendWidth}else{totalWidth=(config.width>legendWidth)?config.width:legendWidth}if(responsiveWidth<totalWidth){if(responsiveWidth<config.width){config.innerRadius=responsiveWidth*config.innerRadius/config.width;config.outerRadius=responsiveWidth*config.outerRadius/config.width;config.width=responsiveWidth;config.height=config.outerRadius*2;if(config.legendStyle!=null){if(config.legendStyle.position=="right"){config.legendStyle.position="bottom";legendWidth=config.width}else{if(config.width<legendWidth){legendWidth=config.width}}}}else{if(config.legendStyle!=null){if(config.legendStyle.position=="right"){var legendLen=((5*10)+5);var diff=responsiveWidth-config.width;if(diff>legendLen){legendWidth=diff}else{config.legendStyle.position="bottom";legendWidth=config.width}}else{legendWidth=responsiveWidth}}}}}config.hasNamedColors=UTILS.isOrdinalScaleWithNames(config.colors);var xKey=config.keys[0];var yKey=config.keys[1];var dLen=config.data.length;config.data=config.data.sort(function(a,b){return d3.descending(+a[yKey],+b[yKey])});var labels=[],values=[],matchedColors=[];for(var i=0;i<dLen;i++){var d=config.data[i];labels[i]=d[xKey];values[i]=+d[yKey];matchedColors[i]=config.hasNamedColors?config.colors(labels[i]):config.colors(i)}config.labels=labels;config.values=values;config.matchedColors=matchedColors;config.sum=d3.sum(config.values);config.percentage=[];for(var i=0;i<config.values.length;i++){config.percentage[i]=Math.round(config.values[i]/config.sum*100*100)/100}var totalWidth,totalHeight;if(config.legendStyle==null||config.legendStyle.position=="right"){totalWidth=config.width+legendWidth;totalHeight=(config.height>legendHeight)?config.height:legendHeight}else{totalWidth=(config.width>legendWidth)?config.width:legendWidth;totalHeight=config.height+legendHeight}var panelOffsetY=0;if(config.legendStyle!=null&&config.legendStyle.position=="top"){panelOffsetY=legendHeight}var container=d3.select(chartContainerID);var mainpanel=container.append("svg").attr("id",config.uniqueid+"_svg");var panel=mainpanel.append("g");var donut=d3.layout.pie();var arc=d3.svg.arc().innerRadius(config.innerRadius).outerRadius(config.outerRadius);var arcs=panel.selectAll("g.arc").data(donut(config.values)).enter().append("g").attr("class",function(d,i){return"arc arc"+i}).attr("transform","translate("+config.outerRadius+","+config.outerRadius+")");var wedge=arcs.append("path").attr("fill",function(d,i){return config.matchedColors[i]}).attr("d",arc);if((config.innerRadius==0&&(config.outerRadius-config.innerRadius)>80)||(config.innerRadius>0&&(config.outerRadius-config.innerRadius)>=50)){var textOffset=config.innerRadius!=0?1:1.5;var label=arcs.append("text").attr("transform",function(d){var c=arc.centroid(d);return"translate("+c[0]*textOffset+","+c[1]*textOffset+")"}).attr("dy",".35em").attr("text-anchor","middle").attr("display",function(d){return d.value>0.15?null:"none"}).text(function(d,i){var percent;if(parseInt(config.percentage[i])>+7){percent=config.percentage[i]+"%"}else{percent=""}return percent}).style("font","10px sans-serif")}config.showHoverEffect=function(idx){for(var i=dLen-1;i>-1;i--){if(i!=idx){panel.select(".arc"+i).style("opacity","0.25")}}};config.disableHoverEffect=function(idx){for(var i=dLen-1;i>-1;i--){if(i!=idx){panel.select(".arc"+i).style("opacity","")}}};if(config.legendStyle!=null){var textOffset=20;var x,y;if(config.legendStyle.position=="right"){x=config.width+textOffset;y=10}else{if(config.legendStyle.position=="top"){x=textOffset;y=10}else{if(config.legendStyle.position=="bottom"){x=textOffset;y=config.height+textOffset}}}var legends=config.labels.map(function(d,i){return d+" ("+(+config.values[i])+")"});var chart_legends=UTILS.chart_legends().attr("data",legends).attr("colors",config.colors).attr("width",legendWidth).attr("height",legendHeight).attr("x",x).attr("y",y);if(config.hasNamedColors){chart_legends.attr("actualNames",config.labels)}chart_legends(mainpanel);var legends=chart_legends.getLegends();legends.on("mouseover",function(d,i){config.showHoverEffect(i);if(config.tooltip!=null){var content=config.getTooltipContent(i);config.customTooltip.showTooltip(content,(d3.event||window.event))}}).on("mouseout",function(d,id){config.disableHoverEffect(i);if(config.tooltip!=null){config.customTooltip.hideTooltip()}});var newLegendWidth=chart_legends.attr("requiredTotalWidth");var newLegendHeight=chart_legends.attr("requiredTotalHeight");if(config.legendStyle.position=="right"){totalWidth=totalWidth-legendWidth+newLegendWidth;totalHeight=(totalHeight>newLegendHeight)?totalHeight:newLegendHeight}else{totalWidth=(totalWidth>newLegendWidth)?totalWidth:newLegendWidth;totalHeight=totalHeight-legendHeight+newLegendHeight}if(config.legendStyle.position=="top"){panelOffsetY=newLegendHeight}}if(config.tooltip!=null){arcs.on("mouseover",function(d,i){var content=config.getTooltipContent(i);config.customTooltip.showTooltip(content,(d3.event||window.event))}).on("mouseout",function(d,i){config.customTooltip.hideTooltip()})}if(config.clickAction!=null){arcs.style("cursor","pointer");arcs.on("click",function(d,i){config.doClickAction(i)});if(config.legends!=null){var legends=config.legends;legends.on("click",function(d,i){config.doClickAction(i)})}}mainpanel.attr("width",totalWidth).attr("height",totalHeight);panel.attr("transform","translate("+config.padding+","+(config.padding+panelOffsetY)+")")};config.getTooltipContent=function(i){var percent=config.percentage[i]+"%";var content=config.labels[i]+"<br/> <b>"+config.values[i]+" ("+percent+")";return content};config.doClickAction=function(i){var actionType=config.clickAction.actionType;var actionTarget=config.clickAction.actionTarget;var actionUrl=config.clickAction.actionUrl;var label=config.labels[i];var value=config.values[i];var actionUrlParams="data="+label+","+value+"&keys="+xKey+","+yKey;if(actionType=="callback"){eval(actionTarget+"(label,value)")}else{UTILS.executeClickAction(actionType,actionTarget,actionUrl,actionUrlParams,config.uniqueid)}return};return config};
// chart_timeline.js
function chart_timeline(){var a=_chart_timeline_config();var b=function(c){try{a.drawChart(c)}catch(d){UTILS.appendErrMsg(c,d);throw d}};b.data=function(c){if(!arguments.length){return a.data}a.data=c;return b};b.keys=function(c){if(!arguments.length){return a.keys}a.keys=c;return b};b.legendStyle=function(c){if(!arguments.length){return a.legendStyle}a.legendStyle=c;return b};b.chartStyle=function(c){if(!arguments.length){return a.chartStyle}a.chartStyle=c;return b};b.hAxis=function(c){if(!arguments.length){return a.hAxis}a.hAxis=c;return b};b.vAxis=function(c){if(!arguments.length){return a.vAxis}a.vAxis=c;return b};b.colors=function(c){if(!arguments.length){return a.colors}a.colors=c;return b};b.tooltip=function(c){if(!arguments.length){return a.tooltip}a.tooltip=c;return b};b.clickAction=function(c){if(!arguments.length){return a.clickAction}a.clickAction=c;return b};b.responsiveWidth=function(c){if(!arguments.length){return a.responsiveWidth}a.responsiveWidth=c;return b};return b}function _chart_timeline_config(){var config={chartType:"timeline",data:[],keys:null,legendStyle:{},chartStyle:{},colors:d3.scale.category20(),hAxis:null,vAxis:null,tooltip:{},tooltip_showAllLegends:false,dataInterval:null,barWidth:10,barWidthMin:1,barWidthMax:10,responsiveWidth:0,clickAction:null};config.drawChart=function(chartContainerID){config.uniqueid=chartContainerID.substring(1);config.xkey=config.keys[0];config.ykeys=(typeof config.keys[1]==="string")?[config.keys[1]]:config.keys[1];config.width=parseInt(config.chartStyle.width);config.height=parseInt(config.chartStyle.height);if(config.tooltip!=null){config.customTooltip=UTILS.customTooltip(config.uniqueid+"_tooltip",config.tooltip.width,config.tooltip.height)}config.dataInterval=config.chartStyle.dataInterval;var legendWidth=0;var legendHeight=0;if(config.legendStyle!==null){legendWidth=parseInt(config.legendStyle.width);legendHeight=parseInt(config.legendStyle.height)}var responsiveWidth=parseInt(config.responsiveWidth);if(responsiveWidth>0){var totalWidth;if(config.legendStyle==null||config.legendStyle.position=="right"){totalWidth=config.width+legendWidth}else{totalWidth=(config.width>legendWidth)?config.width:legendWidth}if(responsiveWidth<totalWidth){if(responsiveWidth<config.width){config.width=responsiveWidth;if(config.legendStyle!==null){if(config.legendStyle.position=="right"){config.legendStyle.position="bottom";legendWidth=config.width;legendHeight=10}else{if(config.width<legendWidth){legendWidth=config.width}}}}else{if(config.legendStyle!==null){if(config.legendStyle.position=="right"){var legendLen=(config.ykeys[0].length*10)+5;var diff=responsiveWidth-config.width;if(diff>legendLen){legendWidth=diff}else{config.legendStyle.position="bottom";legendWidth=config.width;legendHeight=10}}else{legendWidth=responsiveWidth}}}}}config.hasNamedColors=UTILS.isOrdinalScaleWithNames(config.colors);var allDates=[],ymax=0,ymin=0,minTimeDiff=UTILS.year;config.dataLayers=config.ykeys.map(function(){return[]});config.data.forEach(function(d,i){var time=new Date(+d[config.xkey]);allDates[i]=time;if(i>0){var diff=allDates[i].getTime()-allDates[i-1].getTime();if(diff<0){diff*=-1}if(diff>0&&diff<minTimeDiff){minTimeDiff=diff}}var ytotal=0;config.ykeys.forEach(function(k,ki){var yvalue=+d[k];ytotal+=yvalue;config.dataLayers[ki][i]={x:time,y:yvalue,i:ki}});if(ytotal<ymin){ymin=ytotal}if(ytotal>ymax){ymax=ytotal}});var startTime=d3.min(allDates);var endTime=d3.max(allDates);config.stackedData=d3.layout.stack()(config.dataLayers);config.legends=config.ykeys;var margin={left:5,right:5,top:10,bottom:5};var panelOffsetX=margin.top,panelOffsetY=margin.left,chartXTopPadding=0,chartYLeftPadding=0;if(config.legendStyle!=null){if(config.legendStyle.position=="left"){chartYLeftPadding+=legendWidth}else{if(config.legendStyle.position=="top"){chartXTopPadding+=legendHeight}}}var xAxisPadding=0;if(config.hAxis!==null){if(config.hAxis.position=="out"){xAxisPadding+=25}else{if(config.hAxis.position=="in"){xAxisPadding+=10}}if(config.hAxis.label!==""){xAxisPadding+=20}if(config.hAxis.startValue!=null){var val=+config.hAxis.startValue;if(val>0&&val<startTime.getTime()){startTime=new Date(val)}}if(config.hAxis.endValue!=null){var val=+config.hAxis.endValue;if(val>0&&val>endTime.getTime()){endTime=new Date(val)}}margin.left+=5;margin.right+=10}var yAxisPadding=0;if(config.vAxis!==null){if(config.vAxis.position=="out"){yAxisPadding+=40}else{if(config.vAxis.position=="in"){yAxisPadding+=5}}if(config.vAxis.label!==""){yAxisPadding+=20}}var actualChartWidth=config.width-yAxisPadding-margin.left-margin.right;var actualChartHeight=config.height-xAxisPadding-margin.top-margin.bottom;var interval=null,minTime=UTILS.hour;if(config.dataInterval!=null){interval=eval("UTILS."+config.dataInterval);var diff=endTime.getTime()-startTime.getTime();if(diff<interval){startTime=new Date(endTime.getTime()-interval)}}else{if(endTime.getTime()==startTime.getTime()){startTime=new Date(startTime.getTime()-UTILS.minute)}}config.xScale=d3.time.scale.utc().domain([startTime,endTime]).rangeRound([0,actualChartWidth]);config.barWidth=config.normalizedBarWidth(startTime,minTimeDiff,config.xScale,interval);var xBarOffset=config.barWidth*20/100;if(xBarOffset<3){xBarOffset=3}if(xBarOffset>10){xBarOffset=10}var newStartTime=config.xScale.invert(-xBarOffset);var newEndTime=config.xScale.invert(actualChartWidth+config.barWidth+xBarOffset);config.xScale.domain([newStartTime,newEndTime]);config.yScale=d3.scale.linear().domain([ymin,ymax]).range([actualChartHeight,0]);var container=d3.select(chartContainerID);var totalWidth,totalHeight;if(config.legendStyle==null||config.legendStyle.position=="right"){totalWidth=config.width+legendWidth;totalHeight=(config.height>legendHeight)?config.height:legendHeight}else{totalWidth=(config.width>legendWidth)?config.width:legendWidth;totalHeight=config.height+legendHeight}var mainpanel=container.append("svg").attr("class","barchart");var panel=mainpanel.append("g");if(config.hAxis!=null){config.hAxis.labelOffset=xAxisPadding-5;if(config.hAxis.ticks=="default"){config.hAxis.ticks=((actualChartWidth/100)*1)}var tickformat=config.hAxis.tickformat;if(tickformat==null||tickformat=="default"||tickformat==""){config.hAxis.tickformat=UTILS.time.globalizeTimeScaleFormat()}var xAxis=UTILS.chart_x_axis().attr("scale",config.xScale).attr("axisStyle",config.hAxis).attr("chartWidth",actualChartWidth).attr("chartHeight",actualChartHeight).attr("makeTicksResponsive",false);xAxis(panel)}if(config.vAxis!=null){config.vAxis.labelOffset=yAxisPadding-10;if(config.vAxis.ticks=="default"){config.vAxis.ticks=((actualChartHeight/100)*3)+1}var yAxis=UTILS.chart_y_axis().attr("scale",config.yScale).attr("axisStyle",config.vAxis).attr("chartWidth",actualChartWidth).attr("chartHeight",actualChartHeight);yAxis(panel)}var spanel=panel.selectAll("g.category").data(config.stackedData).enter().append("g").attr("class","category").style("fill",function(d,i){return config.hasNamedColors?config.colors(config.ykeys[i]):config.colors(i)});spanel.each(function(d,i){var category=d3.select(this);config._drawBar(d,i,category)});if(config.clickAction!=null){spanel.style("cursor","pointer")}if(config.legendStyle!=null){var actualLegendWidth,actualLegendHeight;if(config.legendStyle.position=="right"){actualLegendWidth=legendWidth-margin.right;actualLegendHeight=legendHeight-margin.top}else{if(config.legendStyle.position=="top"){actualLegendWidth=legendWidth-margin.left;if(actualLegendWidth>actualChartWidth){actualLegendWidth-=yAxisPadding}actualLegendHeight=legendHeight-margin.top}else{actualLegendWidth=legendWidth-margin.left;if(actualLegendWidth>actualChartWidth){actualLegendWidth-=yAxisPadding}actualLegendHeight=legendHeight-margin.bottom}}var chart_legends=UTILS.chart_legends().attr("data",config.legends).attr("colors",config.colors).attr("width",actualLegendWidth).attr("height",actualLegendHeight).attr("dotType","circle");if(config.legendStyle.position=="right"){chart_legends.attr("x",(margin.left+actualChartWidth+yAxisPadding+margin.right*2)).attr("y",margin.top)}else{if(config.legendStyle.position=="top"){chart_legends.attr("x",(margin.left+yAxisPadding)).attr("y",(margin.top))}else{chart_legends.attr("x",(margin.left+yAxisPadding)).attr("y",(margin.top+actualChartHeight+xAxisPadding+margin.bottom*2))}}chart_legends(mainpanel);var newLegendWidth=chart_legends.attr("requiredTotalWidth");var newLegendHeight=chart_legends.attr("requiredTotalHeight");if(config.legendStyle.position=="right"){if(newLegendWidth>legendWidth){totalWidth=totalWidth-legendWidth+newLegendWidth}if(newLegendHeight>totalHeight){totalHeight=newLegendHeight}}else{if(newLegendWidth>totalWidth){totalWidth=newLegendWidth}if(newLegendHeight>legendHeight){totalHeight=totalHeight-legendHeight+newLegendHeight}}if(config.legendStyle.position=="top"){chartXTopPadding=chartXTopPadding-legendHeight+newLegendHeight}}mainpanel.attr("width",totalWidth).attr("height",totalHeight);panel.attr("transform","translate("+(margin.left+yAxisPadding)+","+(margin.top+chartXTopPadding)+")")};config._drawBar=function(p,q,parent){var bar=parent.selectAll("rect").data(p).enter().append("rect").attr("class","bar").attr("x",function(d){return config.xScale(d.x)}).attr("y",function(d){return config.yScale(d.y0+d.y)}).attr("width",config.barWidth).attr("height",function(d){return(config.yScale(d.y0)-config.yScale(d.y0+d.y))});if(config.tooltip!=null){var dateFormat=UTILS.globalizeFormat(UTILS.CONSTANTS.DEFAULT_DATE_FORMAT);config.tooltip_showAllLegends=UTILS.parseBool(config.tooltip.showAllLegends,config.tooltip_showAllLegends);bar.on("mouseover",function(d,i){var date=d.x;var displayDate=dateFormat(date);var content=displayDate;if(config.tooltip_showAllLegends){var d=config.data[i];for(var i=config.ykeys.length;i>-1;i--){var k=config.ykeys[i];if(+d[k]>0){var color=config.colors(config.hasNamedColors?k:i);content+="<br/><span style='color:"+color+";'>"+k+" : <b>"+d[k]+"</b></span>"}}}else{content+="<br/>"+config.ykeys[d.i]+" : <b>"+d.y+"</b>"}config.customTooltip.showTooltip(content,(d3.event||window.event))}).on("mouseout",function(d,i){config.customTooltip.hideTooltip()})}if(config.clickAction!=null){bar.on("click",function(d,i){config.customTooltip.hideTooltip();var actionType=config.clickAction.actionType;var actionTarget=config.clickAction.actionTarget;var actionUrl=config.clickAction.actionUrl;var actionUrlParams="data="+d.x+","+d.y+"&keys="+config.xkey+","+config.legends[q];if(actionType=="callback"){eval(actionTarget+"(d.x,d.y,config.legends[q],i)")}else{UTILS.executeClickAction(actionType,actionTarget,actionUrl,actionUrlParams)}if(config.tooltip!=null){config.customTooltip.hideTooltip()}return})}};config.normalizedBarWidth=function(startTime,minTimeDiff,xScale,interval){var timeDiff=(interval!=null&&minTimeDiff>interval)?interval:minTimeDiff;var dt1=new Date(startTime.getTime()+timeDiff);var barWidth=(xScale(dt1)-xScale(startTime))*65/100;return(barWidth<config.barWidthMin)?config.barWidthMin:(barWidth>config.barWidthMax)?config.barWidthMax:barWidth};return config};
// chart_treemap.js
function chart_treemap(){var a=_chart_treemap();thisChart=function(b){try{a.drawChart(b)}catch(c){UTILS.appendErrMsg(b,c);throw c}};thisChart.data=function(b){if(!arguments.length){return a.data}a.data=b;return thisChart};thisChart.keys=function(b){if(!arguments.length){return a.keys}a.keys=b;return thisChart};thisChart.chartStyle=function(b){if(!arguments.length){return a.chartStyle}a.chartStyle=b;return thisChart};thisChart.colors=function(b){if(!arguments.length){return a.colors}a.colors=b;return thisChart};thisChart.tooltip=function(b){if(!arguments.length){return a.tooltip}a.tooltip=b;return thisChart};thisChart.clickAction=function(b){if(!arguments.length){return a.clickAction}a.clickAction=b;return thisChart};thisChart.responsiveWidth=function(b){if(!arguments.length){return a.responsiveWidth}a.responsiveWidth=b;return thisChart};return thisChart}function _chart_treemap(){var config={chartType:"treemap",data:[],keys:null,chartStyle:[],colors:d3.scale.category20(),tooltip:[],responsiveWidth:0,clickAction:null};config.drawChart=function(chartContainerID){config.uniqueid=chartContainerID.substring(1);config.xkey=config.keys[0];config.ykey=config.keys[1];config.width=parseInt(config.chartStyle.width);config.height=parseInt(config.chartStyle.height);if(config.tooltip!=null){config.customTooltip=UTILS.customTooltip(config.uniqueid+"_tooltip",config.tooltip.width,config.tooltip.height)}var responsiveWidth=parseInt(config.responsiveWidth);if(responsiveWidth>0&&responsiveWidth<config.width){config.width=responsiveWidth}var treemap=d3.layout.treemap().size([config.width,config.height]).value(function(d){return d[config.ykey]});var div=d3.select(chartContainerID).append("div").style("position","relative").style("width",config.width+"px").style("height",config.height+"px");if(config.clickAction!=null){div.style("cursor","pointer")}var json={name:"treemap",children:config.data};var cells=div.data([json]).selectAll("div").data(treemap.nodes).enter().append("div").attr("class","cell").style("background",function(d,i){return d.children?null:config.colors(d[config.xkey])}).style("display","block").call(cell).text(function(d){return d.children?null:d[config.xkey]});if(config.tooltip!=null){cells.on("mouseover",function(d,i){content=d[config.xkey]+"<br/><b>"+d[config.ykey]+"</b>";config.customTooltip.showTooltip(content,(d3.event||window.event))}).on("mouseout",function(d,i){config.customTooltip.hideTooltip()})}if(config.clickAction!=null){cells.on("click",function(d,i){var actionType=config.clickAction.actionType;var actionTarget=config.clickAction.actionTarget;var actionUrl=config.clickAction.actionUrl;var actionUrlParams="data="+d[config.xkey]+","+d[config.ykey]+"&keys="+config.xkey+","+config.ykey;if(actionType=="callback"){eval(actionTarget+"(d[config.xkey],d[config.ykey])")}else{UTILS.executeClickAction(actionType,actionTarget,actionUrl,actionUrlParams)}return})}function cell(){this.style("left",function(d){return d.x+"px"}).style("top",function(d){return d.y+"px"}).style("width",function(d){return Math.max(0,d.dx-1)+"px"}).style("height",function(d){return Math.max(0,d.dy-1)+"px"})}return config};return config};
// chart_usage.js
var chart_usage=function(){var a=_chart_usage();var b=function(c){try{a.drawChart(c)}catch(d){UTILS.appendErrMsg(c,d);throw d}};b.data=function(c){if(!arguments.length){return a.data}a.data=c;return b};b.keys=function(c){if(!arguments.length){return a.keys}a.keys=c;return b};b.chartStyle=function(c){if(!arguments.length){return a.chartStyle}a.chartStyle=c;return b};b.legendStyle=function(c){if(!arguments.length){return a.legendStyle}a.legendStyle=c;return b};b.colors=function(c){if(!arguments.length){return a.colors}a.colors=c;return b};b.tooltip=function(c){if(!arguments.length){return a.tooltip}a.tooltip=c;return b};b.clickAction=function(c){if(!arguments.length){return a.clickAction}a.clickAction=c;return b};b.responsiveWidth=function(c){if(!arguments.length){return a.responsiveWidth}a.responsiveWidth=c;return b};return b};var _chart_usage=function(){var config={data:[],keys:null,width:800,barHeight:25,padding:20,colors:d3.scale.category20(),chartStyle:{},legendStyle:null,percentRoundDecimals:2,barTextFont:"",barTextFontOnHover:"strong",xAxisPercentageBased:true,isValuesTicksDisplayed:false,isXAxisDisplayed:false,y:5,titleHeight:15,xAxisHeight:50,totalKey:"Total",unusedKey:"Unused",titleKey:"Title",subtitleKey:"Subtitle",unusedColor:"#eeeeee",valueFormat:d3.format(".2s")};config.drawChart=function(chartContainerID){config.uniqueid=chartContainerID.substring(1);if(typeof config.keys[0]==="string"){config.usedKeys=[config.keys[0]]}else{config.usedKeys=config.keys[0]}if(config.keys.length>1){config.totalKey=config.keys[1]}if(config.keys.length>2){config.titleKey=config.keys[2]}if(config.keys.length>3){config.subtitleKey=config.keys[3]}config.width=UTILS.parseInt(config.chartStyle.width);config.barHeight=UTILS.parseInt(config.chartStyle.barHeight);config.padding=UTILS.parseInt(config.chartStyle.padding,config.padding);config.percentRoundDecimals=UTILS.parseInt(config.chartStyle.percentRoundDecimals,config.percentRoundDecimals);if(config.tooltip!=null){config.customTooltip=UTILS.customTooltip(config.uniqueid+"_tooltip",config.tooltip.width,config.tooltip.height)}var kLen=config.usedKeys.length;var isLegendsDisplayed=(kLen>1);var legendWidth=0;var legendHeight=0;if(isLegendsDisplayed){legendWidth=parseInt(config.legendStyle.width);legendHeight=parseInt(config.legendStyle.height)}var responsiveWidth=parseInt(config.responsiveWidth);if(responsiveWidth>0){var totalWidth;if(config.legendStyle==null||config.legendStyle.position=="right"){totalWidth=config.width+legendWidth}else{totalWidth=(config.width>legendWidth)?config.width:legendWidth}if(responsiveWidth<totalWidth){if(responsiveWidth<config.width){config.width=responsiveWidth;if(isLegendsDisplayed){if(config.legendStyle.position=="right"){config.legendStyle.position="bottom";legendWidth=config.width;legendHeight=10}else{if(config.width<legendWidth){legendWidth=config.width}}}}else{if(isLegendsDisplayed){if(config.legendStyle.position=="right"){var legendLen=((config.usedKeys[0].length*10)+5);var diff=responsiveWidth-config.width;if(diff>legendLen){legendWidth=diff}else{config.legendStyle.position="bottom";legendWidth=config.width;legendHeight=10}}else{legendWidth=responsiveWidth}}}}}if(config.legendStyle!==null){var titles=config.legendStyle.titles;var subtitles=config.legendStyle.subtitles;if(titles!=null){if(typeof titles==="string"){for(var i=0;i<config.data.length;i++){config.data[i][config.titleKey]=titles}}else{var len=(titles.length<config.data.length)?titles.length:config.data.length;for(var i=0;i<len;i++){config.data[i][config.titleKey]=titles[i]}}}if(subtitles!=null){if(typeof subtitles==="string"){if(subtitles!=""){for(var i=0;i<config.data.length;i++){config.data[i][config.subtitleKey]=subtitles}}}else{var len=(subtitles.length<config.data.length)?subtitles.length:config.data.length;for(var i=0;i<len;i++){if(subtitles[i]!=""){config.data[i][config.subtitleKey]=subtitles[i]}}}}}config.barRowHeight=(config.barHeight+config.padding+config.titleHeight);config.barRowHeight+=config.isValuesTicksDisplayed?10:0;config.allBarsHeight=(config.barRowHeight*config.data.length);config.height=config.allBarsHeight+config.padding;config.height+=(config.isXAxisDisplayed==true)?config.xAxisHeight:0;var margin={left:config.padding,right:config.padding,top:config.padding,bottom:config.padding};var panelOffsetX=margin.top,panelOffsetY=margin.left,chartXTopPadding=0,chartYLeftPadding=0;if(config.legendStyle!=null){if(config.legendStyle.position=="left"){chartYLeftPadding+=legendWidth}else{if(config.legendStyle.position=="top"){chartXTopPadding+=legendHeight}}}var xAxisPadding=0;if(config.isXAxisDisplayed==true){xAxisPadding+=30}var actualChartWidth=config.width-margin.left-margin.right;if(config.xAxisPercentageBased==false){actualChartWidth-=15}var totalWidth,totalHeight;if(config.legendStyle==null||config.legendStyle.position=="right"){totalWidth=config.width+legendWidth;totalHeight=(config.height>legendHeight)?config.height:legendHeight}else{totalWidth=(config.width>legendWidth)?config.width:legendWidth;totalHeight=config.height+legendHeight}var dataLayerKeys=config.usedKeys.concat([config.unusedKey]);var dcolors=config.usedKeys.map(function(d,i){return config.colors(d)});dcolors.push(config.unusedColor);var dataLayerColors=d3.scale.ordinal().range(dcolors);var hasTotalValue=(config.keys.length>1);var percentages=[];var maxTotal=0;config.data.forEach(function(d,i){var total=0,actualTotal=0;for(var k=0;k<kLen;k++){total+=d[config.usedKeys[k]]}if(hasTotalValue){actualTotal=d[config.totalKey];d[config.unusedKey]=actualTotal-total}else{actualTotal=total;d[config.totalKey]=total;d[config.unusedKey]=0}if(maxTotal<actualTotal){maxTotal=actualTotal}var tvalue=d[config.titleKey];var subtvalue=d[config.subtitleKey];var result={x:(tvalue==null?"":tvalue),x2:(subtvalue==null?"":subtvalue)};for(var k=0;k<kLen;k++){var v1=d[config.usedKeys[k]];var percent=(v1/actualTotal*100);var name=config.usedKeys[k];if(config.xAxisPercentageBased){result[name]=percent}else{result[name]=v1}}var v1=d[config.unusedKey];result[config.unusedKey]=(config.xAxisPercentageBased)?(v1/actualTotal*100):v1;result[config.totalKey]=actualTotal;percentages[i]=result});config.dataPercentages=percentages;config.dataLayers=dataLayerKeys.map(function(k,ki){return config.dataPercentages.map(function(d,i){return{x:d.x,x2:d.x2,y:d[k],k:k,ki:ki,i:i}})});config.stackedData=d3.layout.stack()(config.dataLayers);config.max=(config.xAxisPercentageBased)?100:maxTotal;var xScale=d3.scale.linear().domain([0,config.max]).range([0,actualChartWidth]);config.xScale=xScale;var container=d3.select(chartContainerID);var mainpanel=container.append("svg").attr("class","usage2");var panel=mainpanel.append("g");var spanel=panel.selectAll("g").data(config.stackedData).enter().append("g").attr("class","category");spanel.each(function(d,i){var category=d3.select(this);config._drawBar(d,i,category,dataLayerColors)});var yEnd=config.allBarsHeight+config.padding;if(config.isXAxisDisplayed==true){var xAxis=d3.svg.axis().scale(xScale).orient("bottom").tickFormat(function(d,i){return config.xAxisPercentageBased?(d+"%"):config.valueFormat(d)}).ticks(10);var xSvg=panel.append("g").attr("class","x axis").attr("transform","translate("+margin.left+","+(yEnd-config.padding)+")").call(xAxis)}if(isLegendsDisplayed&&config.legendStyle!=null){var actualLegendWidth,actualLegendHeight;if(config.legendStyle.position=="right"){actualLegendWidth=legendWidth-margin.right;actualLegendHeight=legendHeight-margin.top}else{if(config.legendStyle.position=="top"){actualLegendWidth=legendWidth-margin.left;actualLegendHeight=legendHeight-margin.top}else{actualLegendWidth=legendWidth-margin.left;actualLegendHeight=legendHeight-margin.bottom}}var chart_legends=UTILS.chart_legends().attr("data",config.usedKeys).attr("colors",dataLayerColors).attr("width",actualLegendWidth).attr("height",actualLegendHeight).attr("dotType",UTILS.defaultValue(config.legendStyle.dotType,"circle")).attr("dotSize",config.legendStyle.dotSize).attr("fontStyle",config.legendStyle.fontStyle).attr("padding",config.legendStyle.padding);if(config.legendStyle.position=="right"){chart_legends.attr("x",(margin.left+actualChartWidth+margin.right*2)).attr("y",margin.top)}else{if(config.legendStyle.position=="top"){chart_legends.attr("x",(margin.left)).attr("y",margin.top)}else{chart_legends.attr("x",(margin.left)).attr("y",(yEnd+margin.bottom+xAxisPadding))}}chart_legends(mainpanel);var legends=chart_legends.getLegends();legends.on("mouseover",function(d,i){for(var idx=kLen;idx>-1;idx--){if(i!=idx){var bars=mainpanel.selectAll("rect.bar"+idx);bars.style("opacity","0.1");var texts=mainpanel.selectAll("text.bar"+idx);texts.style("opacity","0.1")}}var texts=mainpanel.selectAll("text.bar"+i);texts.style("font",config.barTextFontOnHover).style("display","").attr("transform","translate(0,"+(config.barHeight-(config.barHeight/1.5)+9)+")")}).on("mouseout",function(d,i){for(var idx=kLen;idx>-1;idx--){if(i!=idx){var bars=mainpanel.selectAll("rect.bar"+idx);bars.style("opacity","");var texts=mainpanel.selectAll("text.bar"+idx);texts.style("opacity","")}}var texts=mainpanel.selectAll("text.bar"+i);texts.style("font",config.barTextFont).attr("transform","translate(0,0)");var textSmall=mainpanel.selectAll("text.barSmall"+i);textSmall.style("display","none")});var newLegendWidth=chart_legends.attr("requiredTotalWidth");var newLegendHeight=chart_legends.attr("requiredTotalHeight");if(config.legendStyle.position=="right"){if(newLegendWidth>legendWidth){totalWidth=totalWidth-legendWidth+newLegendWidth}if(newLegendHeight>totalHeight){totalHeight=newLegendHeight}}else{if(newLegendWidth>totalWidth){totalWidth=newLegendWidth}if(newLegendHeight>legendHeight){totalHeight=totalHeight-legendHeight+newLegendHeight}}if(config.legendStyle.position=="top"){chartXTopPadding=chartXTopPadding-legendHeight+newLegendHeight}}mainpanel.attr("width",totalWidth).attr("height",totalHeight);panel.attr("transform","translate(0,"+(margin.top+chartXTopPadding)+")")};config._drawBar=function(p,q,parent,colors){var gRow=parent.selectAll("g.row").data(p).enter().append("g").attr("class","row").attr("_dataidx",function(d,i){return i});var yCall=function(d,i){return(d.i*config.barRowHeight)+config.titleHeight};if(q==0){gRow.append("text").attr("class","usage-title").attr("y",function(d,i){return yCall(d,i)-5}).attr("x",config.padding+2).text(function(d,i){return d.x});gRow.append("text").attr("class","usage-subtitle").attr("y",function(d,i){return yCall(d,i)-6}).attr("x",function(d,i){return(config.padding+2+config.padding+(d.x.length*9))}).text(function(d,i){if(d.x2!=null&&d.x2!=""){return"( "+d.x2+" )"}else{return""}});if(config.isValuesTicksDisplayed){if(config.xAxisPercentageBased){gRow.append("rect").attr("class","usage-stroke").attr("y",function(d,i){return yCall(d,i)-(config.barHeight/2)}).attr("x",function(d){return config.xScale(config.max)+config.padding-1}).attr("width","0.5").attr("height",config.barHeight/2);gRow.append("text").attr("class","usage-value").attr("y",function(d,i){return yCall(d,i)-1}).attr("x",function(d){return config.xScale(config.max)+config.padding-2}).attr("text-anchor","end").text(function(d){if(d.k==config.unusedKey){return""}return config.valueFormat(config.data[d.i][config.totalKey])})}else{gRow.append("text").attr("class","usage-value").attr("y",function(d,i){return yCall(d,i)+config.padding}).attr("x",function(d){return config.xScale(config.data[d.i][config.totalKey])+config.padding}).attr("text-anchor","start").text(function(d){if(d.k==config.unusedKey){return""}return config.valueFormat(config.data[d.i][config.totalKey])})}}}var bar=gRow.append("g").attr("class","bar");bar.append("rect").attr("class",function(d,i){return"bar"+d.ki}).style("fill",function(d,i){return colors(d.ki)}).attr("y",yCall).attr("x",function(d){return config.padding+config.xScale(d.y0)}).attr("height",config.barHeight).attr("width",function(d){return config.xScale(d.y)});var minWidth=38;bar.append("text").attr("class",function(d,i){var barSelectClass="bar"+d.ki;var barSmallClass=(config.xScale(d.y)>minWidth)?"":"barSmall"+d.ki;return"bar "+barSmallClass+" "+barSelectClass}).attr("y",function(d,i){return yCall(d,i)+(config.barHeight/1.5)}).attr("x",function(d){return config.padding+config.xScale(d.y0)+(config.xScale(d.y)/2)}).style("font",config.barTextFont).attr("text-anchor","middle").text(function(d){if(d.k==config.unusedKey){return""}var text=config.xAxisPercentageBased?(Math.round(d.y*100)/100+"%"):config.valueFormat(d.y);return text}).style("display",function(d,i){return(config.xScale(d.y)>minWidth)?"":"none"});if(config.isValuesTicksDisplayed){if(config.xAxisPercentageBased){bar.append("rect").attr("class","stroke").attr("y",function(d,i){return yCall(d,i)+config.barHeight}).attr("x",function(d){return config.xScale(d.y+d.y0)+config.padding-1}).attr("width","0.5").attr("height",config.barHeight/2).style("display",function(d,i){return(d.k==config.unusedKey)?"none":""});bar.append("text").attr("class","usage-tick-value").attr("y",function(d,i){return yCall(d,i)+config.barHeight+10}).attr("x",function(d){return config.xScale(d.y+d.y0)+config.padding-2}).attr("text-anchor","end").text(function(d){if(d.k==config.unusedKey){return""}return config.valueFormat(config.data[d.i][d.k])})}}if(config.tooltip!=null){bar.on("mouseover",function(d,i){var title=d.x;var yLabel=d.k;var yValue=config.data[d.i][d.k];var total=config.data[d.i][config.totalKey];var content=title+'  <font size="-2">(Total:'+total+")</font><br><b>"+yLabel+": "+yValue;if(config.xAxisPercentageBased){var percent=Math.round(d.y*100)/100;content+="("+percent+"%)"}config.customTooltip.showTooltip(content,(d3.event||window.event))}).on("mouseout",function(d,i){config.customTooltip.hideTooltip()})}if(config.clickAction!=null){bar.on("click",function(d,i){var title=d.x;var yLabel=d.k;var yValue=config.data[d.i][d.k];var total=config.data[d.i][config.totalKey];var actionType=config.clickAction.actionType;var actionTarget=config.clickAction.actionTarget;var actionUrl=config.clickAction.actionUrl;var actionUrlParams="data="+yLabel+","+yValue+","+title+"&keys="+config.titleKey+","+config.usedKeys;if(actionType=="callback"){eval(actionTarget+"(yLabel,yValue,title)")}else{UTILS.executeClickAction(actionType,actionTarget,actionUrl,actionUrlParams)}return})}};return config};
