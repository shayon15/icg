// chart_utils.js
var UTILS=UTILS||(function(){var re_render_charts_handler=function(evt){var list;if(document.getElementsByClassName){list=document.getElementsByClassName("chart-responsive")}else{var list1=document.getElementsByTagName("div");list=[];for(var i=list1.length-1;i>-1;i--){var el=list1[i];if(/chart-responsive/i.test(el.className)){list.push(el)}}}for(var i=list.length-1;i>-1;i--){var el=list[i];var divWidth=el.clientWidth;if(divWidth==null){return}el.innerHTML="";var renderFuncName="render_"+el.id;eval(renderFuncName+"("+divWidth+")")}};if(/Android|webOS|iPhone|iPad|iPod|BlackBerry/i.test(navigator.userAgent)){window.addEventListener("orientationchange",re_render_charts_handler,false)}else{window.addEventListener("resize",re_render_charts_handler,false)}var UTILS={};UTILS.CONSTANTS={};UTILS.CONSTANTS.SIMPLE_BARS=0;UTILS.CONSTANTS.GROUPED_BARS=1;UTILS.customTooltip=function(tooltipId,width,height){var tooltipId=tooltipId;var ttDiv=d3.select("body").append("div").attr("class","chart-tooltip").attr("id",tooltipId).style("opacity",1);hideTooltip();function showTooltip(content,event){ttDiv.html(content);ttDiv.style("display","");updatePosition(event)}function hideTooltip(){ttDiv.style("display","none")}function updatePosition(event){var tdiv=document.getElementById(tooltipId);var xOffset=20;var yOffset=10;var ttw=tdiv.clientWidth;var tth=tdiv.clientHeight;var wscrY=window.scrollY||window.pageYOffset;var wscrX=window.scrollX||window.pageXOffset;var curX=tdiv?event.clientX+wscrX:event.pageX;var curY=tdiv?event.clientY+wscrY:event.pageY;var ttleft=((curX-wscrX+xOffset*2+ttw)>window.outerWidth)?curX-ttw-xOffset*2:curX+xOffset;if(ttleft<wscrX+xOffset){ttleft=wscrX+xOffset}var tttop=((curY-wscrY+yOffset*2+tth)>window.outerHeight)?curY-tth-yOffset*2:curY+yOffset;if(tttop<wscrY+yOffset){tttop=curY+yOffset}ttDiv.style("top",tttop+"px").style("left",ttleft+"px")}return{showTooltip:showTooltip,hideTooltip:hideTooltip,updatePosition:updatePosition}};UTILS.second=1000;UTILS.minute=60*UTILS.second;UTILS.hour=60*UTILS.minute;UTILS.day=24*UTILS.hour;UTILS.week=7*UTILS.day;UTILS.month=30*UTILS.day;UTILS.month31=31*UTILS.day;UTILS.year=365*UTILS.day;UTILS.randomInt=function(start,end){if(!start){start=1}if(!end){end=1000}return Math.round((Math.random()*(end-start))+start)};UTILS.executeClickAction=function(actionType,actionTarget,actionUrl,actionUrlParams,chartDivID){var actionUrlWithParams="";idx=actionUrl.indexOf("?");if(idx==-1){actionUrlWithParams=actionUrl+"?"+actionUrlParams}else{actionUrlWithParams=actionUrl+"&"+actionUrlParams}if(actionType=="newPopup"){if(typeof jQuery=="undefined"){window.showModalDialog(actionUrlWithParams,"","dialogWidth:300px; dialogHeight:200px; edge:sunken; center:yes; status:no; resizable:no; help:no")}else{if(typeof $().modal=="function"){UTILS.showPopupWindow(chartDivID,actionTarget,actionUrlWithParams)}else{window.showModalDialog(actionUrlWithParams,"","dialogWidth:300px; dialogHeight:200px; edge:sunken; center:yes; status:no; resizable:no; help:no")}}}if(actionType=="newWindow"){window.open(actionUrlWithParams,"_blank","menubar, toolbar, location, directories, status, scrollbars, resizable, dependent, width=640, height=480, left=0, top=0","false");window.focus()}if(actionType=="divTarget"){UTILS.getUrlContent(actionTarget,actionUrlWithParams)}if(actionType=="iframeTarget"){var iframe=document.getElementById(actionTarget);iframe.src=actionUrlWithParams}return};UTILS.getUrlContent=function(divID,url){var xmlhttp;if(window.XMLHttpRequest){xmlhttp=new XMLHttpRequest()}else{xmlhttp=new ActiveXObject("Microsoft.XMLHTTP")}xmlhttp.onreadystatechange=function(){if(xmlhttp.readyState==4&&xmlhttp.status==200){div=document.getElementById(divID);div.innerHTML=xmlhttp.responseText;var x=div.getElementsByTagName("script");for(var i=0;i<x.length;i++){eval(x[i].text)}}};xmlhttp.open("GET",url,true);xmlhttp.send()};UTILS.showPopupWindow=function(chartDivID,targetID,urlWithParams){var popupID=chartDivID+"_popup";$("#"+popupID).modal({backdrop:false});UTILS.getUrlContent(popupID+"_content",urlWithParams)};UTILS.removeDuplicatesInList=function(list){var tmplist=[];list.forEach(function(d){if(tmplist.indexOf(d)==-1){tmplist.push(d)}});return tmplist};UTILS.chart_legends=function(){var config={data:[],actualNames:null,colors:d3.scale.category20(),x:0,y:0,width:100,height:100,fontStyle:"10px Verdana",dotSize:5,dotType:"circle",padding:10,chartWidthOffset:8,chartHeightOffset:8,layoutStyle:"left2right@width"};var config_keys=Object.keys(config);var thisPane=function(parentPanel){var mainPanel=(parentPanel instanceof String)?d3.select(parentPanel):parentPanel;_drawLegends(mainPanel)};thisPane.attr=function(name,value){switch(arguments.length){case 0:return null;case 1:return config[name];default:if(config_keys.indexOf(name)==-1){console.log("[UTILS.chart_legends]","WARNING","Invalid attribute :",name)}config[name]=UTILS.defaultValue(value,config[name]);break}return thisPane};thisPane.getLegends=function(){return config.legends};_drawLegends=function(mainpanel){var legendpanel=mainpanel.append("g").attr("class","legendpanel");var entry=legendpanel.selectAll("g").data(config.data).enter().append("g").attr("class",function(d,i){return"legend entry"+i});config.legends=entry;config.hasNamedColors=UTILS.isOrdinalScaleWithNames(config.colors);if(config.hasNamedColors&&config.actualNames==null){config.actualNames=config.data}var legendDotRadius=config.dotSize;var chartWidthOffset=config.chartWidthOffset;var chartHeightOffset=config.chartHeightOffset;var startAtX=config.x;var startAtY=config.y;var colPadding=config.padding;var rowPadding=config.padding;var calc={};calc.getLegendWidth=function(noOfChars){return(noOfChars*chartWidthOffset)+(legendDotRadius*2)+colPadding};var legendMax=d3.max(config.data.map(function(d,i){return d.length}));var maxColWith=calc.getLegendWidth(legendMax);var maxRowHeight=chartHeightOffset+rowPadding;var len=config.data.length;if(config.layoutStyle.indexOf("@width")!=-1){calc.noOfCols=Math.floor(config.width/maxColWith);if(calc.noOfCols<=0){calc.noOfCols=1}calc.noOfRows=Math.ceil(len/calc.noOfCols)}else{calc.noOfRows=Math.floor(config.height/(maxRowHeight));if(calc.noOfRows<1){calc.noOfRows=1}calc.noOfCols=Math.ceil(len/calc.noOfRows)}if(config.layoutStyle.indexOf("left2right")!=-1){calc.getColNo=function(i){return Math.floor(i%calc.noOfCols)};calc.getRowNo=function(i){return Math.floor(i/calc.noOfCols)}}else{calc.getColNo=function(i){return Math.floor(i/calc.noOfRows)};calc.getRowNo=function(i){return Math.floor(i%calc.noOfRows)}}var listPerColWidth=[];config.data.forEach(function(d,i){var colNo=calc.getColNo(i);var dlen=d.length;if(listPerColWidth[colNo]==undefined||listPerColWidth[colNo]<dlen){listPerColWidth[colNo]=dlen}});var colPositions=[];for(var i=0;i<calc.noOfCols;i++){var x;if(i==0){x=startAtX}else{var w0=listPerColWidth[i-1];var x0=colPositions[i-1];x=x0+calc.getLegendWidth(w0)}colPositions[i]=x}var xcall=function(d,i){var colNo=calc.getColNo(i);var x=colPositions[colNo];return x};var ycall=function(d,i){var rowNo=calc.getRowNo(i);return startAtY+(rowNo*maxRowHeight)};entry.append("text").attr("x",function(d,i){return xcall(d,i)+legendDotRadius*2}).attr("y",ycall).attr("dy",".35em").attr("text-anchor","start").text(function(d,i){return d}).style("font",config.fontStyle);if(config.dotType=="square"){var dot=entry.append("rect").attr("x",function(d,i){return xcall(d,i)-legendDotRadius}).attr("y",function(d,i){return ycall(d,i)-legendDotRadius}).attr("width",legendDotRadius*2).attr("height",legendDotRadius*2).attr("fill",function(d,i){return(config.hasNamedColors)?config.colors(config.actualNames[i]):config.colors(i)})}else{entry.append("circle").attr("cx",xcall).attr("cy",ycall).attr("r",legendDotRadius).attr("fill",function(d,i){return(config.hasNamedColors)?config.colors(config.actualNames[i]):config.colors(i)})}};return thisPane};UTILS.parseBool=function(value,defaultValue){if(value!=null){if(typeof value==="string"){return(["true","on","yes","y","t"].indexOf(value.toLowerCase())!=-1)}else{return(value)?true:false}}else{return(arguments.length>1&&(defaultValue))?true:false}};UTILS.parseInt=function(text,defaultValue){if(text==null||text==""||text=="default"){return(arguments.length>1)?defaultValue:0}else{var num=parseInt(text);return isNaN(num)?(arguments.length>1)?defaultValue:0:num}};UTILS.defaultValue=function(value,defaultValue){if(value==null||value==""||value=="default"){return(arguments.length>1)?defaultValue:""}else{return value}};UTILS.getUniqueid=function(){return"id_"+(new String(Math.random())).replace(".","_")+"_"+(new Date()).getTime()};UTILS.isOrdinalScaleWithNames=function(scale){var domain=scale.domain();return(domain.length>0&&(typeof domain[0]==="string"))};UTILS._chart_axis=function(type){var attrs={type:type,ticks:5,x:null,y:null,scale:null,chartWidth:0,chartHeight:0,axisStyle:{},labelOffset:50,labelFontStyle:"10px Verdana"};var attrs_keys=Object.keys(attrs);var thisAxis=function(parentPanel){var mainPanel=(parentPanel instanceof String)?d3.select(parentPanel):parentPanel;_renderAxis(mainPanel)};thisAxis.attr=function(name,value){switch(arguments.length){case 0:return null;case 1:return attrs[name];default:if(attrs_keys.indexOf(name)==-1){console.log("[UTILS.chart-"+type+"]","WARNING","Invalid attribute :",name)}attrs[name]=UTILS.defaultValue(value,attrs[name]);break}return thisAxis};thisAxis.getAxis=function(){return thisAxis.axis};var _renderAxis=function(mainpanel){var config={};var label=attrs.axisStyle.label;config.tickDisplayAngle=UTILS.parseInt(attrs.axisStyle.tickDisplayAngle,null);config.ticks=UTILS.parseInt(attrs.axisStyle.ticks,null);var tformat=attrs.axisStyle.tickformat;if(typeof tformat=="function"||tformat.indexOf("d3")>=0){config.tickFormat=eval(tformat)}else{if(tformat!=null&&tformat!=="default"&&tformat!==""){config.tickFormat=d3.format(tformat)}}config.labelFontStyle=UTILS.defaultValue(attrs.axisStyle.labelFontStyle,attrs.labelFontStyle);config.labelOffset=UTILS.defaultValue(attrs.axisStyle.labelOffset,attrs.labelOffset);config.d3axis_x=(attrs.x==null)?0:attrs.x;config.d3axis_y=(attrs.y==null)?0:attrs.y;config.hasGridLines=UTILS.parseBool(attrs.axisStyle.hasGridLines,false);switch(type){case"y-axis":config.className="y";config.axisPosition=(attrs.axisStyle.position=="in")?"right":"left";if(label!=null&&label!==""){config.label_x=-(attrs.chartHeight/2);config.label_y=-config.labelOffset;config.label_transform="rotate(-90)"}config.addGridNewLine=function(d,i){var g=d3.select(this);var line=g.append("line");line.attr("x2",0).attr("y2",0).attr("x1",attrs.chartWidth)};break;case"x-axis-horizontal":config.className="x";config.axisPosition=(attrs.axisStyle.position=="in")?"bottom":"top";if(label!=null&&label!==""){config.label_x=attrs.chartWidth/2;config.label_y=-config.labelOffset;config.label_transform=""}config.addGridNewLine=function(d,i){var g=d3.select(this);var line=g.append("line");line.attr("y2",0).attr("x2",0).attr("y1",attrs.chartHeight)};break;case"x-axis":default:config.className="x";config.axisPosition=(attrs.axisStyle.position=="in")?"top":"bottom";config.d3axis_y=(attrs.y==null)?attrs.chartHeight:attrs.y;if(label!=null&&label!==""){config.label_x=attrs.chartWidth/2;config.label_y=attrs.chartHeight+config.labelOffset;config.label_transform=""}config.addGridNewLine=function(d,i){var g=d3.select(this);var line=g.append("line");line.attr("y2",0).attr("x2",0).attr("y1",-attrs.chartHeight)};break}var d3Axis=d3.svg.axis().scale(attrs.scale).orient(config.axisPosition);if(config.ticks!=null){d3Axis.ticks(config.ticks)}if(config.tickFormat!=null){d3Axis.tickFormat(config.tickFormat)}thisAxis.axis=d3Axis;var axisSvg=mainpanel.append("g").attr("class",config.className+" axis").attr("transform","translate("+config.d3axis_x+","+config.d3axis_y+")").call(d3Axis);if(config.tickDisplayAngle!=null){axisSvg.selectAll("text").attr("transform","rotate("+config.tickDisplayAngle+")")}if(config.hasGridLines){axisSvg.selectAll(".tick.major").each(config.addGridNewLine)}if(label!=null&&label!==""){mainpanel.append("g").attr("class",config.className+" label").append("text").attr("transform",config.label_transform).attr("text-anchor","middle").attr("x",config.label_x).attr("y",config.label_y).text(label).style("font",config.labelFontStyle)}};return function(){return thisAxis}};UTILS.chart_x_axis=UTILS._chart_axis("x-axis");UTILS.chart_x_axis_horizontal=UTILS._chart_axis("x-axis-horizontal");UTILS.chart_y_axis=UTILS._chart_axis("y-axis");UTILS.appendErrMsg=function(containerID,err){var errMsg=err&&err.message?err.message:err;var errStack=escape(err.stack?err.stack:"");var _div=d3.select(containerID);_div.html(_div.html()+"<br/><div><img src='/iwap/css/images/warning_sign.png' width='15px' height='15px' alt='"+errStack+"' onclick='alert(unescape(this.alt));' /><span class='errmsg'>Error: "+errMsg+"</span></div>")};return UTILS})(window);
// chart_pie.js
function chart_pie(){var a=_chart_pie_config();var b=function(c){try{a.drawChart(c)}catch(d){UTILS.appendErrMsg(c,d);throw d}};b.data=function(c){if(!arguments.length){return a.data}a.data=c;return b};b.keys=function(c){if(!arguments.length){return a.keys}a.keys=c;return b};b.legendStyle=function(c){if(!arguments.length){return a.legendStyle}a.legendStyle=c;return b};b.chartStyle=function(c){if(!arguments.length){return a.chartStyle}a.chartStyle=c;return b};b.colors=function(c){if(!arguments.length){return a.colors}a.colors=c;return b};b.tooltip=function(c){if(!arguments.length){return a.tooltip}a.tooltip=c;return b};b.clickAction=function(c){if(!arguments.length){return a.clickAction}a.clickAction=c;return b};b.responsiveWidth=function(c){if(!arguments.length){return a.responsiveWidth}a.responsiveWidth=c;return b};return b}function _chart_pie_config(){var config={chartType:"pie",data:[],keys:[],legendStyle:null,chartStyle:[],colors:d3.scale.category20(),tooltip:null,clickAction:null,responsiveWidth:0};config.drawChart=function(chartContainerID){config.uniqueid=chartContainerID.substring(1);if(config.tooltip!=null){config.customTooltip=UTILS.customTooltip(config.uniqueid+"_tooltip",config.tooltip.width,config.tooltip.height)}config.innerRadius=parseInt(config.chartStyle.innerRadius);config.outerRadius=parseInt(config.chartStyle.outerRadius);config.width=config.outerRadius*2;config.height=config.outerRadius*2;if(config.legendStyle!=null){config.legendWidth=parseInt(config.legendStyle.width);config.legendHeight=parseInt(config.legendStyle.height);if(config.legendStyle.position=="right"){config.width+=config.legendWidth;if(config.height<config.legendHeight){config.height=config.legendHeight}}else{if(config.width<config.legendWidth){config.width=config.legendWidth}config.height+=config.legendHeight}}var responsiveWidth=parseInt(config.responsiveWidth);if(responsiveWidth>0&&responsiveWidth<config.width){var innerRadiusPercent=(config.innerRadius/config.width)*100;var outerRadiusPercent=(config.outerRadius/config.width)*100;config.innerRadius=(responsiveWidth*innerRadiusPercent)/100;config.outerRadius=(responsiveWidth*outerRadiusPercent)/100;if(config.outerRadius>(config.height/2)){config.outerRadius=config.height/2}config.width=responsiveWidth}config.hasNamedColors=UTILS.isOrdinalScaleWithNames(config.colors);var labels=[],values=[],matchedColors=[];for(var i=0;i<config.data.length;i++){var d=config.data[i];labels[i]=d[config.keys[0]];values[i]=d[config.keys[1]];matchedColors[i]=config.hasNamedColors?config.colors(labels[i]):config.colors(i)}config.labels=labels;config.values=values;config.matchedColors=matchedColors;config.sum=d3.sum(config.values);config.percentage=[];for(var i=0;i<config.values.length;i++){config.percentage[i]=Math.round(config.values[i]/config.sum*100*100)/100}var vis=d3.select(chartContainerID).append("svg").attr("width",config.width).attr("height",config.height).attr("id",config.uniqueid+"_svg");var donut=d3.layout.pie();var arc=d3.svg.arc().innerRadius(config.innerRadius).outerRadius(config.outerRadius);var arcs=vis.selectAll("g.arc").data(donut(config.values)).enter().append("g").attr("class",function(d,i){return"arc arc"+i}).attr("transform","translate("+config.outerRadius+","+config.outerRadius+")");var wedge=arcs.append("path").attr("fill",function(d,i){return config.matchedColors[i]}).attr("d",arc);if((config.innerRadius==0&&(config.outerRadius-config.innerRadius)>80)||(config.innerRadius>0&&(config.outerRadius-config.innerRadius)>=50)){var textOffset=config.innerRadius!=0?1:1.5;var label=arcs.append("text").attr("transform",function(d){var c=arc.centroid(d);return"translate("+c[0]*textOffset+","+c[1]*textOffset+")"}).attr("dy",".35em").attr("text-anchor","middle").attr("display",function(d){return d.value>0.15?null:"none"}).text(function(d,i){var percent;if(parseInt(config.percentage[i])>+7){percent=config.percentage[i]+"%"}else{percent=""}return percent}).style("font","10px sans-serif")}if(config.legendStyle!=null){config.drawLegendList(vis,arcs);var legends=config.legends;legends.on("mouseover",function(d,i){vis.select(".arc"+i).style("opacity","0.5");if(config.tooltip!=null){var content=config.getTooltipContent(i);config.customTooltip.showTooltip(content,(d3.event||window.event))}}).on("mouseout",function(d,i){vis.select(".arc"+i).style("opacity","");if(config.tooltip!=null){config.customTooltip.hideTooltip()}})}if(config.tooltip!=null){arcs.on("mouseover",function(d,i){var content=config.getTooltipContent(i);config.customTooltip.showTooltip(content,(d3.event||window.event))}).on("mouseout",function(d,i){config.customTooltip.hideTooltip()})}if(config.clickAction!=null){arcs.style("cursor","pointer");arcs.on("click",function(d,i){config.doClickAction(i)});if(config.legends!=null){var legends=config.legends;legends.on("click",function(d,i){config.doClickAction(i)})}}return config};config.getTooltipContent=function(i){var percent=config.percentage[i]+"%";var content=config.labels[i]+"<br/> <b>"+config.values[i]+" ("+percent+")";return content};config.doClickAction=function(i){var actionType=config.clickAction.actionType;var actionTarget=config.clickAction.actionTarget;var actionUrl=config.clickAction.actionUrl;var label=config.labels[i];var value=config.values[i];var actionUrlParams="data="+label+","+value+"&keys="+config.keys[0]+","+config.keys[1];if(actionType=="callback"){eval(actionTarget+"(label,value)")}else{UTILS.executeClickAction(actionType,actionTarget,actionUrl,actionUrlParams,config.uniqueid)}return};config.drawLegendList=function(vis,arcs){var textOffset=20;var dotOffset=textOffset-10;if(config.legendStyle.position=="right"){legendXPos=(config.outerRadius*2)+textOffset;yOffset=10}else{if(config.legendStyle.position=="bottom"){legendXPos=textOffset;yOffset=(config.outerRadius*2)+textOffset}}var legends=config.labels.map(function(d,i){return d+" ("+(+config.values[i])+")"});var chart_legends=UTILS.chart_legends().attr("data",legends).attr("colors",config.colors).attr("width",config.legendWidth).attr("height",config.legendHeight).attr("x",legendXPos).attr("y",yOffset);if(config.hasNamedColors){chart_legends.attr("actualNames",config.labels)}chart_legends(vis);config.legends=chart_legends.getLegends()};return config};
// chart_bar.js
function chart_bar(){var a=_bar_chart_config();var b=function(c){try{a.drawChart(c)}catch(d){UTILS.appendErrMsg(c,d);throw d}};b.data=function(c){if(!arguments.length){return a.data}a.data=c;return b};b.keys=function(c){if(!arguments.length){return a.keys}a.keys=c;return b};b.legendStyle=function(c){if(!arguments.length){return a.legendStyle}a.legendStyle=c;return b};b.chartStyle=function(c){if(!arguments.length){return a.chartStyle}a.chartStyle=c;return b};b.hAxis=function(c){if(!arguments.length){return a.hAxis}a.hAxis=c;return b};b.vAxis=function(c){if(!arguments.length){return a.vAxis}a.vAxis=c;return b};b.colors=function(c){if(!arguments.length){return a.colors}a.colors=c;return b};b.tooltip=function(c){if(!arguments.length){return a.tooltip}a.tooltip=c;return b};b.clickAction=function(c){if(!arguments.length){return a.clickAction}a.clickAction=c;return b};b.responsiveWidth=function(c){if(!arguments.length){return a.responsiveWidth}a.responsiveWidth=c;return b};return b}function _bar_chart_config(){var config={chartType:"bar",barStyle:UTILS.CONSTANTS.GROUPED_BARS,data:[],keys:null,legendStyle:[],chartStyle:[],colors:d3.scale.category20(),hAxis:null,vAxis:null,tooltip:[],responsiveWidth:0,clickAction:null};config.drawChart=function(chartContainerID){config.uniqueid=chartContainerID.substring(1);config.xkey=config.keys[0];config.ykeys=(typeof config.keys[1]==="string")?[config.keys[1]]:config.keys[1];config.width=parseInt(config.chartStyle.width);config.height=parseInt(config.chartStyle.height);if(config.tooltip!=null){config.customTooltip=UTILS.customTooltip(config.uniqueid+"_tooltip",config.tooltip.width,config.tooltip.height)}var responsiveWidth=parseInt(config.responsiveWidth);if(responsiveWidth>0&&responsiveWidth<config.width){config.width=responsiveWidth}config.hasNamedColors=UTILS.isOrdinalScaleWithNames(config.colors);if(config.ykeys.length==1){config.barStyle=UTILS.CONSTANTS.SIMPLE_BARS}else{config.barStyle=UTILS.CONSTANTS.GROUPED_BARS}config.x=config.data.map(function(d){return d[config.xkey]});config.y=config.data.map(function(d){return config.ykeys.map(function(k){return d[k]})});config.legends=config.ykeys;var max=0;for(var i=0;i<config.y.length;i++){var d3max=d3.max(config.y[i],function(d){return +d});if(d3max>max){max=d3max}}var xAxisBottomPadding=0;if(config.hAxis!==null){if(config.hAxis.position=="out"){xAxisBottomPadding+=30}else{if(config.hAxis.position=="in"){xAxisBottomPadding+=10}}if(config.hAxis.label!==""){xAxisBottomPadding+=20}}var yAxisLeftPadding=0;var panelOffsetY=0;if(config.vAxis!==null){if(xAxisBottomPadding<15){xAxisBottomPadding=15}panelOffsetY=10;if(config.vAxis.position=="out"){yAxisLeftPadding+=40}else{if(config.vAxis.position=="in"){yAxisLeftPadding+=5}}if(config.vAxis.label!==""){yAxisLeftPadding+=20}}var legendWidth=0;var legendHeight=0;if(config.legendStyle!==null){legendWidth=parseInt(config.legendStyle.width);legendHeight=parseInt(config.legendStyle.height)}var actualChartWidth=config.width-yAxisLeftPadding;var actualChartHeight=config.height-xAxisBottomPadding;config.xScale=d3.scale.ordinal().domain(config.x).rangeRoundBands([0,actualChartWidth],0.1);config.yScale=d3.scale.linear().domain([0,max]).range([actualChartHeight,0]);config.hScale=d3.scale.linear().domain([0,max]).range([0,actualChartHeight]);config.m=config.y[0].length;var container=d3.select(chartContainerID);var totalWidth,totalHeight;if(config.legendStyle==null||config.legendStyle.position=="right"){totalWidth=config.width+legendWidth;totalHeight=(config.height>legendHeight)?config.height:legendHeight}else{totalWidth=(config.width>legendWidth)?config.width:legendWidth;totalHeight=config.height+legendHeight}var mainpanel=container.append("svg").attr("width",totalWidth).attr("height",totalHeight).attr("class","barchart");var panel=mainpanel.append("g").attr("transform","translate("+yAxisLeftPadding+","+panelOffsetY+")");var spanel=panel.selectAll("g").data(config.y).enter().append("g").attr("class","category").attr("transform",function(d,i){return"translate("+config.xScale(config.x[i])+",0)"}).each(function(d,i){var category=d3.select(this);config._drawBar(d,i,category)});if(config.clickAction!=null){spanel.style("cursor","pointer")}if(config.hAxis!=null){config.hAxis.labelOffset=xAxisBottomPadding-15;var xAxis=UTILS.chart_x_axis().attr("scale",config.xScale).attr("axisStyle",config.hAxis).attr("chartWidth",actualChartWidth).attr("chartHeight",actualChartHeight);xAxis(panel)}if(config.vAxis!=null){config.vAxis.labelOffset=yAxisLeftPadding-15;if(config.vAxis.ticks=="default"){config.vAxis.ticks=((actualChartHeight/100)*3)}var yAxis=UTILS.chart_y_axis().attr("scale",config.yScale).attr("axisStyle",config.vAxis).attr("chartWidth",actualChartWidth).attr("chartHeight",actualChartHeight);yAxis(panel)}if(config.legendStyle!=null){var llegends;if(config.barStyle==UTILS.CONSTANTS.GROUPED_BARS){llegends=config.legends}else{llegends=config.data.map(function(d){return d[config.xkey]+" ("+(+d[config.ykeys[0]])+")"})}var chart_legends=UTILS.chart_legends().attr("data",llegends).attr("actualNames",config.x).attr("colors",config.colors).attr("width",legendWidth).attr("height",legendHeight).attr("dotType","circle");if(config.legendStyle.position=="right"){chart_legends.attr("x",(actualChartWidth+yAxisLeftPadding+15)).attr("y",10)}else{chart_legends.attr("x",(5+yAxisLeftPadding)).attr("y",(actualChartHeight+xAxisBottomPadding+25))}chart_legends(mainpanel)}};config._drawBar=function(p,q,parent){var bar=parent.selectAll(".chart").data(p).enter().append("rect").attr("class","bar").attr("y",function(d,i){return config.yScale(d)}).attr("x",function(d,i){return i*config.xScale.rangeBand()/config.m}).attr("width",function(d){return config.xScale.rangeBand()/config.m}).attr("height",function(d){return config.hScale(d)}).style("fill",function(d,i){if(config.barStyle==UTILS.CONSTANTS.GROUPED_BARS){return config.colors(i)}else{return config.hasNamedColors?config.colors(config.x[q]):config.colors(q)}});if(config.tooltip!=null){bar.on("mouseover",function(d,i){content=config.x[q]+"<br/>"+config.legends[i]+" = <b>"+d+"</b>";config.customTooltip.showTooltip(content,(d3.event||window.event))}).on("mouseout",function(d,i){config.customTooltip.hideTooltip()})}if(config.clickAction!=null){bar.on("click",function(d,i){var actionType=config.clickAction.actionType;var actionTarget=config.clickAction.actionTarget;var actionUrl=config.clickAction.actionUrl;var actionUrlParams="data="+config.x[q]+","+d+"&keys="+config.xkey+","+config.legends[i];if(actionType=="callback"){eval(actionTarget+"(config.x[q],d)")}else{UTILS.executeClickAction(actionType,actionTarget,actionUrl,actionUrlParams)}return})}};return config};
// chart_bar_horizonal.js
function chart_bar_horizontal(){var a=_bar_horizontal_chart_config();var b=function(c){try{a.drawChart(c)}catch(d){UTILS.appendErrMsg(c,d);throw d}};b.data=function(c){if(!arguments.length){return a.data}a.data=c;return b};b.keys=function(c){if(!arguments.length){return a.keys}a.keys=c;return b};b.legendStyle=function(c){if(!arguments.length){return a.legendStyle}a.legendStyle=c;return b};b.chartStyle=function(c){if(!arguments.length){return a.chartStyle}a.chartStyle=c;return b};b.hAxis=function(c){if(!arguments.length){return a.hAxis}a.hAxis=c;return b};b.vAxis=function(c){if(!arguments.length){return a.vAxis}a.vAxis=c;return b};b.colors=function(c){if(!arguments.length){return a.colors}a.colors=c;return b};b.tooltip=function(c){if(!arguments.length){return a.tooltip}a.tooltip=c;return b};b.clickAction=function(c){if(!arguments.length){return a.clickAction}a.clickAction=c;return b};b.responsiveWidth=function(c){if(!arguments.length){return a.responsiveWidth}a.responsiveWidth=c;return b};return b}function _bar_horizontal_chart_config(){var config={chartType:"bar",barStyle:UTILS.CONSTANTS.GROUPED_BARS,data:[],keys:null,legendStyle:[],chartStyle:[],colors:d3.scale.category20(),hAxis:null,vAxis:null,tooltip:[],responsiveWidth:0,clickAction:null};config.drawChart=function(chartContainerID){config.uniqueid=chartContainerID.substring(1);config.xkey=config.keys[0];config.ykeys=(typeof config.keys[1]==="string")?[config.keys[1]]:config.keys[1];config.width=parseInt(config.chartStyle.width);config.height=parseInt(config.chartStyle.height);if(config.tooltip!=null){config.customTooltip=UTILS.customTooltip(config.uniqueid+"_tooltip",config.tooltip.width,config.tooltip.height)}var responsiveWidth=parseInt(config.responsiveWidth);if(responsiveWidth>0&&responsiveWidth<config.width){config.width=responsiveWidth}config.hasNamedColors=UTILS.isOrdinalScaleWithNames(config.colors);if(config.ykeys.length==1){config.barStyle=UTILS.CONSTANTS.SIMPLE_BARS}else{config.barStyle=UTILS.CONSTANTS.GROUPED_BARS}config.y=config.data.map(function(d){return d[config.xkey]});config.x=config.data.map(function(d){return config.ykeys.map(function(k){return d[k]})});config.legends=config.ykeys;var max=0;for(var i=0;i<config.y.length;i++){var d3max=d3.max(config.x[i],function(d){return +d});if(d3max>max){max=d3max}}var xAxisTopPadding=0;var xAxisBottomPadding=25;if(config.hAxis!==null){if(config.hAxis.position=="out"){xAxisTopPadding=xAxisTopPadding+30}else{if(config.hAxis.position=="in"){xAxisTopPadding+=10}}if(config.hAxis.label!==""){xAxisTopPadding=xAxisTopPadding+20}}var yAxisLeftPadding=0;var yAxisRightPadding=25;var panelOffsetY=0;if(config.vAxis!==null){if(xAxisBottomPadding<15){xAxisBottomPadding=15}panelOffsetY=10;if(config.vAxis.position=="out"){yAxisLeftPadding+=40}else{if(config.vAxis.position=="in"){yAxisLeftPadding+=5}}if(config.vAxis.label!==""){yAxisLeftPadding+=20}if(config.legends!=null&&config.legends.position=="right"){yAxisRightPadding+=10}}var legendWidth=0;var legendHeight=0;if(config.legendStyle!==null){legendWidth=parseInt(config.legendStyle.width);legendHeight=parseInt(config.legendStyle.height)}var actualChartWidth=config.width-(yAxisLeftPadding+yAxisRightPadding);var actualChartHeight=config.height-(xAxisBottomPadding+xAxisTopPadding);config.xScale=d3.scale.linear().domain([0,max]).range([0,actualChartWidth]);config.yScale=d3.scale.ordinal().domain(config.y).rangeRoundBands([0,actualChartHeight],0.1);config.hScale=d3.scale.linear().domain([0,max]).range([0,actualChartWidth]);config.m=config.x[0].length;var container=d3.select(chartContainerID);var totalWidth,totalHeight;if(config.legendStyle==null||config.legendStyle.position=="right"){totalWidth=config.width+legendWidth;totalHeight=(config.height>legendHeight)?config.height:legendHeight}else{totalWidth=(config.width>legendWidth)?config.width:legendWidth;totalHeight=config.height+legendHeight}var mainpanel=container.append("svg").attr("width",totalWidth).attr("height",totalHeight).attr("class","barchart");var panel=mainpanel.append("g").attr("transform","translate("+yAxisLeftPadding+","+(panelOffsetY+xAxisTopPadding)+")");var spanel=panel.selectAll("g").data(config.x).enter().append("g").attr("class","category").attr("transform",function(d,i){return"translate(0,"+config.yScale(config.y[i])+")"}).each(function(d,i){var category=d3.select(this);config._drawBar(d,i,category)});if(config.clickAction!=null){spanel.style("cursor","pointer")}if(config.hAxis!=null){config.hAxis.labelOffset=xAxisTopPadding-15;if(config.hAxis.ticks=="default"){config.hAxis.ticks=((actualChartWidth/100)*3)}var xAxis=UTILS.chart_x_axis_horizontal().attr("scale",config.xScale).attr("axisStyle",config.hAxis).attr("chartWidth",actualChartWidth).attr("chartHeight",actualChartHeight);xAxis(panel)}if(config.vAxis!=null){config.vAxis.labelOffset=yAxisLeftPadding-15;var yAxis=UTILS.chart_y_axis().attr("scale",config.yScale).attr("axisStyle",config.vAxis).attr("chartWidth",actualChartWidth).attr("chartHeight",actualChartHeight);yAxis(panel)}if(config.legendStyle!=null){var llegends;if(config.barStyle==UTILS.CONSTANTS.GROUPED_BARS){llegends=config.legends}else{llegends=config.data.map(function(d){return d[config.xkey]+" ("+(+d[config.ykeys[0]])+")"})}var chart_legends=UTILS.chart_legends().attr("data",llegends).attr("actualNames",config.y).attr("colors",config.colors).attr("width",legendWidth).attr("height",legendHeight).attr("dotType","circle");if(config.legendStyle.position=="right"){chart_legends.attr("x",(actualChartWidth+yAxisLeftPadding+yAxisRightPadding)).attr("y",(xAxisTopPadding+15))}else{chart_legends.attr("x",(5+yAxisLeftPadding)).attr("y",(actualChartHeight+xAxisTopPadding+xAxisBottomPadding))}chart_legends(mainpanel)}};config._drawBar=function(p,q,parent){var bar=parent.selectAll(".chart").data(p).enter().append("rect").attr("class","bar").attr("y",function(d,i){return(i*config.yScale.rangeBand()/config.m)}).attr("x",function(d,i){return 0}).attr("width",function(d){return config.xScale(d)}).attr("height",function(d){return config.yScale.rangeBand()/config.m}).style("fill",function(d,i){if(config.barStyle==UTILS.CONSTANTS.GROUPED_BARS){return config.colors(i)}else{return config.hasNamedColors?config.colors(config.y[q]):config.colors(q)}});if(config.tooltip!=null){bar.on("mouseover",function(d,i){content=config.y[q]+"<br/>"+config.legends[i]+" = <b>"+d+"</b>";config.customTooltip.showTooltip(content,(d3.event||window.event))}).on("mouseout",function(d,i){config.customTooltip.hideTooltip()})}if(config.clickAction!=null){bar.on("click",function(d,i){var actionType=config.clickAction.actionType;var actionTarget=config.clickAction.actionTarget;var actionUrl=config.clickAction.actionUrl;var actionUrlParams="data="+config.y[q]+","+d+"&keys="+config.xkey+","+config.legends[i];if(actionType=="callback"){eval(actionTarget+"(config.y[q],d)")}else{UTILS.executeClickAction(actionType,actionTarget,actionUrl,actionUrlParams)}return})}};return config};
// chart_bar_stacked.js
function chart_bar_stacked(){var a=_bar_stacked_chart_config();var b=function(c){try{a.drawChart(c)}catch(d){UTILS.appendErrMsg(c,d);throw d}};b.data=function(c){if(!arguments.length){return a.data}a.data=c;return b};b.keys=function(c){if(!arguments.length){return a.keys}a.keys=c;return b};b.legendStyle=function(c){if(!arguments.length){return a.legendStyle}a.legendStyle=c;return b};b.chartStyle=function(c){if(!arguments.length){return a.chartStyle}a.chartStyle=c;return b};b.hAxis=function(c){if(!arguments.length){return a.hAxis}a.hAxis=c;return b};b.vAxis=function(c){if(!arguments.length){return a.vAxis}a.vAxis=c;return b};b.colors=function(c){if(!arguments.length){return a.colors}a.colors=c;return b};b.tooltip=function(c){if(!arguments.length){return a.tooltip}a.tooltip=c;return b};b.clickAction=function(c){if(!arguments.length){return a.clickAction}a.clickAction=c;return b};b.responsiveWidth=function(c){if(!arguments.length){return a.responsiveWidth}a.responsiveWidth=c;return b};return b}function _bar_stacked_chart_config(){var config={chartType:"bar_stacked",data:[],keys:null,legendStyle:[],chartStyle:[],colors:d3.scale.category20(),hAxis:null,vAxis:null,tooltip:[],responsiveWidth:0,clickAction:null};config.drawChart=function(chartContainerID){config.uniqueid=chartContainerID.substring(1);config.xkey=config.keys[0];config.ykeys=(typeof config.keys[1]==="string")?[config.keys[1]]:config.keys[1];config.width=parseInt(config.chartStyle.width);config.height=parseInt(config.chartStyle.height);if(config.tooltip!=null){config.customTooltip=UTILS.customTooltip(config.uniqueid+"_tooltip",config.tooltip.width,config.tooltip.height)}var responsiveWidth=parseInt(config.responsiveWidth);if(responsiveWidth>0&&responsiveWidth<config.width){config.width=responsiveWidth}config.hasNamedColors=UTILS.isOrdinalScaleWithNames(config.colors);config.x=config.data.map(function(d){return d[config.xkey]});config.y=config.data.map(function(d){return config.ykeys.map(function(k){return d[k]})});config.legends=config.ykeys;var max=0;config.ymax=0;config.ylegendMaxLen=0;config.dataLayers=config.ykeys.map(function(name,i){var l=name.length;if(l>config.ylegendMaxLen){config.ylegendMaxLen=l}return config.data.map(function(d){var yvalue=+d[name];if(yvalue>config.ymax){config.ymax=yvalue}return{x:d[config.xkey],y:yvalue,i:i}})});config.stackedData=d3.layout.stack()(config.dataLayers);config.yStackMax=d3.max(config.stackedData,function(data){return d3.max(data,function(d){return d.y0+d.y})});max=config.yStackMax;var xAxisBottomPadding=0;if(config.hAxis!==null){if(config.hAxis.position=="out"){xAxisBottomPadding+=30}else{if(config.hAxis.position=="in"){xAxisBottomPadding+=10}}if(config.hAxis.label!==""){xAxisBottomPadding+=20}}var yAxisLeftPadding=0;var panelOffsetY=0;if(config.vAxis!==null){if(xAxisBottomPadding<15){xAxisBottomPadding=15}panelOffsetY=10;if(config.vAxis.position=="out"){yAxisLeftPadding+=40}else{if(config.vAxis.position=="in"){yAxisLeftPadding+=5}}if(config.vAxis.label!==""){yAxisLeftPadding+=20}}var legendWidth=0;var legendHeight=0;if(config.legendStyle!==null){legendWidth=parseInt(config.legendStyle.width);legendHeight=parseInt(config.legendStyle.height)}var actualChartWidth=config.width-yAxisLeftPadding;var actualChartHeight=config.height-xAxisBottomPadding;config.xScale=d3.scale.ordinal().domain(config.x).rangeRoundBands([0,actualChartWidth],0.1);config.yScale=d3.scale.linear().domain([0,max]).range([actualChartHeight,0]);config.m=config.y[0].length;var container=d3.select(chartContainerID);var totalWidth,totalHeight;if(config.legendStyle==null||config.legendStyle.position=="right"){totalWidth=config.width+legendWidth;totalHeight=(config.height>legendHeight)?config.height:legendHeight}else{totalWidth=(config.width>legendWidth)?config.width:legendWidth;totalHeight=config.height+legendHeight}var mainpanel=container.append("svg").attr("width",totalWidth).attr("height",totalHeight).attr("class","barchart");var panel=mainpanel.append("g").attr("transform","translate("+yAxisLeftPadding+","+panelOffsetY+")");spanel=panel.selectAll("g").data(config.stackedData).enter().append("g").attr("class","category").style("fill",function(d,i){return config.hasNamedColors?config.colors(config.ykeys[i]):config.colors(i)}).each(function(d,i){var category=d3.select(this);config._drawBar(d,i,category)});if(config.clickAction!=null){spanel.style("cursor","pointer")}if(config.hAxis!=null){config.hAxis.labelOffset=xAxisBottomPadding-15;var xAxis=UTILS.chart_x_axis().attr("scale",config.xScale).attr("axisStyle",config.hAxis).attr("chartWidth",actualChartWidth).attr("chartHeight",actualChartHeight);xAxis(panel)}if(config.vAxis!=null){config.vAxis.labelOffset=yAxisLeftPadding-15;if(config.vAxis.ticks=="default"){config.vAxis.ticks=((actualChartHeight/100)*3)}var yAxis=UTILS.chart_y_axis().attr("scale",config.yScale).attr("axisStyle",config.vAxis).attr("chartWidth",actualChartWidth).attr("chartHeight",actualChartHeight);yAxis(panel)}if(config.legendStyle!=null){var chart_legends=UTILS.chart_legends().attr("data",config.legends).attr("colors",config.colors).attr("width",legendWidth).attr("height",legendHeight).attr("dotType","circle");if(config.legendStyle.position=="right"){chart_legends.attr("x",(actualChartWidth+yAxisLeftPadding+15)).attr("y",10)}else{chart_legends.attr("x",(5+yAxisLeftPadding)).attr("y",(actualChartHeight+xAxisBottomPadding+25))}chart_legends(mainpanel)}};config._drawBar=function(p,q,parent){var bar=parent.selectAll("rect").data(p).enter().append("rect").attr("class","bar").attr("x",function(d){return config.xScale(d.x)}).attr("y",function(d){return config.yScale(d.y0+d.y)}).attr("width",config.xScale.rangeBand()).attr("height",function(d){return(config.yScale(d.y0)-config.yScale(d.y0+d.y))});if(config.tooltip!=null){bar.on("mouseover",function(d,i){content=d.x+"<br/>"+config.legends[q]+" = <b>"+d.y+"</b>";config.customTooltip.showTooltip(content,(d3.event||window.event))}).on("mouseout",function(d,i){config.customTooltip.hideTooltip()})}if(config.clickAction!=null){bar.on("click",function(d,i){var actionType=config.clickAction.actionType;var actionTarget=config.clickAction.actionTarget;var actionUrl=config.clickAction.actionUrl;var actionUrlParams="data="+d.x+","+d.y+"&keys="+config.xkey+","+config.legends[q];if(actionType=="callback"){eval(actionTarget+"(d.x,d.y,config.legends[q])")}else{UTILS.executeClickAction(actionType,actionTarget,actionUrl,actionUrlParams)}return})}};return config};
// chart_bubble.js
function chart_bubble(){var a=_bubble_chart_config();var b=function(c){try{a.drawChart(c)}catch(d){UTILS.appendErrMsg(c,d);throw d}};b.data=function(c){if(!arguments.length){return a.data}a.data=c;return b};b.keys=function(c){if(!arguments.length){return a.keys}a.keys=c;return b};b.chartStyle=function(c){if(!arguments.length){return a.chartStyle}a.chartStyle=c;return b};b.colors=function(c){if(!arguments.length){return a.colors}a.colors=c;return b};b.tooltip=function(c){if(!arguments.length){return a.tooltip}a.tooltip=c;return b};b.clickAction=function(c){if(!arguments.length){return a.clickAction}a.clickAction=c;return b};b.responsiveWidth=function(c){if(!arguments.length){return a.responsiveWidth}a.responsiveWidth=c;return b};return b}function _bubble_chart_config(){var config={chartType:"bubble",data:[],keys:[],chartStyle:[],colors:d3.scale.category20(),tooltip:null,clickAction:null};config.drawChart=function(chartContainerID){config.uniqueid=chartContainerID.substring(1);if(config.tooltip!=null){config.customTooltip=UTILS.customTooltip(config.uniqueid+"_tooltip",config.tooltip.width,config.tooltip.height)}config.width=parseInt(config.chartStyle.width);config.height=parseInt(config.chartStyle.height);var responsiveWidth=parseInt(config.responsiveWidth);if(responsiveWidth>0&&responsiveWidth<config.width){config.width=responsiveWidth}var jsonData={name:"wordCloud",children:config.data};var format=d3.format(",g");var fill=config.colors;var bubble=d3.layout.pack().sort(null).size([config.width,config.height]);var container=d3.select(chartContainerID);var vis=container.append("svg").attr("width",config.chartStyle.width).attr("height",config.chartStyle.height).attr("class","bubble");var toClasses=function(root,keyList){var classes=[];function recurse(name,node){if(node.children){node.children.forEach(function(child){recurse(node[keyList[0]],child)})}else{classes.push({packageName:node[keyList[0]],className:node[keyList[0]],value:node[keyList[1]]})}}recurse(null,root);return{children:classes}};var classes=toClasses(jsonData,config.keys);var node=vis.selectAll(".node").data(bubble.nodes(classes).filter(function(d){return !d.children})).enter().append("g").attr("class","node").attr("transform",function(d){return"translate("+d.x+","+d.y+")"});if(config.tooltip!=null){node.on("mouseover",function(d,i){content=d.className+"<br/><b>"+format(+d.value)+"</b>";config.customTooltip.showTooltip(content,(d3.event||window.event))}).on("mouseout",function(d,i){config.customTooltip.hideTooltip()})}if(config.clickAction!=null){node.style("cursor","pointer");node.on("click",function(d,i){var actionType=config.clickAction.actionType;var actionTarget=config.clickAction.actionTarget;var actionUrl=config.clickAction.actionUrl;var actionUrlParams="data="+d.className+","+d.value+"&keys="+config.keys[0]+","+config.keys[1];if(actionType=="callback"){eval(actionTarget+"(d.className,d.value)")}else{UTILS.executeClickAction(actionType,actionTarget,actionUrl,actionUrlParams)}return})}node.append("circle").attr("r",function(d){return d.r}).style("fill",function(d){return fill(d.className)});node.append("text").attr("text-anchor","middle").attr("dy",".3em").text(function(d){return d.className.substring(0,d.r/4)}).style("font","12px Verdana")};return config};
// chart_timeline.js
function chart_timeline(){var a=_chart_timeline_config();var b=function(c){try{a.drawChart(c)}catch(d){UTILS.appendErrMsg(c,d);throw d}};b.data=function(c){if(!arguments.length){return a.data}a.data=c;return b};b.keys=function(c){if(!arguments.length){return a.keys}a.keys=c;return b};b.legendStyle=function(c){if(!arguments.length){return a.legendStyle}a.legendStyle=c;return b};b.chartStyle=function(c){if(!arguments.length){return a.chartStyle}a.chartStyle=c;return b};b.hAxis=function(c){if(!arguments.length){return a.hAxis}a.hAxis=c;return b};b.vAxis=function(c){if(!arguments.length){return a.vAxis}a.vAxis=c;return b};b.colors=function(c){if(!arguments.length){return a.colors}a.colors=c;return b};b.tooltip=function(c){if(!arguments.length){return a.tooltip}a.tooltip=c;return b};b.clickAction=function(c){if(!arguments.length){return a.clickAction}a.clickAction=c;return b};b.responsiveWidth=function(c){if(!arguments.length){return a.responsiveWidth}a.responsiveWidth=c;return b};return b}function _chart_timeline_config(){var config={chartType:"timeline",data:[],keys:null,legendStyle:{},chartStyle:{},colors:d3.scale.category20(),hAxis:null,vAxis:null,tooltip:{},tooltip_showAllLegends:false,dataInterval:null,barWidth:10,barWidthMin:1,barWidthMax:10,responsiveWidth:0,clickAction:null};config.drawChart=function(chartContainerID){config.uniqueid=chartContainerID.substring(1);config.xkey=config.keys[0];config.ykeys=(typeof config.keys[1]==="string")?[config.keys[1]]:config.keys[1];config.width=parseInt(config.chartStyle.width);config.height=parseInt(config.chartStyle.height);if(config.tooltip!=null){config.customTooltip=UTILS.customTooltip(config.uniqueid+"_tooltip",config.tooltip.width,config.tooltip.height)}config.dataInterval=config.chartStyle.dataInterval;var responsiveWidth=parseInt(config.responsiveWidth);if(responsiveWidth>0&&responsiveWidth<config.width){config.width=responsiveWidth}config.hasNamedColors=UTILS.isOrdinalScaleWithNames(config.colors);var allDates=[],ymax=0,ymin=0,minTimeDiff=UTILS.year;config.dataLayers=config.ykeys.map(function(){return[]});config.data.forEach(function(d,i){var time=new Date(+d[config.xkey]);allDates[i]=time;if(i>0){var diff=allDates[i].getTime()-allDates[i-1].getTime();if(diff<0){diff*=-1}if(diff>0&&diff<minTimeDiff){minTimeDiff=diff}}var ytotal=0;config.ykeys.forEach(function(k,ki){var yvalue=+d[k];ytotal+=yvalue;config.dataLayers[ki][i]={x:time,y:yvalue,i:ki}});if(ytotal<ymin){ymin=ytotal}if(ytotal>ymax){ymax=ytotal}});var startTime=d3.min(allDates);var endTime=d3.max(allDates);config.stackedData=d3.layout.stack()(config.dataLayers);config.legends=config.ykeys;var xAxisOffset=7;var xAxisBottomPadding=0;if(config.hAxis!==null){if(config.hAxis.position=="out"){xAxisBottomPadding+=30}else{if(config.hAxis.position=="in"){xAxisBottomPadding+=10}}if(config.hAxis.label!==""){xAxisBottomPadding+=20}if(config.hAxis.startValue!=null){var val=+config.hAxis.startValue;if(val>0&&val<startTime.getTime()){startTime=new Date(val)}}if(config.hAxis.endValue!=null){var val=+config.hAxis.endValue;if(val>0&&val>endTime.getTime()){endTime=new Date(val)}}}var yAxisLeftPadding=0;var panelOffsetY=0;if(config.vAxis!==null){if(xAxisBottomPadding<15){xAxisBottomPadding=15}panelOffsetY=10;if(config.vAxis.position=="out"){yAxisLeftPadding+=40}else{if(config.vAxis.position=="in"){yAxisLeftPadding+=5}}if(config.vAxis.label!==""){yAxisLeftPadding+=20}}var legendWidth=0;var legendHeight=0;if(config.legendStyle!==null){legendWidth=parseInt(config.legendStyle.width);legendHeight=parseInt(config.legendStyle.height)}var actualChartWidth=config.width-yAxisLeftPadding-xAxisOffset-5;var actualChartHeight=config.height-xAxisBottomPadding;var interval=null,minTime=UTILS.hour;if(config.dataInterval!=null){interval=eval("UTILS."+config.dataInterval);var diff=endTime.getTime()-startTime.getTime();if(diff<interval){startTime=new Date(endTime.getTime()-interval)}}else{if(endTime.getTime()==startTime.getTime()){startTime=new Date(startTime.getTime()-UTILS.minute)}}config.xScale=d3.time.scale.utc().domain([startTime,endTime]).rangeRound([0,actualChartWidth]);config.barWidth=config.normalizedBarWidth(startTime,minTimeDiff,config.xScale,interval);var xBarOffset=config.barWidth*20/100;if(xBarOffset<3){xBarOffset=3}if(xBarOffset>10){xBarOffset=10}var newStartTime=config.xScale.invert(-xBarOffset);var newEndTime=config.xScale.invert(actualChartWidth+config.barWidth+xBarOffset);config.xScale.domain([newStartTime,newEndTime]);config.yScale=d3.scale.linear().domain([ymin,ymax]).range([actualChartHeight,0]);var container=d3.select(chartContainerID);var totalWidth,totalHeight;if(config.legendStyle==null||config.legendStyle.position=="right"){totalWidth=config.width+legendWidth;totalHeight=(config.height>legendHeight)?config.height:legendHeight}else{totalWidth=(config.width>legendWidth)?config.width:legendWidth;totalHeight=config.height+legendHeight}var mainpanel=container.append("svg").attr("width",totalWidth).attr("height",totalHeight).attr("class","barchart");var panel=mainpanel.append("g").attr("transform","translate("+yAxisLeftPadding+","+panelOffsetY+")");if(config.hAxis!=null){config.hAxis.labelOffset=xAxisBottomPadding-15;if(config.hAxis.ticks=="default"){config.hAxis.ticks=((actualChartWidth/100)*1)}var xAxis=UTILS.chart_x_axis().attr("scale",config.xScale).attr("axisStyle",config.hAxis).attr("chartWidth",actualChartWidth).attr("chartHeight",actualChartHeight);xAxis(panel)}if(config.vAxis!=null){config.vAxis.labelOffset=yAxisLeftPadding-15;if(config.vAxis.ticks=="default"){config.vAxis.ticks=((actualChartHeight/100)*3)+1}var yAxis=UTILS.chart_y_axis().attr("scale",config.yScale).attr("axisStyle",config.vAxis).attr("chartWidth",actualChartWidth).attr("chartHeight",actualChartHeight);yAxis(panel)}var spanel=panel.selectAll("g.category").data(config.stackedData).enter().append("g").attr("class","category").style("fill",function(d,i){return config.hasNamedColors?config.colors(config.ykeys[i]):config.colors(i)});spanel.each(function(d,i){var category=d3.select(this);config._drawBar(d,i,category)});if(config.clickAction!=null){spanel.style("cursor","pointer")}if(config.legendStyle!=null){var chart_legends=UTILS.chart_legends().attr("data",config.legends).attr("colors",config.colors).attr("width",legendWidth).attr("height",legendHeight).attr("dotType","circle");if(config.legendStyle.position=="right"){chart_legends.attr("x",(actualChartWidth+yAxisLeftPadding+15)).attr("y",10)}else{chart_legends.attr("x",(5+yAxisLeftPadding)).attr("y",(actualChartHeight+xAxisBottomPadding+25))}chart_legends(mainpanel)}};config._drawBar=function(p,q,parent){var bar=parent.selectAll("rect").data(p).enter().append("rect").attr("class","bar").attr("x",function(d){return config.xScale(d.x)}).attr("y",function(d){return config.yScale(d.y0+d.y)}).attr("width",config.barWidth).attr("height",function(d){return(config.yScale(d.y0)-config.yScale(d.y0+d.y))});if(config.tooltip!=null){config.tooltip_showAllLegends=UTILS.parseBool(config.tooltip.showAllLegends,config.tooltip_showAllLegends);bar.on("mouseover",function(d,i){var date=d.x;var displayDate=date.toUTCString();var content=displayDate;if(config.tooltip_showAllLegends){var d=config.data[i];for(var i=config.ykeys.length;i>-1;i--){var k=config.ykeys[i];if(+d[k]>0){var color=config.colors(config.hasNamedColors?k:i);content+="<br/><span style='color:"+color+";'>"+k+" : <b>"+d[k]+"</b></span>"}}}else{content+="<br/>"+config.ykeys[d.i]+" : <b>"+d.y+"</b>"}config.customTooltip.showTooltip(content,(d3.event||window.event))}).on("mouseout",function(d,i){config.customTooltip.hideTooltip()})}if(config.clickAction!=null){bar.on("click",function(d,i){config.customTooltip.hideTooltip();var actionType=config.clickAction.actionType;var actionTarget=config.clickAction.actionTarget;var actionUrl=config.clickAction.actionUrl;var actionUrlParams="data="+d.x+","+d.y+"&keys="+config.xkey+","+config.legends[q];if(actionType=="callback"){eval(actionTarget+"(d.x,d.y,config.legends[q],i)")}else{UTILS.executeClickAction(actionType,actionTarget,actionUrl,actionUrlParams)}if(config.tooltip!=null){config.customTooltip.hideTooltip()}return})}};config.normalizedBarWidth=function(startTime,minTimeDiff,xScale,interval){var timeDiff=(interval!=null&&minTimeDiff>interval)?interval:minTimeDiff;var dt1=new Date(startTime.getTime()+timeDiff);var barWidth=(xScale(dt1)-xScale(startTime))*65/100;return(barWidth<config.barWidthMin)?config.barWidthMin:(barWidth>config.barWidthMax)?config.barWidthMax:barWidth};return config};
// chart_multiarea.js
function chart_multiarea(){var a=_chart_multiarea_config();var b=function(c){try{a.drawChart(c)}catch(d){UTILS.appendErrMsg(c,d);throw d}};b.data=function(c){if(!arguments.length){return a.data}a.data=c;return b};b.keys=function(c){if(!arguments.length){return a.keys}a.keys=c;return b};b.chartStyle=function(c){if(!arguments.length){return a.chartStyle}a.chartStyle=c;return b};b.hAxis=function(c){if(!arguments.length){return a.hAxis}a.hAxis=c;return b};b.vAxis=function(c){if(!arguments.length){return a.vAxis}a.vAxis=c;return b};b.colors=function(c){if(!arguments.length){return a.colors}a.colors=c;return b};b.clickAction=function(c){if(!arguments.length){return a.clickAction}a.clickAction=c;return b};b.responsiveWidth=function(c){if(!arguments.length){return a.responsiveWidth}a.responsiveWidth=c;return b};return b}function _chart_multiarea_config(){var a={chartType:"multiarea",data:[],keys:null,legendStyle:[],chartStyle:[],colors:d3.scale.category20(),hAxis:null,vAxis:null,margin:{top:10,right:30,bottom:30,left:50},tooltip:[],responsiveWidth:0,clickAction:null};a.drawChart=function(d){a.uniqueid=d.substring(1);a.xkey=a.keys[0];a.ykeys=(typeof a.keys[1]==="string")?[a.keys[1]]:a.keys[1];a.width=parseInt(a.chartStyle.width);a.height=parseInt(a.chartStyle.height);var j=parseInt(a.responsiveWidth);if(j>0&&j<a.width){a.width=j}var e=a.width-a.margin.left-a.margin.right;var q=a.height-a.margin.top-a.margin.bottom;var b=a.colors;var l=d3.select(d).append("svg").attr("width",e+a.margin.left+a.margin.right).attr("height",q+a.margin.top+a.margin.bottom);var p=[];var k=[];var o=0;for(var c in a.data[0]){if(c!=a.xkey){p.push(c)}}var n=p.length;var f=a.data[0][a.xkey];var m=a.data[a.data.length-1][a.xkey];var g=q*(1/n);a.data.forEach(function(i){for(var r in i){if(i.hasOwnProperty(r)&&r!=a.xkey){i[r]=parseInt(i[r]);if(i[r]>o){o=i[r]}}}});for(var h=0;h<n;h++){k.push(new a._multiarea({data:a.data.slice(),id:h,name:p[h],width:e,height:q*(1/n),maxDataPoint:o,svg:l,margin:a.margin,showBottomAxis:(h==p.length-1),showSingleArea:(p.length==1),fillColor:b(p[h]),uniqueid:a.uniqueid,xkey:a.xkey}))}};a._multiarea=function(e){this.chartData=e.data;this.width=e.width;this.height=e.height;this.maxDataPoint=e.maxDataPoint;this.svg=e.svg;this.id=e.id;this.name=e.name;this.margin=e.margin;this.showBottomAxis=e.showBottomAxis;this.fillColor=e.fillColor;this.uniqueid=e.uniqueid;this.xkey=e.xkey;this.showSingleArea=e.showSingleArea;var d=this.name;var g=this.xkey;this.xScale=d3.time.scale.utc().range([0,this.width]).domain(d3.extent(this.chartData.map(function(j){return j[g]})));this.yScale=d3.scale.linear().range([this.height,0]).domain([0,this.maxDataPoint]);var c=this.xScale;var f=this.yScale;this.area=d3.svg.area().interpolate("basis").x(function(j){return c(j[g])}).y0(this.height).y1(function(j){return f(j[d])});this.svg.append("defs").append("clipPath").attr("id","clip-"+this.uniqueid+"-"+this.id).append("rect").attr("width",this.width).attr("height",this.height);this.chartContainer=this.svg.append("g").attr("class",this.name.toLowerCase()).attr("transform","translate("+a.margin.left+","+(a.margin.top+(this.height*this.id)+(10*this.id))+")");this.chartContainer.append("path").data([this.chartData]).attr("class","chart").style("fill",this.fillColor).attr("clip-path","url(#clip-"+this.uniqueid+"-"+this.id+")").attr("d",this.area);if(a.hAxis!=null){var i=a.hAxis.tickformat;if(!this.showSingleArea){this.xAxisTop=d3.svg.axis().scale(this.xScale).orient("bottom").ticks(a.hAxis.ticks);if(i!="default"&&i!=""){this.xAxisTop.tickFormat(d3.format(i))}if(this.id==0){var b=this.chartContainer.append("g").attr("class","x axis top").attr("transform","translate(0,0)").call(this.xAxisTop);b.selectAll("text").attr("transform","rotate("+a.hAxis.tickDisplayAngle+")")}}xAxisPosition="top";if(this.showSingleArea){if(a.hAxis.position=="out"){xAxisPosition="bottom"}if(a.hAxis.position=="in"){xAxisPosition="top"}}this.xAxisBottom=d3.svg.axis().scale(this.xScale).orient(xAxisPosition).ticks(a.hAxis.ticks);if(i!="default"&&i!=""){this.xAxisBottom.tickFormat(d3.format(i))}if(this.showBottomAxis){var b=this.chartContainer.append("g").attr("class","x axis bottom").attr("transform","translate(0,"+this.height+")").call(this.xAxisBottom);b.selectAll("text").attr("transform","rotate("+a.hAxis.tickDisplayAngle+")")}}if(a.vAxis!=null){this.yAxis=d3.svg.axis().scale(this.yScale).orient("left").ticks(a.vAxis.ticks).tickFormat(d3.format(a.vAxis.tickformat));var h=this.chartContainer.append("g").attr("class","y axis").attr("transform","translate(-15,0)").call(this.yAxis);h.selectAll("text").attr("transform","rotate("+a.vAxis.tickDisplayAngle+")")}this.chartContainer.append("text").attr("class","country-title").attr("transform","translate(15,40)").attr("style","font-size: 14px; font-weight: bold;").text(this.name)};return a};
// chart_brusharea.js
function chart_brusharea(){var a=_chart_brusharea();var b=function(c){try{a.drawChart(c)}catch(d){UTILS.appendErrMsg(c,d);throw d}};b.data=function(c){if(!arguments.length){return a.data}a.data=c;return b};b.keys=function(c){if(!arguments.length){return a.keys}a.keys=c;return b};b.chartStyle=function(c){if(!arguments.length){return a.chartStyle}a.chartStyle=c;return b};b.hAxis=function(c){if(!arguments.length){return a.hAxis}a.hAxis=c;return b};b.colors=function(c){if(!arguments.length){return a.colors}a.colors=c;return b};b.clickAction=function(c){if(!arguments.length){return a.clickAction}a.clickAction=c;return b};b.brushAction=function(c){if(!arguments.length){return a.brushAction}a.brushAction=c;return b};b.brushendAction=function(c){if(!arguments.length){return a.brushendAction}a.brushendAction=c;return b};b.responsiveWidth=function(c){if(!arguments.length){return a.responsiveWidth}a.responsiveWidth=c;return b};return b}var doNothingAction=function(){};function _chart_brusharea(){var a={chartType:"brusharea",data:[],keys:null,chartStyle:{},width:800,height:50,colors:d3.scale.category20(),hAxis:null,dataInterval:"day",responsiveWidth:0,clickAction:doNothingAction,brushAction:doNothingAction,brushendAction:doNothingAction};a.drawChart=function(r){a.uniqueid=r.substring(1);a.xkey=a.keys[0];a.ykey=a.keys[1];a.width=UTILS.parseInt(a.chartStyle.width,a.width);a.height=UTILS.parseInt(a.chartStyle.height,a.height);a.dataInterval=UTILS.defaultValue(a.chartStyle.dataInterval,a.dataInterval);var f=parseInt(a.responsiveWidth);if(f>0&&f<a.width){a.width=f}var o={top:8,right:25,bottom:20,left:15};var z=a.width-o.left-o.right;var g=a.height-o.top-o.bottom;var n=a.colors;var j=[],k=[],s=0,t=0,v=a.data.length;for(var u=0;u<v;u++){var x=a.data[u];var l=new Date(x[a.xkey]);var A=parseInt(x[a.ykey]);if(A<s){s=A}if(A>t){t=A}j[u]=l;k[u]={time:l,count:A}}var p=d3.min(j);var h=d3.max(j);var y=d3.time.scale.utc().domain([p,h]).range([0,z]);var e=d3.scale.linear().domain([s,t]).range([g,0]);var m=d3.svg.axis().scale(y).orient("bottom");var q=d3.select(r).append("svg").attr("width",a.width).attr("height",a.height);var b=q.append("g").attr("transform","translate("+o.left+","+o.top+")");var w=d3.svg.area().interpolate("bundle").x(function(i){return y(i.time)}).y0(g).y1(function(i){return e(i.count)});var c=d3.svg.brush().x(y).on("brush",function(){a.brushAction(c.extent())}).on("brushend",function(){a.brushendAction(c.extent())});b.append("path").datum(k).style("fill",a.colors(0)).attr("d",w);b.append("g").attr("class","x axis").attr("transform","translate(0,"+g+")").call(m);b.append("g").attr("class","x brush").call(c).selectAll("rect").attr("y",0).attr("height",g+0);return a};return a};
// chart_line.js
function chart_line(){var a=_line_chart_config();var b=function(c){try{a.drawChart(c)}catch(d){UTILS.appendErrMsg(c,d);throw d}};b.data=function(c){if(!arguments.length){return a.data}a.data=c;return b};b.keys=function(c){if(!arguments.length){return a.keys}a.keys=c;return b};b.legendStyle=function(c){if(!arguments.length){return a.legendStyle}a.legendStyle=c;return b};b.chartStyle=function(c){if(!arguments.length){return a.chartStyle}a.chartStyle=c;return b};b.hAxis=function(c){if(!arguments.length){return a.hAxis}a.hAxis=c;return b};b.vAxis=function(c){if(!arguments.length){return a.vAxis}a.vAxis=c;return b};b.colors=function(c){if(!arguments.length){return a.colors}a.colors=c;return b};b.tooltip=function(c){if(!arguments.length){return a.tooltip}a.tooltip=c;return b};b.clickAction=function(c){if(!arguments.length){return a.clickAction}a.clickAction=c;return b};b.responsiveWidth=function(c){if(!arguments.length){return a.responsiveWidth}a.responsiveWidth=c;return b};return b}function _line_chart_config(){var config={chartType:"line",data:[],keys:null,legendStyle:[],chartStyle:[],colors:d3.scale.category20(),hAxis:null,vAxis:null,tooltip:[],responsiveWidth:0,clickAction:null};config.drawChart=function(chartContainerID){config.uniqueid=chartContainerID.substring(1);config.xkey=config.keys[0];config.ykeys=(typeof config.keys[1]==="string")?[config.keys[1]]:config.keys[1];config.width=parseInt(config.chartStyle.width);config.height=parseInt(config.chartStyle.height);if(config.tooltip!=null){config.customTooltip=UTILS.customTooltip(config.uniqueid+"_tooltip",config.tooltip.width,config.tooltip.height)}config.isDate=UTILS.parseBool(config.chartStyle.isDate);config.dataPoints=UTILS.parseBool(config.chartStyle.dataPoints);config.lineWidth=UTILS.parseInt(config.chartStyle.lineWidth);config.hasNamedColors=UTILS.isOrdinalScaleWithNames(config.colors);var responsiveWidth=parseInt(config.responsiveWidth);if(responsiveWidth>0&&responsiveWidth<config.width){config.width=responsiveWidth}config.x=config.data.map(function(d){return d[config.xkey]});config.y=config.data.map(function(d){return config.ykeys.map(function(k){return d[k]})});config.y1=config.ykeys.map(function(k){return config.data.map(function(d){return d[k]})});config.legends=config.ykeys;var ymin=9999999;for(var i=0;i<config.y.length;i++){var pvmin=d3.min(config.y[i]);if(pvmin<ymin){ymin=pvmin}}var ymax=-9999;for(var i=0;i<config.y.length;i++){var pvmax=d3.max(config.y[i],function(d){return +d});if(pvmax>ymax){ymax=pvmax}}var xAxisPadding=0;if(config.hAxis!==null){xAxisPadding=30;if(config.hAxis.label!==""){xAxisPadding=xAxisPadding+20}}var yAxisPadding=0;var panelOffsetY=config.lineWidth;if(config.vAxis!==null){if(xAxisPadding<15){xAxisPadding=15}panelOffsetY=10;yAxisPadding=40;if(config.vAxis.label!==""){yAxisPadding=yAxisPadding+20}}var xAxisOffset=0;if(!config.isDate&&config.hAxis!=null){if(config.yAxis==null){yAxisPadding+=(config.x[0].length*3)}xAxisOffset=(config.x[config.x.length-1].length*2)}if(config.dataPoints){yAxisPadding+=(config.lineWidth)+1;panelOffsetY+=(config.lineWidth)+1}var legendWidth=0;var legendHeight=0;if(config.legendStyle!==null){legendWidth=parseInt(config.legendStyle.width);legendHeight=parseInt(config.legendStyle.height)}var actualChartWidth=config.width-(yAxisPadding+12)-xAxisOffset;var actualChartHeight=config.height-xAxisPadding-(panelOffsetY+(config.lineWidth*2));if(!config.isDate){config.xScale=d3.scale.ordinal().domain(config.x).rangePoints([0,actualChartWidth])}else{config.xScale=d3.time.scale.utc().domain([d3.min(config.x),d3.max(config.x)]).range([0,actualChartWidth])}config.yScale=d3.scale.linear().domain([ymin,ymax]).range([actualChartHeight,0]);var m=config.y[0].length;var totalWidth,totalHeight;if(config.legendStyle==null||config.legendStyle.position=="right"){totalWidth=config.width+legendWidth;totalHeight=(config.height>legendHeight)?config.height:legendHeight}else{totalWidth=(config.width>legendWidth)?config.width:legendWidth;totalHeight=config.height+legendHeight}var mainpanel=d3.select(chartContainerID).append("svg").attr("width",totalWidth).attr("height",totalHeight).attr("class","linechart");var panel=mainpanel.append("g").attr("transform","translate("+yAxisPadding+","+panelOffsetY+")");var spanel=panel.append("g").attr("transform",function(d,i){return"translate(0,0)"}).attr("class","chartdisplay");var line=d3.svg.line().x(function(d,i){return config.xScale(config.x[i])}).y(function(d,i){return config.yScale(d)}).interpolate(config.chartStyle.interpolate);var paths=spanel.selectAll("g.path").data(config.y1).enter().append("g").attr("class","path").each(function(d,i){var path=d3.select(this);config.dot(d,i,path)});paths.append("svg:path").attr("d",function(d,i){return line(d,i)}).attr("class","svgpath").style("stroke-width",config.lineWidth).style("stroke",function(d,i){return(config.hasNamedColors)?config.colors(config.ykeys[i]):config.colors(i)}).style("fill","none");if(config.clickAction!=null){mainpanel.style("cursor","pointer")}if(config.hAxis!=null){config.hAxis.labelOffset=xAxisPadding-15;var xAxis=UTILS.chart_x_axis().attr("scale",config.xScale).attr("axisStyle",config.hAxis).attr("chartWidth",actualChartWidth).attr("chartHeight",actualChartHeight);xAxis(panel)}if(config.vAxis!=null){config.vAxis.labelOffset=xAxisPadding-15;var yAxis=UTILS.chart_y_axis().attr("scale",config.yScale).attr("axisStyle",config.vAxis).attr("chartWidth",actualChartWidth).attr("chartHeight",actualChartHeight);yAxis(panel)}if(config.legendStyle!=null){var chart_legends=UTILS.chart_legends().attr("data",config.legends).attr("colors",config.colors).attr("width",legendWidth).attr("height",legendHeight);if(config.legendStyle.position=="right"){chart_legends.attr("x",(actualChartWidth+yAxisPadding+25)).attr("y",panelOffsetY)}else{chart_legends.attr("x",(5+yAxisPadding)).attr("y",(actualChartHeight+xAxisPadding+20))}chart_legends(mainpanel)}};config.dot=function(p,q,path){var point=path.selectAll("g.point").data(function(d){return d}).enter().append("g").attr("class","point");point.append("svg:circle").attr("cx",function(d,i){return config.xScale(config.x[i])}).attr("cy",function(d,i){return config.yScale(d)}).attr("r",(config.lineWidth+1)).attr("fill",function(d,i){return(config.hasNamedColors)?config.colors(config.ykeys[q]):config.colors(q)}).attr("fill-opacity",function(d,i){if(config.dataPoints){return 1}else{return 0}});if(config.tooltip!=null){point.on("mouseover",function(d,i){content=config.x[i]+"<br/>"+config.legends[q]+" = <b>"+d+"</b>";config.customTooltip.showTooltip(content,(d3.event||window.event))}).on("mouseout",function(d,i){config.customTooltip.hideTooltip()})}if(config.clickAction!=null){point.on("click",function(d,i){var actionType=config.clickAction.actionType;var actionTarget=config.clickAction.actionTarget;var actionUrl=config.clickAction.actionUrl;var actionUrlParams="data="+config.x[i]+","+config.legend[q]+","+d+"&keys="+config.keys.toString();if(actionType=="callback"){eval(actionTarget+"(config.x[i], config.legend[q], d)")}else{UTILS.executeClickAction(actionType,actionTarget,actionUrl,actionUrlParams)}return})}};return config};
// chart_treemap_group.js
function chart_grouptreemap(){var a=_chart_grouptreemap();var b=function(c){try{a.drawChart(c)}catch(d){UTILS.appendErrMsg(c,d);throw d}};b.data=function(c){if(!arguments.length){return a.data}a.data=c;return b};b.keys=function(c){if(!arguments.length){return a.keys}a.keys=c;return b};b.legendStyle=function(c){if(!arguments.length){return a.legendStyle}a.legendStyle=c;return b};b.chartStyle=function(c){if(!arguments.length){return a.chartStyle}a.chartStyle=c;return b};b.colors=function(c){if(!arguments.length){return a.colors}a.colors=c;return b};b.tooltip=function(c){if(!arguments.length){return a.tooltip}a.tooltip=c;return b};b.clickAction=function(c){if(!arguments.length){return a.clickAction}a.clickAction=c;return b};b.responsiveWidth=function(c){if(!arguments.length){return a.responsiveWidth}a.responsiveWidth=c;return b};return b}function _chart_grouptreemap(){var config={data:[],keys:null,legendStyle:null,chartStyle:null,colors:d3.scale.category20(),tooltip:null,colorsKeyMap:null,clickAction:null,chartType:"groupTreemap"};config.drawChart=function(chartContainerID){config.uniqueid=chartContainerID.substring(1);config.xkey=config.keys[0];config.ykeys=config.keys[1];config.width=parseInt(config.chartStyle.width);config.height=parseInt(config.chartStyle.height);if(config.tooltip!=null){config.customTooltip=UTILS.customTooltip(config.uniqueid+"_tooltip",config.tooltip.width,config.tooltip.height)}var responsiveWidth=parseInt(config.responsiveWidth);if(responsiveWidth>0&&responsiveWidth<config.width){config.width=responsiveWidth}config.x=d3.scale.linear().range([0,config.width]);config.y=d3.scale.linear().range([0,config.height]);var colors=config.colors;var parentContainer=d3.select(chartContainerID);if(config.legendStyle!=null){config.drawLegends(parentContainer,colors)}var treemap=d3.layout.treemap().size([config.width,config.height]).sticky(true).value(function(d){return d.size});var svg=parentContainer.append("div").attr("class","chart").style("width",config.width+"px").style("height",config.height+"px").append("svg:svg").attr("width",config.width).attr("height",config.height).attr("id",config.uniqueid+"_svg").append("svg:g").attr("transform","translate(.5,.5)");config.node=root=config.data;var nodes=treemap.nodes(root).filter(function(d){return !d.children});var cell=svg.selectAll("g").data(nodes).enter().append("svg:g").attr("class","cell").attr("transform",function(d){return"translate("+d.x+","+d.y+")"}).on("click",function(d,i){if(config.node!=d.parent){return config.zoom(d.parent,svg,config.x,config.y,config.width,config.height)}else{if(config.clickAction!=null){var actionType=config.clickAction.actionType;var actionTarget=config.clickAction.actionTarget;var actionUrl=config.clickAction.actionUrl;var actionUrlParams="data="+d.name+"&keys="+d.size;if(actionType=="callback"){eval(actionTarget+"(d.name,d.size)")}else{UTILS.executeClickAction(actionType,actionTarget,actionUrl,actionUrlParams)}}}return});if(config.tooltip!=null){cell.on("mouseover",function(d,i){content=d.name+"<br/><b>"+d.size+"</b>";config.customTooltip.showTooltip(content,(d3.event||window.event))}).on("mouseout",function(d,i){config.customTooltip.hideTooltip()})}cell.append("svg:rect").attr("width",function(d){return d.dx-1}).attr("height",function(d){return d.dy-1}).style("fill",function(d){return colors(d.parent.name)});cell.append("svg:text").attr("x",function(d){return d.dx/2}).attr("y",function(d){return d.dy/2}).attr("dy",".35em").attr("text-anchor","middle").text(function(d){return d.name}).style("opacity",function(d){d.w=this.getComputedTextLength();return d.dx>d.w?1:0});d3.select(window).on("click",function(){config.zoom(root,svg,config.x,config.y,config.width,config.height)})};config.zoom=function(d,svg,x,y,width,height){var kx=width/d.dx,ky=height/d.dy;x.domain([d.x,d.x+d.dx]);y.domain([d.y,d.y+d.dy]);var event=(d3.event||window.event);var t=svg.selectAll("g.cell").transition().duration(event.altKey?7500:750).attr("transform",function(d){return"translate("+x(d.x)+","+y(d.y)+")"});t.select("rect").attr("width",function(d){return kx*d.dx-1}).attr("height",function(d){return ky*d.dy-1});t.select("text").attr("x",function(d){return kx*d.dx/2}).attr("y",function(d){return ky*d.dy/2}).style("opacity",function(d){return kx*d.dx>d.w?1:0});config.node=d;event.stopPropagation()};config.drawLegends=function(parentContainer,colors){var legendDiv=parentContainer.append("div").attr("id","legend");var ul=legendDiv.append("ul");for(var i in config.keys){ul.append("li").attr("class",config.keys[i]).style("background",colors(config.keys[i]))}var moreP=legendDiv.append("p").attr("class","more").text("more usage");var lessP=legendDiv.append("p").attr("class","less").text("less usage")};return config};
// chart_treemap.js
function chart_treemap(){var a=_chart_treemap();thisChart=function(b){try{a.drawChart(b)}catch(c){UTILS.appendErrMsg(b,c);throw c}};thisChart.data=function(b){if(!arguments.length){return a.data}a.data=b;return thisChart};thisChart.keys=function(b){if(!arguments.length){return a.keys}a.keys=b;return thisChart};thisChart.chartStyle=function(b){if(!arguments.length){return a.chartStyle}a.chartStyle=b;return thisChart};thisChart.colors=function(b){if(!arguments.length){return a.colors}a.colors=b;return thisChart};thisChart.tooltip=function(b){if(!arguments.length){return a.tooltip}a.tooltip=b;return thisChart};thisChart.clickAction=function(b){if(!arguments.length){return a.clickAction}a.clickAction=b;return thisChart};thisChart.responsiveWidth=function(b){if(!arguments.length){return a.responsiveWidth}a.responsiveWidth=b;return thisChart};return thisChart}function _chart_treemap(){var config={chartType:"treemap",data:[],keys:null,chartStyle:[],colors:d3.scale.category20(),tooltip:[],responsiveWidth:0,clickAction:null};config.drawChart=function(chartContainerID){config.uniqueid=chartContainerID.substring(1);config.xkey=config.keys[0];config.ykey=config.keys[1];config.width=parseInt(config.chartStyle.width);config.height=parseInt(config.chartStyle.height);if(config.tooltip!=null){config.customTooltip=UTILS.customTooltip(config.uniqueid+"_tooltip",config.tooltip.width,config.tooltip.height)}var responsiveWidth=parseInt(config.responsiveWidth);if(responsiveWidth>0&&responsiveWidth<config.width){config.width=responsiveWidth}var treemap=d3.layout.treemap().size([config.width,config.height]).value(function(d){return d[config.ykey]});var div=d3.select(chartContainerID).append("div").style("position","relative").style("width",config.width+"px").style("height",config.height+"px");if(config.clickAction!=null){div.style("cursor","pointer")}var json={name:"treemap",children:config.data};var cells=div.data([json]).selectAll("div").data(treemap.nodes).enter().append("div").attr("class","cell").style("background",function(d,i){return d.children?null:config.colors(d[config.xkey])}).style("display","block").call(cell).text(function(d){return d.children?null:d[config.xkey]});if(config.tooltip!=null){cells.on("mouseover",function(d,i){content=d[config.xkey]+"<br/><b>"+d[config.ykey]+"</b>";config.customTooltip.showTooltip(content,(d3.event||window.event))}).on("mouseout",function(d,i){config.customTooltip.hideTooltip()})}if(config.clickAction!=null){cells.on("click",function(d,i){var actionType=config.clickAction.actionType;var actionTarget=config.clickAction.actionTarget;var actionUrl=config.clickAction.actionUrl;var actionUrlParams="data="+d[config.xkey]+","+d[config.ykey]+"&keys="+config.xkey+","+config.ykey;if(actionType=="callback"){eval(actionTarget+"(d[config.xkey],d[config.ykey])")}else{UTILS.executeClickAction(actionType,actionTarget,actionUrl,actionUrlParams)}return})}function cell(){this.style("left",function(d){return d.x+"px"}).style("top",function(d){return d.y+"px"}).style("width",function(d){return Math.max(0,d.dx-1)+"px"}).style("height",function(d){return Math.max(0,d.dy-1)+"px"})}return config};return config};
// chart_usage_pie.js
var chart_usage_pie=function(){var b={uniqueid:null,data:[],dataidx:-1,colors:d3.scale.category20(),x:0,y:0,colors:d3.scale.category20(),innerRadius:30,outerRadius:50,unitLabels:null,headerText:"",centerText:"",centerText2:"",footerText:"",footerText2:"",arcs:null,displayPercent:true,arcStartAngle:1,percentRoundDecimals:2};var a=function(c){if(b.uniqueid==null){b.uniqueid=UTILS.getUniqueid()}var e=(c instanceof String)?d3.select(c):c;var d=e.append("g").attr("transform","translate("+(b.x+b.outerRadius)+","+(b.y+b.outerRadius)+")").attr("id",b.uniqueid);b._drawPie(d)};a.data=function(c){if(!arguments.length){return b.data}b.data=c;return a};a.dataidx=function(c){if(!arguments.length){return b.dataidx}b.dataidx=c;return a};a.colors=function(c){if(!arguments.length){return b.colors}b.colors=c;return a};a.x=function(c){if(!arguments.length){return b.x}b.x=c;return a};a.y=function(c){if(!arguments.length){return b.y}b.y=c;return a};a.innerRadius=function(c){if(!arguments.length){return b.innerRadius}b.innerRadius=c;return a};a.outerRadius=function(c){if(!arguments.length){return b.outerRadius}b.outerRadius=c;return a};a.displayPercent=function(c){if(!arguments.length){return b.displayPercent}b.displayPercent=c;return a};a.headerText=function(c){if(!arguments.length){return b.headerText}b.headerText=c;return a};a.centerText=function(c){if(!arguments.length){return b.centerText}b.centerText=c;return a};a.centerText2=function(c){if(!arguments.length){return b.centerText2}b.centerText2=c;return a};a.footerText=function(c){if(!arguments.length){return b.footerText}b.footerText=c;return a};a.footerText2=function(c){if(!arguments.length){return b.footerText2}b.footerText2=c;return a};a.arcLabels=function(c){if(!arguments.length){return b.arcLabels}b.arcLabels=c;return a};a.unitLabels=function(c){if(!arguments.length){return b.unitLabels}b.unitLabels=c;return a};a.uniqueid=function(c){if(!arguments.length){return b.uniqueid}b.uniqueid=c;return a};a.getArcs=function(){return b.arcs};a.getTotal=function(){return b.total};a.getPercentages=function(){return b.percentage};a.percentRoundDecimals=function(c){if(!arguments.length){return b.percentRoundDecimals}b.percentRoundDecimals=c;return a};b._drawPie=function(d){var l=0;if(b.headerText!=""){d.append("g").attr("class","label").append("text").attr("text-anchor","middle").attr("x",0).attr("y",-(b.outerRadius-10)).text(b.headerText).style("font","bold 10px Verdana");l+=20}var o=b.data;var h=d3.layout.pie().sort(null);var e=d3.svg.arc().innerRadius(b.innerRadius).outerRadius(b.outerRadius);var j=h(o);var c=d.selectAll("g arc").data(j).enter().append("g").attr("class","arc").attr("transform","translate(0,"+l+")");var n=c.append("path").attr("stroke","beige").attr("stroke-width",0.5).attr("fill",function(r,q){return b.colors(q)}).attr("id",function(r,q){return b.uniqueid+"_"+q}).attr("d",e);c.attr("dataidx",b.dataidx);b.arcs=c;var k=d3.sum(o);var p=[];for(var g=0;g<o.length;g++){p[g]=d3.round((o[g]/k*100),b.percentRoundDecimals)}b.total=k;b.percentage=p;var f=b.innerRadius!=0?1:1.5;var m=c.append("text").attr("transform",function(i){var q=e.centroid(i);return"translate("+q[0]*f+","+q[1]*f+")"}).attr("dy",".35em").attr("text-anchor","middle").attr("display",function(i){return i.value>0.15?null:"none"}).text(function(u,r){var q="";if(b.arcLabels!=null){var t=b.arcLabels[r];q+=(t!=null)?t:""}if(b.displayPercent){var s=(p[r]>7)?p[r]+"%":"";q+=s}return q}).style("font","10px Verdana");if(b.centerText!=""){d.append("g").attr("class","label").append("text").attr("text-anchor","middle").attr("x",0).attr("y",l).text(b.centerText).style("font","bold 10px Verdana")}if(b.centerText2!=""){d.append("g").attr("class","label").append("text").attr("text-anchor","middle").attr("x",0).attr("y",l+15).text(b.centerText2).style("font","10px Verdana")}if(b.footerText!=""){d.append("g").attr("class","label").append("text").attr("text-anchor","middle").attr("x",0).attr("y",(l+b.outerRadius+15)).text(b.footerText).style("font","bold 10px Verdana")}if(b.footerText2!=""){d.append("g").attr("class","label").append("text").attr("text-anchor","middle").attr("x",0).attr("y",(l+b.outerRadius+30)).text(b.footerText2).style("font","10px Verdana")}if(b.unitLabels!=null){b._drawUnitLabels(d,j)}};b._drawUnitLabels=function(c,d){var e=c.selectAll("text.unit").data(d);b.arcTextStartAngleOffset=-(Math.PI)-(Math.PI*-0.5);b.textOffset=1;e.enter().append("svg:text").attr("class","unit").attr("transform",function(f){return"translate("+(Math.cos((f.startAngle-(Math.PI))-b.arcTextStartAngleOffset)*(b.outerRadius+b.textOffset))+","+(Math.sin((f.startAngle-(Math.PI))-b.arcTextStartAngleOffset)*(b.outerRadius+b.textOffset))+")"}).attr("text-anchor",function(h){var f=h.startAngle;var g=Math.PI;if(f==g){return"middle"}else{if(f<g){return"end"}else{return"beginning"}}}).text(function(g,f){return b.unitLabels[f]});e.exit().remove()};return a};
// chart_usage.js
var chart_usage=function(){var a=_chart_usage();var b=function(c){try{a.drawChart(c)}catch(d){UTILS.appendErrMsg(c,d);throw d}};b.data=function(c){if(!arguments.length){return a.data}a.data=c;return b};b.keys=function(c){if(!arguments.length){return a.keys}a.keys=c;return b};b.chartStyle=function(c){if(!arguments.length){return a.chartStyle}a.chartStyle=c;return b};b.legendStyle=function(c){if(!arguments.length){return a.legendStyle}a.legendStyle=c;return b};b.colors=function(c){if(!arguments.length){return a.colors}a.colors=c;return b};b.tooltip=function(c){if(!arguments.length){return a.tooltip}a.tooltip=c;return b};b.clickAction=function(c){if(!arguments.length){return a.clickAction}a.clickAction=c;return b};b.responsiveWidth=function(c){if(!arguments.length){return a.responsiveWidth}a.responsiveWidth=c;return b};return b};var _chart_usage=function(){var config={data:[],keys:null,width:800,barHeight:25,padding:20,colors:d3.scale.category20(),chartStyle:{},legendStyle:null,percentRoundDecimals:2,barTextFont:"9px Verdana",barTextFontOnHover:"bold 12px Verdana",xAxisPercentageBased:true,isValuesTicksDisplayed:false,isXAxisDisplayed:false,y:5,titleHeight:15,xAxisHeight:50,totalKey:"Total",unusedKey:"Unused",titleKey:"Title",subtitleKey:"Subtitle",unusedColor:"#eeeeee",valueFormat:d3.format(".2s")};config.drawChart=function(chartContainerID){config.uniqueid=chartContainerID.substring(1);if(typeof config.keys[0]==="string"){config.usedKeys=[config.keys[0]]}else{config.usedKeys=config.keys[0]}if(config.keys.length>1){config.totalKey=config.keys[1]}if(config.keys.length>2){config.titleKey=config.keys[2]}if(config.keys.length>3){config.subtitleKey=config.keys[3]}config.width=UTILS.parseInt(config.chartStyle.width);config.barHeight=UTILS.parseInt(config.chartStyle.barHeight);config.padding=UTILS.parseInt(config.chartStyle.padding,config.padding);config.percentRoundDecimals=UTILS.parseInt(config.chartStyle.percentRoundDecimals,config.percentRoundDecimals);if(config.tooltip!=null){config.customTooltip=UTILS.customTooltip(config.uniqueid+"_tooltip",config.tooltip.width,config.tooltip.height)}var responsiveWidth=parseInt(config.responsiveWidth);if(responsiveWidth>0&&responsiveWidth<config.width){config.width=responsiveWidth}var isLegendsDisplayed=(config.usedKeys.length>1);var legendWidth=0;var legendHeight=0;if(config.legendStyle!==null){if(isLegendsDisplayed){legendWidth=parseInt(config.legendStyle.width);legendHeight=parseInt(config.legendStyle.height)}var titles=config.legendStyle.titles;var subtitles=config.legendStyle.subtitles;if(titles!=null){if(typeof titles==="string"){for(var i=0;i<config.data.length;i++){config.data[i][config.titleKey]=titles}}else{var len=(titles.length<config.data.length)?titles.length:config.data.length;for(var i=0;i<len;i++){config.data[i][config.titleKey]=titles[i]}}}if(subtitles!=null){if(typeof subtitles==="string"){if(subtitles!=""){for(var i=0;i<config.data.length;i++){config.data[i][config.subtitleKey]=subtitles}}}else{var len=(subtitles.length<config.data.length)?subtitles.length:config.data.length;for(var i=0;i<len;i++){if(subtitles[i]!=""){config.data[i][config.subtitleKey]=subtitles[i]}}}}}config.barRowHeight=(config.barHeight+config.padding+config.titleHeight);config.barRowHeight+=config.isValuesTicksDisplayed?10:0;config.allBarsHeight=(config.barRowHeight*config.data.length);config.height=config.allBarsHeight+config.padding;config.height+=(config.isXAxisDisplayed==true)?config.xAxisHeight:0;var actualChartWidth=config.width-20-config.padding;if(config.xAxisPercentageBased==false){actualChartWidth-=15}var totalWidth,totalHeight;if(config.legendStyle==null||config.legendStyle.position=="right"){totalWidth=config.width+legendWidth;totalHeight=(config.height>legendHeight)?config.height:legendHeight}else{totalWidth=(config.width>legendWidth)?config.width:legendWidth;totalHeight=config.height+legendHeight}var dataLayerKeys=config.usedKeys.concat([config.unusedKey]);var dcolors=config.usedKeys.map(function(d,i){return config.colors(d)});dcolors.push(config.unusedColor);var dataLayerColors=d3.scale.ordinal().range(dcolors);var kLen=config.usedKeys.length;var hasTotalValue=(config.keys.length>1);var percentages=[];var maxTotal=0;config.data.forEach(function(d,i){var total=0,actualTotal=0;for(var k=0;k<kLen;k++){total+=d[config.usedKeys[k]]}if(hasTotalValue){actualTotal=d[config.totalKey];d[config.unusedKey]=actualTotal-total}else{actualTotal=total;d[config.totalKey]=total;d[config.unusedKey]=0}if(maxTotal<actualTotal){maxTotal=actualTotal}var result={x:d[config.titleKey],x2:d[config.subtitleKey]};for(var k=0;k<kLen;k++){var v1=d[config.usedKeys[k]];var percent=(v1/actualTotal*100);var name=config.usedKeys[k];if(config.xAxisPercentageBased){result[name]=percent}else{result[name]=v1}}var v1=d[config.unusedKey];result[config.unusedKey]=(config.xAxisPercentageBased)?(v1/actualTotal*100):v1;result[config.totalKey]=actualTotal;percentages[i]=result});config.dataPercentages=percentages;config.dataLayers=dataLayerKeys.map(function(k,ki){return config.dataPercentages.map(function(d,i){return{x:d.x,x2:d.x2,y:d[k],k:k,ki:ki,i:i}})});config.stackedData=d3.layout.stack()(config.dataLayers);config.max=(config.xAxisPercentageBased)?100:maxTotal;var xScale=d3.scale.linear().domain([0,config.max]).range([0,actualChartWidth]);config.xScale=xScale;var container=d3.select(chartContainerID);var mainpanel=container.append("svg").attr("width",totalWidth).attr("height",totalHeight).attr("class","usage2");var panel=mainpanel.append("g").attr("transform","translate(0,"+config.padding+")");var spanel=panel.selectAll("g").data(config.stackedData).enter().append("g").attr("class","category");spanel.each(function(d,i){var category=d3.select(this);config._drawBar(d,i,category,dataLayerColors)});var yEnd=config.allBarsHeight+config.padding;if(config.isXAxisDisplayed==true){var xAxis=d3.svg.axis().scale(xScale).orient("bottom").tickFormat(function(d,i){return config.xAxisPercentageBased?(d+"%"):config.valueFormat(d)}).ticks(10);var xSvg=panel.append("g").attr("class","x axis").attr("transform","translate("+config.padding+","+yEnd+")").call(xAxis)}if(isLegendsDisplayed&&config.legendStyle!=null){var chart_legends=UTILS.chart_legends().attr("data",config.usedKeys).attr("colors",dataLayerColors).attr("width",legendWidth).attr("height",legendHeight).attr("dotType",UTILS.defaultValue(config.legendStyle.dotType,"circle")).attr("dotSize",config.legendStyle.dotSize).attr("fontStyle",config.legendStyle.fontStyle).attr("padding",config.legendStyle.padding);if(config.legendStyle.position=="right"){chart_legends.attr("x",(config.width+config.padding)).attr("y",(config.padding+10))}else{var y=yEnd+((config.isXAxisDisplayed==true)?config.xAxisHeight:0)+config.padding;chart_legends.attr("x",(config.padding+10)).attr("y",y)}chart_legends(mainpanel);var legends=chart_legends.getLegends();legends.on("mouseover",function(d,i){var bars=mainpanel.selectAll("rect.bar"+i);bars.style("opacity","0.7");var texts=mainpanel.selectAll("text.bar"+i);texts.style("font",config.barTextFontOnHover).style("display","")}).on("mouseout",function(d,i){var bars=mainpanel.selectAll("rect.bar"+i);bars.style("opacity","");var texts=mainpanel.selectAll("text.bar"+i);texts.style("font",config.barTextFont);var textSmall=mainpanel.selectAll("text.barSmall"+i);textSmall.style("display","none")})}};config._drawBar=function(p,q,parent,colors){var gRow=parent.selectAll("g.row").data(p).enter().append("g").attr("class","row").attr("_dataidx",function(d,i){return i});var yCall=function(d,i){return(d.i*config.barRowHeight)+config.titleHeight};if(q==0){gRow.append("text").attr("class","title").attr("y",function(d,i){return yCall(d,i)-5}).attr("x",config.padding+2).style("font","13px Verdana").text(function(d,i){return d.x});gRow.append("text").attr("class","subtitle").attr("y",function(d,i){return yCall(d,i)-6}).attr("x",function(d,i){return(config.padding+2+config.padding+(d.x.length*9))}).style("font"," 10px Verdana").text(function(d,i){if(d.x2!=null&&d.x2!=""){return"( "+d.x2+" )"}else{return""}});if(config.isValuesTicksDisplayed){if(config.xAxisPercentageBased){gRow.append("rect").attr("class","stroke").attr("y",function(d,i){return yCall(d,i)-(config.barHeight/2)}).attr("x",function(d){return config.xScale(config.max)+config.padding-1}).attr("width","0.5").attr("height",config.barHeight/2);gRow.append("text").attr("y",function(d,i){return yCall(d,i)-1}).attr("x",function(d){return config.xScale(config.max)+config.padding-2}).attr("text-anchor","end").text(function(d){if(d.k==config.unusedKey){return""}return config.valueFormat(config.data[d.i][config.totalKey])}).style("font","10px Verdana")}else{gRow.append("text").attr("y",function(d,i){return yCall(d,i)+config.padding}).attr("x",function(d){return config.xScale(config.data[d.i][config.totalKey])+config.padding}).attr("text-anchor","start").text(function(d){if(d.k==config.unusedKey){return""}return config.valueFormat(config.data[d.i][config.totalKey])}).style("font","10px Verdana")}}}var bar=gRow.append("g").attr("class","bar");bar.append("rect").attr("class",function(d,i){return"bar"+d.ki}).style("fill",function(d,i){return colors(d.ki)}).attr("y",yCall).attr("x",function(d){return config.padding+config.xScale(d.y0)}).attr("height",config.barHeight).attr("width",function(d){return config.xScale(d.y)});var minWidth=38;bar.append("text").attr("class",function(d,i){var barSelectClass="bar"+d.ki;var barSmallClass=(config.xScale(d.y)>minWidth)?"":"barSmall"+d.ki;return"bar "+barSmallClass+" "+barSelectClass}).attr("y",function(d,i){return yCall(d,i)+(config.barHeight/1.5)}).attr("x",function(d){return config.padding+config.xScale(d.y0)+(config.xScale(d.y)/2)}).style("font",config.barTextFont).attr("text-anchor","middle").text(function(d){if(d.k==config.unusedKey){return""}var text=config.xAxisPercentageBased?(Math.round(d.y*100)/100+"%"):config.valueFormat(d.y);return text}).style("display",function(d,i){return(config.xScale(d.y)>minWidth)?"":"none"});if(config.isValuesTicksDisplayed){if(config.xAxisPercentageBased){bar.append("rect").attr("class","stroke").attr("y",function(d,i){return yCall(d,i)+config.barHeight}).attr("x",function(d){return config.xScale(d.y+d.y0)+config.padding-1}).attr("width","0.5").attr("height",config.barHeight/2).style("display",function(d,i){return(d.k==config.unusedKey)?"none":""});bar.append("text").attr("y",function(d,i){return yCall(d,i)+config.barHeight+10}).attr("x",function(d){return config.xScale(d.y+d.y0)+config.padding-2}).attr("text-anchor","end").text(function(d){if(d.k==config.unusedKey){return""}return config.valueFormat(config.data[d.i][d.k])}).style("font","12px Verdana")}}if(config.tooltip!=null){bar.on("mouseover",function(d,i){var title=d.x;var yLabel=d.k;var yValue=config.data[d.i][d.k];var total=config.data[d.i][config.totalKey];var content=title+'  <font size="-2">(Total:'+total+")</font><br><b>"+yLabel+": "+yValue;if(config.xAxisPercentageBased){var percent=Math.round(d.y*100)/100;content+="("+percent+"%)"}config.customTooltip.showTooltip(content,(d3.event||window.event))}).on("mouseout",function(d,i){config.customTooltip.hideTooltip()})}if(config.clickAction!=null){bar.on("click",function(d,i){var title=d.x;var yLabel=d.k;var yValue=config.data[d.i][d.k];var total=config.data[d.i][config.totalKey];var actionType=config.clickAction.actionType;var actionTarget=config.clickAction.actionTarget;var actionUrl=config.clickAction.actionUrl;var actionUrlParams="data="+yLabel+","+yValue+","+title+"&keys="+config.titleKey+","+config.usedKeys;if(actionType=="callback"){eval(actionTarget+"(yLabel,yValue,title)")}else{UTILS.executeClickAction(actionType,actionTarget,actionUrl,actionUrlParams)}return})}};return config};
// chart_mutligauge.js
var chart_multigauge=function(){var a=_chart_multigauge();var b=function(c){try{a.drawChart(c)}catch(d){UTILS.appendErrMsg(c,d);throw d}};b.data=function(c){if(!arguments.length){return a.data}a.data=c;return b};b.keys=function(c){if(!arguments.length){return a.keys}a.keys=c;return b};b.chartStyle=function(c){if(!arguments.length){return a.chartStyle}a.chartStyle=c;return b};b.legendStyle=function(c){if(!arguments.length){return a.legendStyle}a.legendStyle=c;return b};b.colors=function(c){if(!arguments.length){return a.colors}a.colors=c;return b};b.tooltip=function(c){if(!arguments.length){return a.tooltip}a.tooltip=c;return b};b.clickAction=function(c){if(!arguments.length){return a.clickAction}a.clickAction=c;return b};b.responsiveWidth=function(c){if(!arguments.length){return a.responsiveWidth}a.responsiveWidth=c;return b};return b};var _chart_multigauge=function(){var config={data:[],keys:null,width:800,height:800,outerRadius:60,innerRadius:35,padding:20,colors:d3.scale.ordinal().range(["orange"]),chartStyle:{},legendStyle:null,numFormat:d3.format(".2s"),titleKey:"title",subtitleKey:"subtitle",unusedColor:"#eeeeee"};config.drawChart=function(chartContainerID){config.uniqueid=chartContainerID.substring(1);config.usedKey=config.keys[0];config.totalKey=config.keys[1];if(config.keys.length>2){config.titleKey=config.keys[2]}if(config.keys.length>3){config.subtitleKey=config.keys[3]}config.width=UTILS.parseInt(config.chartStyle.width);config.height=UTILS.parseInt(config.chartStyle.height);if(config.height==0){config.height=config.width}config.padding=UTILS.parseInt(config.chartStyle.padding,config.padding);config.outerRadius=UTILS.parseInt(config.chartStyle.outerRadius,config.outerRadius);config.innerRadius=UTILS.parseInt(config.chartStyle.innerRadius,config.innerRadius);if(config.tooltip!=null){config.customTooltip=UTILS.customTooltip(config.uniqueid+"_tooltip",config.tooltip.width,config.tooltip.height)}var responsiveWidth=parseInt(config.responsiveWidth);if(responsiveWidth>0&&responsiveWidth<config.width){var innerRadiusPercent=(config.innerRadius/config.width)*100;var outerRadiusPercent=(config.outerRadius/config.width)*100;config.innerRadius=(responsiveWidth*innerRadiusPercent)/100;config.outerRadius=(responsiveWidth*outerRadiusPercent)/100;config.width=responsiveWidth}var legendWidth=0,legendHeight=0;if(config.legendStyle!=null){var titles=config.legendStyle.titles;var subtitles=config.legendStyle.subtitles;if(titles!=null){if(typeof titles==="string"){if(titles!=""){for(var i=0;i<config.data.length;i++){config.data[i][config.titleKey]=titles}}}else{var len=(titles.length<config.data.length)?titles.length:config.data.length;for(var i=0;i<len;i++){if(titles[i]!=""){config.data[i][config.titleKey]=titles[i]}}}}if(subtitles!=null){if(typeof subtitles==="string"){if(subtitles!=""){for(var i=0;i<config.data.length;i++){config.data[i][config.subtitleKey]=subtitles}}}else{var len=(subtitles.length<config.data.length)?subtitles.length:config.data.length;for(var i=0;i<len;i++){if(subtitles[i]!=""){config.data[i][config.subtitleKey]=subtitles[i]}}}}}var isSubtitleAvailable=(config.subtitleKey in config.data[0]);var totalWidth,totalHeight;if(config.legendStyle==null||config.legendStyle.position=="right"){totalWidth=config.width+legendWidth;totalHeight=(config.height>legendHeight)?config.height:legendHeight}else{totalWidth=(config.width>legendWidth)?config.width:legendWidth;totalHeight=config.height+legendHeight}var container=d3.select(chartContainerID);var mainpanel=container.append("svg").attr("width",totalWidth).attr("height",totalHeight).attr("class","multipie");var totalLabel=config.totalKey;var usedLabel=config.usedKey;var x=config.padding,y=config.padding,pies=[],xEnd=null,yEnd=null;var y2=((config.outerRadius*2)+(config.padding*2));var x2=((config.outerRadius*2)+config.padding);var y2Footer2=(isSubtitleAvailable?15:0);for(var i=0;i<config.data.length;i++){var d2=config.data[i];var total=d2[config.totalKey];var used=d2[config.usedKey];var unused=total-used;var percent=(Math.round(used/total*100*100)/100);var title=(d2[config.titleKey]==null)?"":d2[config.titleKey];var subtitle=(d2[config.subtitleKey]==null)?"":d2[config.subtitleKey];var values=[used,unused];var pie=chart_usage_pie().data(values).dataidx(i).colors(d3.scale.ordinal().range([config.colors(title),config.unusedColor])).outerRadius(config.outerRadius).innerRadius(config.innerRadius).displayPercent(false).x(x).y(y).centerText(percent+"%").footerText(title);if(isSubtitleAvailable){pie.footerText2(subtitle)}pie(mainpanel);pies[i]=pie;var arcs=pie.getArcs();if(config.tooltip!=null){arcs.on("mouseover",function(d,i){var path=d3.select(this);var idx=path.attr("dataidx");var pie=pies[idx];var d2=config.data[idx];var total=d2[config.totalKey];var used=d2[config.usedKey];var percent=pie.getPercentages()[0]+"%";var title=(d2[config.titleKey]==null)?"":d2[config.titleKey];var content=title+"<br/>"+totalLabel+":"+total+"<br/> <b> "+usedLabel+":"+used+"("+percent+")</b>";config.customTooltip.showTooltip(content,(d3.event||window.event))}).on("mouseout",function(d,i){config.customTooltip.hideTooltip()})}if(config.clickAction!=null){arcs.style("cursor","pointer");arcs.on("click",function(d,i){var path=d3.select(this);var idx=path.attr("dataidx");var pie=pies[idx];var actionType=config.clickAction.actionType;var actionTarget=config.clickAction.actionTarget;var actionUrl=config.clickAction.actionUrl;var d2=config.data[idx];var total=d2[config.totalKey];var used=d2[config.usedKey];var title=(d2[config.titleKey]==null)?"":d2[config.titleKey];var actionUrlParams="data="+total+","+used+","+escape(title)+"&keys="+config.keys[0]+","+config.keys[1];if(actionType=="callback"){eval(actionTarget+"(total,used,title)")}else{UTILS.executeClickAction(actionType,actionTarget,actionUrl,actionUrlParams,config.uniqueid)}return})}if(config.width<x+x2*2){xEnd=x+x2;x=config.padding;y+=y2+y2Footer2;yEnd=y}else{x+=x2}}if(xEnd==null){xEnd=x+x2}if(yEnd==null){yEnd=y2}};return config};
// chart_multipie.js
var chart_multipie=function(){var a=_chart_multipie();var b=function(c){try{a.drawChart(c)}catch(d){UTILS.appendErrMsg(c,d);throw d}};b.data=function(c){if(!arguments.length){return a.data}a.data=c;return b};b.keys=function(c){if(!arguments.length){return a.keys}a.keys=c;return b};b.chartStyle=function(c){if(!arguments.length){return a.chartStyle}a.chartStyle=c;return b};b.legendStyle=function(c){if(!arguments.length){return a.legendStyle}a.legendStyle=c;return b};b.colors=function(c){if(!arguments.length){return a.colors}a.colors=c;return b};b.tooltip=function(c){if(!arguments.length){return a.tooltip}a.tooltip=c;return b};b.clickAction=function(c){if(!arguments.length){return a.clickAction}a.clickAction=c;return b};b.responsiveWidth=function(c){if(!arguments.length){return a.responsiveWidth}a.responsiveWidth=c;return b};return b};var _chart_multipie=function(){var config={data:[],keys:null,width:800,height:800,outerRadius:60,innerRadius:20,padding:20,colors:d3.scale.category20(),chartStyle:{},legendStyle:null,percentRoundDecimals:2,totalKey:"_total",unusedKey:"_unused",titleKey:"_title",subtitleKey:"_subtitle",unusedColor:"#eeeeee",valueFormat:d3.format(".2s")};config.drawChart=function(chartContainerID){config.uniqueid=chartContainerID.substring(1);if(typeof config.keys[0]==="string"){config.usedKeys=[config.keys[0]]}else{config.usedKeys=config.keys[0]}if(config.keys.length>1){config.totalKey=config.keys[1]}if(config.keys.length>2){config.titleKey=config.keys[2]}if(config.keys.length>3){config.subtitleKey=config.keys[3]}config.width=UTILS.parseInt(config.chartStyle.width);config.height=UTILS.parseInt(config.chartStyle.height);config.padding=UTILS.parseInt(config.chartStyle.padding,config.padding);config.outerRadius=UTILS.parseInt(config.chartStyle.outerRadius,config.outerRadius);config.innerRadius=UTILS.parseInt(config.chartStyle.innerRadius,config.innerRadius);config.percentRoundDecimals=UTILS.parseInt(config.chartStyle.percentRoundDecimals,config.percentRoundDecimals);if(config.tooltip!=null){config.customTooltip=UTILS.customTooltip(config.uniqueid+"_tooltip",config.tooltip.width,config.tooltip.height)}var responsiveWidth=parseInt(config.responsiveWidth);if(responsiveWidth>0&&responsiveWidth<config.width){var innerRadiusPercent=(config.innerRadius/config.width)*100;var outerRadiusPercent=(config.outerRadius/config.width)*100;config.innerRadius=(responsiveWidth*innerRadiusPercent)/100;config.outerRadius=(responsiveWidth*outerRadiusPercent)/100;config.width=responsiveWidth}var legendWidth=0;var legendHeight=0;if(config.legendStyle!==null){legendWidth=parseInt(config.legendStyle.width);legendHeight=parseInt(config.legendStyle.height);var titles=config.legendStyle.titles;var subtitles=config.legendStyle.subtitles;if(titles!=null){if(typeof titles==="string"){for(var i=0;i<config.data.length;i++){config.data[i][config.titleKey]=titles}}else{var len=(titles.length<config.data.length)?titles.length:config.data.length;for(var i=0;i<len;i++){config.data[i][config.titleKey]=titles[i]}}}if(subtitles!=null){if(typeof subtitles==="string"){if(subtitles!=""){for(var i=0;i<config.data.length;i++){config.data[i][config.subtitleKey]=subtitles}}}else{var len=(subtitles.length<config.data.length)?subtitles.length:config.data.length;for(var i=0;i<len;i++){if(subtitles[i]!=""){config.data[i][config.subtitleKey]=subtitles[i]}}}}}config.isSubtitleAvailable=(config.subtitleKey in config.data[0]);var totalWidth,totalHeight;if(config.legendStyle==null||config.legendStyle.position=="right"){totalWidth=config.width+legendWidth;totalHeight=(config.height>legendHeight)?config.height:legendHeight}else{totalWidth=(config.width>legendWidth)?config.width:legendWidth;totalHeight=config.height+legendHeight}var container=d3.select(chartContainerID);var mainpanel=container.append("svg").attr("width",totalWidth).attr("height",totalHeight).attr("class","multipie");var dataLayerKeys=config.usedKeys.concat(["Unused"]);var dcolors=config.usedKeys.map(function(d,i){return config.colors(d)});dcolors.push(config.unusedColor);var dataLayerColors=d3.scale.ordinal().range(dcolors);var hasTotalValue=(config.keys.length>1);var kLen=config.usedKeys.length;var x=config.padding,y=config.padding,pies=[],xEnd=null,yEnd=null;var y2=((config.outerRadius*2)+(config.padding*2));var x2=((config.outerRadius*2)+config.padding);for(var i=0;i<config.data.length;i++){yEnd=null;var d=config.data[i];var values=[],total=0,actualTotal,arcLabels=[],displayPercent=true;for(var k=0;k<kLen;k++){var v1=d[config.usedKeys[k]];values[k]=v1;total=total+v1}if(hasTotalValue){actualTotal=d[config.totalKey];var unused=actualTotal-total;if(unused!=0){var percentages=values.map(function(d,i){return(d3.round((d/actualTotal*100),config.percentRoundDecimals))+"%"});d[config.unusedKey]=unused;values[kLen]=unused;percentages[kLen]="";displayPercent=false;arcLabels=percentages}}else{actualTotal=total;d[config.totalKey]=total;d[config.unusedKey]=0}var pie=chart_usage_pie().data(values).dataidx(i).colors(dataLayerColors).outerRadius(config.outerRadius).innerRadius(config.innerRadius).x(x).y(y).displayPercent(displayPercent).arcLabels(arcLabels).footerText(d[config.titleKey]).footerText2(d[config.subtitleKey]).percentRoundDecimals(config.percentRoundDecimals);pie(mainpanel);pies[i]=pie;var arcs=pie.getArcs();if(config.tooltip!=null){arcs.on("mouseover",function(d,i){var path=d3.select(this);var idx=path.attr("dataidx");var pie=pies[idx];var title=config.data[idx][config.titleKey];var yLabel=dataLayerKeys[i];var yValue=d.value.toFixed(0);var percent=pie.getPercentages()[i]+"%";var total=pie.getTotal();var content=title+'  <font size="-2">(Total:'+total+")</font><br><b>"+yLabel+": "+yValue+"("+percent+")";config.customTooltip.showTooltip(content,(d3.event||window.event))}).on("mouseout",function(d,i){config.customTooltip.hideTooltip()})}if(config.clickAction!=null){arcs.style("cursor","pointer");arcs.on("click",function(d,i){var path=d3.select(this);var idx=path.attr("dataidx");var pie=pies[idx];var actionType=config.clickAction.actionType;var actionTarget=config.clickAction.actionTarget;var actionUrl=config.clickAction.actionUrl;var title=config.data[idx][config.titleKey];var yLabel=config.usedKeys[i];var yValue=d.value;var actionUrlParams="data="+yLabel+","+yValue+","+title+"&keys="+config.titleKey+","+config.usedKeys;if(actionType=="callback"){eval(actionTarget+"(yLabel,yValue,title)")}else{UTILS.executeClickAction(actionType,actionTarget,actionUrl,actionUrlParams,config.uniqueid)}return})}if(config.width<x+x2*2){xEnd=x+x2;x=config.padding;y+=y2;yEnd=y}else{x+=x2}}if(xEnd==null){xEnd=x+((config.outerRadius*2)+config.padding)}if(yEnd==null){yEnd=y+y2+config.padding}if(config.legendStyle!=null){var chart_legends=UTILS.chart_legends().attr("data",config.usedKeys).attr("colors",config.colors).attr("width",legendWidth).attr("height",legendHeight);if(config.legendStyle.position=="right"){chart_legends.attr("x",(xEnd+config.padding)).attr("y",(config.padding+10))}else{chart_legends.attr("x",(config.padding*2)).attr("y",(yEnd+config.padding))}chart_legends(mainpanel)}};return config};
// chart_chord.js
function chart_chord(){var a=_chart_chord();thisChart=function(b){try{a.drawChart(b)}catch(c){UTILS.appendErrMsg(b,c);throw c}};thisChart.data=function(b){if(!arguments.length){return a.data}a.data=b;return thisChart};thisChart.keys=function(b){if(!arguments.length){return a.keys}a.keys=b;return thisChart};thisChart.legendStyle=function(b){if(!arguments.length){return a.legendStyle}a.legendStyle=b;return thisChart};thisChart.chartStyle=function(b){if(!arguments.length){return a.chartStyle}a.chartStyle=b;return thisChart};thisChart.colors=function(b){if(!arguments.length){return a.colors}a.colors=b;return thisChart};thisChart.clickAction=function(b){if(!arguments.length){return a.clickAction}a.clickAction=b;return thisChart};thisChart.responsiveWidth=function(b){if(!arguments.length){return a.responsiveWidth}a.responsiveWidth=b;return thisChart};return thisChart}function _chart_chord(){var a={data:[],keys:null,labels:[],width:500,height:500,colors:null,clickAction:null,title:null};a.drawChart=function(b){a.uniqueid=b.substring(1);a.width=parseInt(a.chartStyle.width);a.height=parseInt(a.chartStyle.height);if(a.legendStyle!=null){a.labels=a.legendStyle.labels}var h=parseInt(a.responsiveWidth);if(h>0&&h<a.width){a.width=h}for(var j=a.data.length-1;j>=0;j--){if(a.labels[j]==undefined){a.labels[j]="label["+j+"]"}}var d=a.matrixAndTerms();var m=a.labels.concat(d.terms);var g=d3.layout.chord().padding(0.05).sortSubgroups(d3.descending).matrix(d.matrix);var c=a.width,s=a.height,p=Math.min(c,s)*0.26,l=p*1.1;if(a.colors==null||a.colors=="default"){var o=["#99000D","#CB181D","#EF3B2C","#FB6A4A","#FC9272","#FEE5D9"];var f=a.data.length;var e=o.slice(0,f);var n=["#3182bd","#6baed6","#9ecae1","#c6dbef","#e6550d","#fd8d3c","#fdae6b","#fdd0a2","#31a354","#74c476","#a1d99b","#c7e9c0","#756bb1","#9e9ac8","#bcbddc","#dadaeb","#636363","#969696","#bdbdbd","#d9d9d9"];var q=e.concat(n);a.colors=d3.scale.ordinal().domain(d3.range(d.terms.length)).range(q)}var k=d3.select(b).append("svg").attr("width",c).attr("height",s).append("g").attr("transform","translate("+c/2+","+s/2+")");a.svg=k;k.append("g").selectAll("path").data(g.groups).enter().append("path").style("fill",function(i){return a.colors(i.index)}).style("stroke",function(i){return a.colors(i.index)}).attr("d",d3.svg.arc().innerRadius(p).outerRadius(l)).on("mouseover",a.fade(0.1)).on("mouseout",a.fade(1));var r=k.append("g").selectAll("g").data(g.groups).enter().append("g");r.append("text").each(function(i){i.angle=(i.startAngle+i.endAngle)/2}).attr("dy",".35em").attr("text-anchor",function(i){return i.angle>Math.PI?"end":null}).attr("transform",function(i){return"rotate("+(i.angle*180/Math.PI-90)+")translate("+(p+45)+")"+(i.angle>Math.PI?"rotate(180)":"")}).text(function(u,t){return m[u.index]+" ("+Math.ceil(u.value)+")"}).on("mouseover",a.fade(0.1)).on("mouseout",a.fade(1));k.append("g").attr("class","chord").selectAll("path").data(g.chords).enter().append("path").style("fill",function(i){return a.colors(i.source.index)}).style("stroke","#000").attr("d",d3.svg.chord().radius(p)).style("opacity",1).append("svg:title").text(function(u,t){return u.source.value});return a};a.fade=function(c,b){return function(e,d){a.svg.selectAll("g.chord path").filter(function(f){return f.source.index!=d&&f.target.index!=d}).transition().style("opacity",c)}};a.matrixAndTerms=function(){var l=[];var d=a.data.length;var e=[];for(var f=0;f<d;f++){var m=a.data[f];var h=m.map(function(i){return i[a.keys[0]]});e=e.concat(h)}e=UTILS.removeDuplicatesInList(e);var k=e.length+d;for(var f=0;f<k;f++){var g=[];for(var c=0;c<k;c++){g.push(0)}l.push(g)}for(var f=d;f<k;f++){var b=e[f-d];for(var c=0;c<d;c++){var n=0;a.data[c].forEach(function(i){if(i[a.keys[0]]==b){n=i[a.keys[1]]}});l[f][c]=n;l[c][f]=n}}return{matrix:l,terms:e}};return a};
// chart_horizon.js
function chart_horizon(){var a=_chart_tree();var b=function(c){try{a.drawChart(c)}catch(d){UTILS.appendErrMsg(c,d);throw d}};b.data=function(c){if(!arguments.length){return a.data}a.data=c;return b};b.keys=function(c){if(!arguments.length){return a.keys}a.keys=c;return b};b.chartStyle=function(c){if(!arguments.length){return a.chartStyle}a.chartStyle=c;return b};b.hAxis=function(c){if(!arguments.length){return a.hAxis}a.hAxis=c;return b};b.vAxis=function(c){if(!arguments.length){return a.vAxis}a.vAxis=c;return b};b.colors=function(c){if(!arguments.length){return a.colors}a.colors=c;return b};b.clickAction=function(c){if(!arguments.length){return a.clickAction}a.clickAction=c;return b};b.responsiveWidth=function(c){if(!arguments.length){return a.responsiveWidth}a.responsiveWidth=c;return b};return b}function _chart_tree(){var a={data:[],keys:null,labels:null,hAxis:{},vAxis:{},style:{},width:800,height:120,colors:d3.scale.category20(),markerList:null,markerKeys:null,noOfSplits:3,interpolate:"linear",fill:true,dataPoints:true,clickAction:null};a.drawChart=function(h){a.uniqueid=h.substring(1);a.xkey=a.keys[0];a.ykeys=a.keys[1];a.width=parseInt(a.chartStyle.width);a.height=parseInt(a.chartStyle.height);a.fill=a.chartStyle.fill?true:false;a.interpolate=a.chartStyle.interpolate;a.noOfSplits=parseInt(a.vAxis.noOfSplits);var d=parseInt(a.responsiveWidth);if(d>0&&d<a.width){a.width=d}var c=a.height;var b=a.width;var D=a.colors;var F=a.noOfSplits;a.hasNamedColors=UTILS.isOrdinalScaleWithNames(a.colors);var A=a.data.map(function(i){return i[a.xkey]});var z=a.data.map(function(i){return i[a.ykeys[0]]});var w=d3.max(z,function(i){return +i})/F;var L=d3.min(z,function(i){return +i})/F;var k=40;var o=20;var p=d3.time.scale.utc().domain([d3.min(A),d3.max(A)]).range([k,b-k]);var E=d3.scale.linear().domain([0,w]).range([c-o,o]);var m=d3.scale.linear().domain([0,w]).range([o,c-o]);var M=new Array(F);var u=new Array(z.length);var Q=z;for(var I=0;I<F;I++){M[I]=new Array(z.length);for(var G=0;G<z.length;G++){if(Q[G]-w<=0){M[I][G]=Q[G];u[G]=0}else{M[I][G]=w;u[G]=Q[G]-w}}Q=u}var n=d3.svg.line().x(function(x,j){return p(A[j])}).y(function(x,j){return E(x)}).interpolate(a.interpolate);var q=d3.select(h).append("svg").attr("height",(c+o)).attr("width",b+k).data(z);var N=q.selectAll("path").data(M).enter().append("svg:path").attr("d",function(x,j){return"M"+k+","+(c-o)+"L"+n(x,j).substr(1)+"L"+(b-k)+","+(c-o)}).attr("class","svgpath").style("stroke-width",2).style("stroke",function(x,j){return a.hasNamedColors?D(a.ykeys[j]):D(j)}).style("fill",function(x,j){if(a.fill){return a.hasNamedColors?D(a.ykeys[j]):D(j)}else{return"none"}});var r=13;var B=q.selectAll("rect").data(z).enter().append("svg:rect").attr("x",function(x,j){return p(A[j])}).attr("y",0).attr("height",c+10).attr("width",function(i){return r}).attr("opacity",0).append("svg:title").text(function(y,x){var j=new Date(+A[x]);displayDate=j.toDateString()+"-"+j.getHours()+":"+j.getMinutes()+":"+j.getSeconds();return"x="+displayDate+" y="+y});if(a.dataPoints&&F==1){q.selectAll("circle").data(z).enter().append("svg:circle").attr("cx",function(x,j){return p(A[j])}).attr("cy",function(x,j){return E(x)}).attr("r",3).attr("opacity",1).attr("fill","gray")}var J=a.markerList!=null;if(J){var O=markerList.map(function(i){return i[markerKeys[0]]});var K=markerList.map(function(i){return i[makerKeps[1]]});var v=d3.time.scale.utc().domain([d3.min(O),d3.max(O)]).range([k,b-k]);var f=d3.scale.linear().domain([0,d3.max(K)]).range([c-o,o]);var P=q.selectAll("path").data(K).enter().append("svg:path").attr("transform",function(x,j){return"translate("+v(O[j])+","+f(x)+")"}).attr("d",d3.svg.symbol().type(function(x,j){return"triangle-up"})).attr("fill","red")}var t=d3.svg.axis().scale(p).orient(a.hAxis.position=="out"?"bottom":"top").tickSubdivide(5);if(a.hAxis.ticks!=="default"){t.ticks(parseInt(a.hAxis.ticks))}if(a.hAxis.tickformat!=="default"){t.tickFormat(d3.format(a.hAxis.tickformat))}var e=q.append("g").attr("class","axis").attr("transform","translate(0,"+(c-o)+")").call(t);e.selectAll("text").attr("transform","rotate("+a.hAxis.tickDisplayAngle+")");if(F==1){var C=a.vAxis.ticks=="default"?3:parseInt(a.vAxis.ticks);var H=a.vAxis.tickFormat=="default"?".2s":a.vAxis.tickformat;var g=a.vAxis.position=="out"?"left":"right";var l=d3.svg.axis().scale(E).orient(g).ticks(C).tickFormat(d3.format(H));var s=q.append("g").attr("class","axis").attr("transform","translate("+k+", 0)").call(l);s.selectAll("line").attr("x1",b);s.selectAll("text").attr("transform","rotate("+a.vAxis.tickDisplayAngle+")");s.selectAll("g").style("opacity","0.5")}return a};return a};
// chart_stats.js
function chart_stats(){var a=_chart_stats();var b=function(c){try{a.drawChart(c)}catch(d){UTILS.appendErrMsg(c,d);throw d}};b.data=function(c){if(!arguments.length){return a.data}a.data=c;return b};b.keys=function(c){if(!arguments.length){return a.keys}a.keys=c;return b};b.chartStyle=function(c){if(!arguments.length){return a.chartStyle}a.chartStyle=c;return b};b.legendStyle=function(c){if(!arguments.length){return a.legendStyle}a.legendStyle=c;return b};b.colors=function(c){if(!arguments.length){return a.colors}a.colors=c;return b};b.clickAction=function(c){if(!arguments.length){return a.clickAction}a.clickAction=c;return b};b.responsiveWidth=function(c){if(!arguments.length){return a.responsiveWidth}a.responsiveWidth=c;return b};return b}function _chart_stats(){var a={data:[],keys:null,titles:"",subtitles:"",colors:d3.scale.category20(),width:300,barHeight:20,titleWidth:75,padding:50,chartStyle:{},legendStyle:{}};a.drawChart=function(c){a.uniqueid=c.substring(1);a.width=parseInt(a.chartStyle.width);a.height=parseInt(a.chartStyle.height);a.barHeight=parseInt(a.chartStyle.barHeight);a.padding=parseInt(a.chartStyle.padding);if(a.legendStyle){a.titles=a.legendStyle.titles;a.subtitles=a.legendStyle.subtitles;a.titleWidth=parseInt(a.legendStyle.width)}var i=parseInt(a.responsiveWidth);if(i>0&&i<a.width){a.width=i}var h=a.data.map(function(u){var t={};t[a.keys[1]]=u[a.keys[1]];t[a.keys[0]]=u[a.keys[0]];t[a.keys[2]]=u[a.keys[2]];return t});var m;if(typeof a.titles==="string"){m=a.data.map(function(t){return a.titles})}else{m=a.titles}var l;if(typeof a.subtitles==="string"){l=a.data.map(function(t){return a.subtitles})}else{l=a.subtitles}var s=a.barHeight*3;var e=h.length;var o=a.padding;var q=(a.barHeight+s)*e+o;var j=d3.max(h,function(t){return +t[a.keys[1]]});var p=d3.scale.linear().domain([0,j]).range([0,a.width]);var d=d3.scale.linear().domain([0,e]).range([0,q-50]);var g=d3.select(c).append("svg").attr("width",o+a.width+o).attr("height",q);var b=g.append("g").attr("transform","translate("+a.titleWidth+",50)");b.selectAll("g").data(h).enter().append("text").attr("y",function(u,t){return d(t)+a.barHeight*0.3}).attr("x",-5).attr("text-anchor","end").text(function(u,t){return m[t]}).style("font","bold 14px sans-serif").style("fill","gray");b.selectAll("g").data(h).enter().append("text").attr("y",function(u,t){return d(t)+a.barHeight}).attr("x",-5).attr("text-anchor","end").text(function(u,t){return l[t]}).style("font","bold 12px sans-serif").style("fill","gray");for(k in a.keys){var n=b.selectAll("g").data(h).enter().append("rect").attr("class","max").attr("y",function(u,t){return d(t)}).attr("x",0).attr("width",function(t){return p(t[a.keys[1]])}).attr("height",a.barHeight).style("fill",a.colors(h[0].max));b.selectAll("g").data(h).enter().append("rect").attr("class","stroke").attr("y",function(u,t){return d(t)-a.barHeight/2}).attr("x",function(t){return p(t[a.keys[1]])-2}).attr("width","1").attr("height",a.barHeight/2).style("fill","black");b.selectAll("g").data(h).enter().append("text").attr("y",function(u,t){return d(t)-5}).attr("x",function(t){return p(t[a.keys[1]])-4}).attr("text-anchor","right").text(function(t){return"Max:"+t[a.keys[1]]}).style("font","bold 12px sans-serif").style("fill","gray")}var r=b.selectAll("g").data(h).enter().append("rect").attr("class","mean").attr("y",function(u,t){return d(t)}).attr("x",0).attr("width",function(t){return p(+t[a.keys[2]])}).attr("height",a.barHeight).style("fill",a.colors(h[0].mean));b.selectAll("g").data(h).enter().append("rect").attr("class","stroke").attr("y",function(u,t){return d(t)}).attr("x",function(t){return p(+t[a.keys[2]])-2}).attr("width","2").attr("height",a.barHeight).style("fill","white");b.selectAll("g").data(h).enter().append("rect").attr("class","stroke").attr("y",function(u,t){return d(t)+a.barHeight}).attr("x",function(t){return p(+t[a.keys[2]])-2}).attr("width","1").attr("height",a.barHeight/2).style("fill","black");b.selectAll("g").data(h).enter().append("text").attr("y",function(u,t){return d(t)+a.barHeight+15}).attr("x",function(t){return p(+t[a.keys[2]])-4}).attr("text-anchor","end").text(function(t){if(+t[a.keys[0]]==t[a.keys[1]]){return"Min:"+t[a.keys[0]]}else{return"Mean:"+t[a.keys[2]]}}).style("font","bold 12px sans-serif").style("fill","gray");var f=b.selectAll("g").data(h).enter().append("rect").attr("class","min").attr("y",function(u,t){return d(t)}).attr("x",0).attr("width",function(t){return p(+t[a.keys[0]])}).attr("height",a.barHeight).style("fill",a.colors(h[0].min));b.selectAll("g").data(h).enter().append("rect").attr("class","stroke").attr("y",function(u,t){return d(t)}).attr("x",function(t){return p(+t[a.keys[0]])-2}).attr("width","2").attr("height",a.barHeight).style("fill","white");b.selectAll("g").data(h).enter().append("rect").attr("class","stroke").attr("y",function(u,t){return d(t)-a.barHeight/2}).attr("x",function(t){return p(+t[a.keys[0]])-2}).attr("width","1").attr("height",a.barHeight/2).style("fill","black");b.selectAll("g").data(h).enter().append("text").attr("y",function(u,t){return d(t)-5}).attr("x",function(t){return p(+t[a.keys[0]])-4}).attr("text-anchor",function(t){if(p(+t[a.keys[0]])>100){return"end"}else{return"right"}}).text(function(t){if(+t[a.keys[0]]!=t[a.keys[1]]){return"Min:"+t[a.keys[0]]}}).style("font","bold 12px sans-serif").style("fill","gray")};return a};